const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdfmake-B32-QUBv.js","assets/_commonjsHelpers-Cpj98o6Y.js","assets/vfs_fonts-D-4-wbPz.js"])))=>i.map(i=>d[i]);
import{d as We,P as jt,Q as yt,o as _t,a as Tt,H as ve,j as a,c as s,e,f as X,g as S,T as Qe,h as Fe,p as Nt,J as Wt,t as h,q as R,s as J,F,B as K,w as Q,m as v,i as N,r as w,L as de,x as Mt,_ as st,I as Et,R as Dt,v as eo,n as bt,u as It,S as ze,C as St,U as Oe,E as to,V as oo,W as ro,b as Vt,X as no,Y as zt,Z as Ot,M as ao,l as so,k as lo,N as I,$ as io,a0 as co}from"./index-B7jQKMlp.js";import{u as Ut}from"./useSpreadsheet-PoyIU8AQ.js";import{u as uo}from"./documentSettingsStore-Bd0QdTFI.js";const vo={class:"vendor-details glass overflow-hidden rounded-2xl border border-[var(--color-border)] shadow-sm"},po=["aria-expanded"],fo={class:"vendor-details__body"},mo={key:0,class:"vendor-details__expiry-alert",role:"status"},bo={class:"vendor-details__expiry-icon","aria-hidden":"true"},ho={key:0,class:"vendor-details__expiry-icon-svg",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},_o={key:1,class:"vendor-details__expiry-icon-svg",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},yo={key:2,class:"vendor-details__expiry-icon-placeholder"},xo={class:"vendor-details__expiry-value"},go={class:"vendor-details__expiry-icon","aria-hidden":"true"},ko={key:0,class:"vendor-details__expiry-icon-svg",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},wo={key:1,class:"vendor-details__expiry-icon-svg",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},Co={key:2,class:"vendor-details__expiry-icon-placeholder"},Ro={class:"vendor-details__expiry-value"},So={class:"vendor-details__grid"},$o={class:"vendor-details__field"},To={class:"tax-modal__search-dropdown-input-wrap"},jo=["value","readonly"],No={key:0,class:"tax-modal__search-dropdown-list",role:"listbox"},Mo=["onMousedown"],Eo={class:"font-semibold text-[var(--color-accent)]"},Do={key:0,class:"ml-2 text-[var(--color-text-muted)] text-[0.8125rem]"},Bo={key:0,class:"px-4 py-3 text-[0.8125rem] text-[var(--color-text-muted)] m-0"},Lo={key:1,class:"px-4 py-3 text-[0.8125rem] text-[var(--color-text-muted)] m-0"},Ao={key:2,class:"px-4 py-3 text-[0.8125rem] text-[var(--color-text-muted)] m-0"},Po={class:"vendor-details__field"},Vo=["value","readonly"],zo={class:"vendor-details__field"},Oo=["value","readonly"],Fo={class:"vendor-details__field"},Wo=["value","readonly"],Io={class:"vendor-details__field"},Uo={class:"vendor-details__select-wrap"},Ho=["value","disabled"],qo={key:1,class:"vendor-details__error",role:"alert"},Yo=We({__name:"VendorDetails",setup($){const x=jt(),p=yt(),{findRecordsWithIds:L,isConnected:_}=Mt(),d=N(()=>x.vendor),T=w(!1),g=w(null),M=w(!1),ce=w(""),P=N(()=>p.mainPosted&&p.mainStatus!=="Rejected"),V=N(()=>!p.currentTransRef||P.value),D=N(()=>p.mainStatus==="Approved"||p.mainStatus==="Posted"||p.currentTransRef?null:x.selectedVendorExpiryCheckDis),z=N(()=>p.mainStatus==="Approved"||p.mainStatus==="Posted"||p.currentTransRef?null:x.selectedVendorWhtExpiryCheckDis),Ie=N(()=>(D.value||z.value)!=null);function ee(y){if(!y)return!1;const i=y.toLowerCase().trim();return i==="invalid"||i==="expired"||i==="no"}const A=N(()=>p.currentTransRef?p.mainExpiryCheck:x.selectedVendorExpiryCheck),W=N(()=>p.currentTransRef?p.mainWhtExpiryCheck:x.selectedVendorWhtExpiryCheck),B=w([]),te=w(!1);function ke(y){const i=y.fieldData;return String(i.Vendor_ID??i["Vendor ID"]??"").trim()}function fe(y){const i=y.fieldData;return String(i.Vendor_Name??i["Vendor Name"]??"").trim()}function G(y){const i=ke(y);return i!==""&&i===d.value.vendor_id}const ae=N(()=>{const y=ce.value.toLowerCase();return y?B.value.filter(i=>{const C=ke(i).toLowerCase(),se=fe(i).toLowerCase();return C.includes(y)||se.includes(y)}):B.value});async function _e(){if(!_.value){B.value=[];return}te.value=!0;const{data:y,error:i}=await L(de.VENDOR_TBL,{limit:500});te.value=!1,B.value=i?[]:y}function we(y){ce.value=y,x.setField("vendor_id",y),y!=null&&y.trim()||x.setExpiryFromVendorRecord(void 0),P.value||p.markDirty(),M.value=!0}function Ce(y){const i=ke(y),C=fe(y);x.setField("vendor_id",i),x.setField("vendor_name",C),x.setExpiryFromVendorRecord(y.fieldData),ce.value="",M.value=!1,P.value||p.markDirty()}function Re(y,i){x.setField(y,i),P.value||p.markDirty()}function Ue(y){g.value&&!g.value.contains(y.target)&&(M.value=!1)}return _t(()=>{_e(),document.addEventListener("click",Ue)}),Tt(()=>{document.removeEventListener("click",Ue)}),ve(_,y=>{y&&_e()}),(y,i)=>(a(),s("section",vo,[e("button",{type:"button",class:"vendor-details__header","aria-expanded":!T.value,onClick:i[0]||(i[0]=C=>T.value=!T.value)},[i[8]||(i[8]=e("span",{class:"vendor-details__title"},"Vendor details",-1)),(a(),s("svg",{class:X(["vendor-details__chevron",{"vendor-details__chevron--open":!T.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[...i[7]||(i[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))],8,po),S(Qe,{name:"vendor-details-body"},{default:Fe(()=>[Nt(e("div",fo,[Ie.value?(a(),s("div",mo,[D.value?(a(),s("div",{key:0,class:X(["vendor-details__expiry-item",{"vendor-details__expiry-item--invalid":ee(A.value),"vendor-details__expiry-item--valid":A.value&&!ee(A.value)}])},[e("span",bo,[A.value&&ee(A.value)?(a(),s("svg",ho,[...i[9]||(i[9]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 9l-6 6M9 9l6 6"},null,-1)])])):A.value?(a(),s("svg",_o,[...i[10]||(i[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):(a(),s("span",yo))]),i[11]||(i[11]=e("strong",{class:"vendor-details__expiry-label"},"GRA Expiry:",-1)),e("span",xo,h(D.value),1)],2)):R("",!0),z.value?(a(),s("div",{key:1,class:X(["vendor-details__expiry-item",{"vendor-details__expiry-item--invalid":ee(W.value),"vendor-details__expiry-item--valid":W.value&&!ee(W.value)}])},[e("span",go,[W.value&&ee(W.value)?(a(),s("svg",ko,[...i[12]||(i[12]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 9l-6 6M9 9l6 6"},null,-1)])])):W.value?(a(),s("svg",wo,[...i[13]||(i[13]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):(a(),s("span",Co))]),i[14]||(i[14]=e("strong",{class:"vendor-details__expiry-label"},"WHT Expiry:",-1)),e("span",Ro,h(z.value),1)],2)):R("",!0)])):R("",!0),e("div",So,[e("label",$o,[i[16]||(i[16]=e("span",{class:"vendor-details__label"},[J("Vendor ID "),e("span",{class:"vendor-details__required"},"Required")],-1)),e("div",{ref_key:"vendorDropdownRef",ref:g,class:"tax-modal__search-dropdown"},[e("div",To,[e("input",{value:d.value.vendor_id,type:"text",class:"tax-modal__search-dropdown-input",placeholder:"Search or select vendor…",readonly:P.value,autocomplete:"off",onFocus:i[1]||(i[1]=C=>P.value?null:M.value=!0),onInput:i[2]||(i[2]=C=>we(C.target.value))},null,40,jo),e("span",{class:X(["tax-modal__search-dropdown-chevron",{"tax-modal__search-dropdown-chevron--open":M.value}]),"aria-hidden":"true"},[...i[15]||(i[15]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M6 9l6 6 6-6"})],-1)])],2)]),S(Qe,{name:"search-dropdown"},{default:Fe(()=>[M.value&&!P.value?(a(),s("div",No,[(a(!0),s(F,null,K(ae.value,(C,se)=>(a(),s("button",{key:C.recordId||se,type:"button",role:"option",class:X(["tax-modal__search-dropdown-item",{"tax-modal__search-dropdown-item--highlight":G(C)}]),onMousedown:Q(Je=>Ce(C),["prevent"])},[e("span",Eo,h(ke(C)),1),fe(C)?(a(),s("span",Do,h(fe(C)),1)):R("",!0)],42,Mo))),128)),B.value.length>0&&ae.value.length===0?(a(),s("p",Bo," No matching vendors ")):B.value.length===0&&!te.value?(a(),s("p",Lo," No vendors yet ")):te.value?(a(),s("p",Ao," Loading… ")):R("",!0)])):R("",!0)]),_:1})],512)]),e("label",Po,[i[17]||(i[17]=e("span",{class:"vendor-details__label"},[J("Vendor name "),e("span",{class:"vendor-details__required"},"Required")],-1)),e("input",{value:d.value.vendor_name,type:"text",class:"vendor-details__input",placeholder:"Select vendor above",readonly:V.value,onInput:i[3]||(i[3]=C=>Re("vendor_name",C.target.value))},null,40,Vo)]),e("label",zo,[i[18]||(i[18]=e("span",{class:"vendor-details__label"},"Date",-1)),e("input",{value:d.value.payment_terms,type:"date",class:"vendor-details__input vendor-details__input--date",readonly:P.value,onInput:i[4]||(i[4]=C=>Re("payment_terms",C.target.value))},null,40,Oo)]),e("label",Fo,[i[19]||(i[19]=e("span",{class:"vendor-details__label"},"Contact email",-1)),e("input",{value:d.value.contact_email,type:"email",class:"vendor-details__input",placeholder:"vendor@example.com",readonly:P.value,onInput:i[5]||(i[5]=C=>Re("contact_email",C.target.value))},null,40,Wo)]),e("label",Io,[i[22]||(i[22]=e("span",{class:"vendor-details__label"},"Currency",-1)),e("div",Uo,[e("select",{value:d.value.currency,class:"vendor-details__input vendor-details__select",disabled:P.value,onChange:i[6]||(i[6]=C=>Re("currency",C.target.value))},[...i[20]||(i[20]=[e("option",{value:"GHS"},"GHS",-1),e("option",{value:"EUR"},"EUR",-1),e("option",{value:"GBP"},"GBP",-1),e("option",{value:"USD"},"USD",-1),e("option",{value:"CAD"},"CAD",-1)])],40,Ho),i[21]||(i[21]=e("svg",{class:"vendor-details__select-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-6 6-6-6"})],-1))])])]),v(x).error?(a(),s("p",qo,h(v(x).error),1)):R("",!0)],512),[[Wt,!T.value]])]),_:1})]))}}),Xo=st(Yo,[["__scopeId","data-v-c4619117"]]),Go={key:0,class:"unsaved-modal-backdrop",role:"dialog","aria-modal":"true","aria-labelledby":"unsaved-modal-title","aria-describedby":"unsaved-modal-desc"},Ko=We({__name:"UnsavedChangesModal",props:{visible:{type:Boolean}},emits:["confirm","cancel"],setup($,{emit:x}){const p=x;function L(){p("confirm")}function _(){p("cancel")}return(d,T)=>(a(),Et(Dt,{to:"body"},[S(Qe,{name:"unsaved-modal"},{default:Fe(()=>[$.visible?(a(),s("div",Go,[e("div",{class:"unsaved-modal"},[T[0]||(T[0]=e("div",{class:"unsaved-modal__icon-wrap"},[e("svg",{class:"unsaved-modal__icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),T[1]||(T[1]=e("h2",{id:"unsaved-modal-title",class:"unsaved-modal__title"}," Unsaved changes ",-1)),T[2]||(T[2]=e("p",{id:"unsaved-modal-desc",class:"unsaved-modal__message"}," You have unsaved changes. Leave anyway? ",-1)),e("div",{class:"unsaved-modal__actions"},[e("button",{type:"button",class:"unsaved-modal__btn unsaved-modal__btn--primary",onClick:_}," Stay "),e("button",{type:"button",class:"unsaved-modal__btn unsaved-modal__btn--danger",onClick:L}," Leave ")])])])):R("",!0)]),_:1})]))}}),Zo=st(Ko,[["__scopeId","data-v-574025db"]]),Qo={key:0,class:"reject-modal-backdrop",role:"dialog","aria-modal":"true","aria-labelledby":"reject-modal-title","aria-describedby":"reject-modal-desc"},Jo={key:0,class:"reject-modal__error",role:"alert"},er={class:"reject-modal__actions"},tr=["disabled"],or=We({__name:"RejectReasonModal",props:{visible:{type:Boolean}},emits:["submit","cancel"],setup($,{emit:x}){const p=$,L=x,_=w(""),d=w(""),T=w(!1),g=w(null);ve(()=>p.visible,P=>{P&&(_.value="",d.value="",T.value=!1,requestAnimationFrame(()=>{var V;(V=g.value)==null||V.focus()}))});function M(){L("cancel")}function ce(){const P=_.value.trim();if(!P){d.value="Please enter a reason for rejection.";return}d.value="",T.value=!0,L("submit",P)}return(P,V)=>(a(),Et(Dt,{to:"body"},[S(Qe,{name:"reject-modal"},{default:Fe(()=>[$.visible?(a(),s("div",Qo,[e("div",{class:"reject-modal",role:"document",onClick:V[1]||(V[1]=Q(()=>{},["stop"]))},[e("header",{class:"reject-modal__header"},[V[3]||(V[3]=e("h2",{id:"reject-modal-title",class:"reject-modal__title"},"Reject entry",-1)),e("button",{type:"button",class:"reject-modal__close","aria-label":"Cancel",onClick:M},[...V[2]||(V[2]=[e("svg",{class:"reject-modal__close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),V[5]||(V[5]=e("p",{id:"reject-modal-desc",class:"reject-modal__desc"}," Enter the reason the officer needs to address. This will be shown when they view the rejected entry. ",-1)),e("form",{class:"reject-modal__form",onSubmit:Q(ce,["prevent"])},[V[4]||(V[4]=e("label",{class:"reject-modal__label",for:"reject-reason-input"}," Reason ",-1)),Nt(e("textarea",{id:"reject-reason-input",ref_key:"textareaRef",ref:g,"onUpdate:modelValue":V[0]||(V[0]=D=>_.value=D),class:"reject-modal__textarea",placeholder:"e.g. Wrong vendor name, missing invoice number, amount mismatch...",rows:"4",autofocus:""},null,512),[[eo,_.value]]),d.value?(a(),s("p",Jo,h(d.value),1)):R("",!0),e("div",er,[e("button",{type:"button",class:"reject-modal__btn reject-modal__btn--cancel",onClick:M}," Cancel "),e("button",{type:"submit",class:"reject-modal__btn reject-modal__btn--danger",disabled:T.value},h(T.value?"Rejecting…":"Reject"),9,tr)])],32)])])):R("",!0)]),_:1})]))}}),rr=st(or,[["__scopeId","data-v-2598b29b"]]),nr={key:0,class:"flex flex-wrap items-center gap-2 rounded-[var(--radius-card)] border border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-2 backdrop-blur-[var(--blur-glass)]"},ar=["disabled"],sr=We({__name:"Toolbar",props:{canDeleteRow:{type:Boolean,default:!0}},emits:["add-row","delete-row"],setup($){const x=yt(),p=N(()=>x.mainPosted);return(L,_)=>p.value?R("",!0):(a(),s("div",nr,[e("button",{type:"button",class:"pill-btn flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-[var(--input-size)] text-[var(--color-text)] hover:bg-[var(--color-accent-soft)]",onClick:_[0]||(_[0]=d=>L.$emit("add-row"))},[..._[3]||(_[3]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),J(" Add row ",-1)])]),e("button",{type:"button",class:"pill-btn flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-[var(--input-size)] text-[var(--color-text)] hover:bg-red-500/10 hover:text-red-400",disabled:!$.canDeleteRow,onClick:_[1]||(_[1]=d=>L.$emit("delete-row"))},[..._[4]||(_[4]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),J(" Delete row ",-1)])],8,ar),v(x).hasUndoDelete?(a(),s("button",{key:0,type:"button",class:"pill-btn flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-[var(--input-size)] text-[var(--color-accent)] hover:bg-[var(--color-accent-soft)]",onClick:_[2]||(_[2]=d=>v(x).undoDelete())},[..._[5]||(_[5]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1),J(" Undo delete ",-1)])])):R("",!0)]))}}),$t=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],lr=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];function ir($){return $.length>0?$.charAt(0).toUpperCase()+$.slice(1):""}function ht($){if($===0)return"";if($<20)return $t[$];if($<100){const _=Math.floor($/10),d=$%10;return(lr[_]+(d>0?"-"+$t[d]:"")).trim()}const x=Math.floor($/100),p=$%100,L=p>0?" "+ht(p):"";return $t[x]+" hundred"+L}function dr($){if(!Number.isFinite($)||Number.isNaN($))return"Zero";const x=Math.max(0,Math.min(99999999999e-2,$)),p=Math.floor(x),L=Math.round((x-p)*100);if(p===0&&L===0)return"Zero";let _="";if(p>=1e6){const T=Math.floor(p/1e6);_+=ht(T)+" million "}let d=p%1e6;if(d>=1e3){const T=Math.floor(d/1e3);_+=ht(T)+" thousand "}return d=p%1e3,d>0&&(_+=(_.length>0?"and ":"")+ht(d)),_=_.trim(),_===""&&(_="zero"),L>0&&(_+=" and "+String(L).padStart(2,"0")+"/100"),ir(_.trim())}function cr($){return $==null?!1:String($).trim().startsWith("=")}const ur=We({__name:"ContextMenu",props:{visible:{type:Boolean,default:!1},x:{default:0},y:{default:0}},emits:["copy","paste","cut","clear"],setup($,{emit:x}){const p=x;function L(){p("copy")}function _(){p("paste")}function d(){p("cut")}function T(){p("clear")}return(g,M)=>(a(),Et(Dt,{to:"body"},[Nt(e("div",{class:"fixed z-[100] min-w-[160px] rounded-[var(--radius-card)] border border-[var(--color-border)] py-1 shadow-xl",style:bt([{background:"var(--color-bg-card)","backdrop-filter":"blur(var(--blur-glass))","-webkit-backdrop-filter":"blur(var(--blur-glass))",transition:"opacity 0.15s var(--ease)"},{left:`${$.x}px`,top:`${$.y}px`}]),onClick:M[0]||(M[0]=Q(()=>{},["stop"]))},[e("button",{type:"button",class:"flex w-full items-center gap-2 px-3 py-2 text-left text-[var(--input-size)] text-[var(--color-text)] hover:bg-white/10",onClick:L},[...M[1]||(M[1]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),J(" Copy ",-1)])]),e("button",{type:"button",class:"flex w-full items-center gap-2 px-3 py-2 text-left text-[var(--input-size)] text-[var(--color-text)] hover:bg-white/10",onClick:_},[...M[2]||(M[2]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})],-1),J(" Paste ",-1)])]),e("button",{type:"button",class:"flex w-full items-center gap-2 px-3 py-2 text-left text-[var(--input-size)] text-[var(--color-text)] hover:bg-white/10",onClick:d},[...M[3]||(M[3]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.242 4.242 3 3 0 004.242-4.242zm0-5.758a3 3 0 10-4.242-4.242 3 3 0 004.242 4.242z"})],-1),J(" Cut ",-1)])]),e("button",{type:"button",class:"flex w-full items-center gap-2 px-3 py-2 text-left text-[var(--input-size)] text-[var(--color-text)] hover:bg-white/10",onClick:T},[...M[4]||(M[4]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),J(" Clear ",-1)])])],4),[[Wt,$.visible]])]))}}),vr={class:"data-grid-wrapper flex flex-col flex-1 min-h-0 rounded-xl border border-[var(--color-border)] bg-[var(--color-bg-card)] shadow-sm overflow-hidden"},pr={class:"sticky top-0 z-10 bg-[var(--color-bg-dark)]"},fr=["onClick"],mr=["onClick"],br={key:0,class:"cell-display"},hr=["value","onChange"],_r=["value"],yr={class:"cell-tax-wrap flex items-center gap-1 min-w-0"},xr={class:"cell-display flex-1 min-w-0"},gr=["onClick"],kr={key:0,class:"cell-tax-breakdown-loading"},wr={key:0,class:"cell-tax-breakdown-list"},Cr={key:1,class:"cell-tax-breakdown-empty"},Rr={key:3,class:"cell-display"},Sr={key:4,class:"cell-display"},$r=["value","onInput"],Tr={key:0,class:"data-grid-row-actions"},jr=["aria-expanded","onClick"],Nr={class:"data-grid-row-actions__panel"},Mr={key:0,class:"data-grid-row-actions__header"},Er={key:0,class:"data-grid-row-actions__header-badge"},Dr={key:0,class:"data-grid-row-actions__state"},Br={key:1,class:"data-grid-row-actions__state"},Lr={key:2},Ar={class:"data-grid-row-actions__group"},Pr={class:"data-grid-row-actions__list"},Vr=["onClick"],zr={key:0,class:"data-grid-row-actions__checkmark",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},Or={key:1,class:"data-grid-row-actions__checkmark-placeholder"},Fr={class:"data-grid-row-actions__option-label"},Wr={key:2,class:"data-grid-row-actions__option-meta"},Ir={key:3,class:"data-grid-row-actions__chevron",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},Ur={class:"data-grid-row-actions__group"},Hr={class:"data-grid-row-actions__list"},qr=["onClick"],Yr={key:0,class:"data-grid-row-actions__checkmark",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},Xr={key:1,class:"data-grid-row-actions__checkmark-placeholder"},Gr={class:"data-grid-row-actions__option-label"},Kr={class:"data-grid-row-actions__option-meta"},Zr={key:0,class:"flex flex-wrap items-center justify-between gap-3 px-4 py-3 border-t border-[var(--color-border)] bg-[var(--color-bg-dark)]/50 text-[var(--label-size)]"},Qr={class:"flex items-center gap-4"},Jr={class:"text-[var(--color-text-muted)]"},en={class:"flex items-center gap-2 text-[var(--color-text-muted)]"},tn=["value"],on=["value"],rn={class:"flex items-center gap-2"},nn=["disabled"],an={class:"px-2 py-1.5 text-[var(--color-text-muted)]"},sn=["disabled"],ln={class:"entry-total-row flex flex-wrap items-end justify-between gap-6 px-4 py-4 border-t-2 border-[var(--color-border)] bg-[var(--color-bg-dark)]"},dn={class:"entry-total-row__left flex flex-col items-start gap-0.5"},cn={class:"entry-total-row__words"},un={class:"entry-total-row__value text-xl font-bold text-[var(--color-text)] tabular-nums tracking-tight"},vn=We({__name:"DataGrid",setup($){const x=Ut(),p=yt(),L=jt(),_=It();function d(o){return St(o)||"0.00"}const T=N(()=>dr(p.entryTotal)),{findRecordsWithIds:g,findRecordsByQuery:M,findRecordsByQueryWithIds:ce,createRecord:P,deleteRecord:V,isConnected:D}=Mt(),{COLUMN_KEYS:z,ROW_HEADER_WIDTH:Ie,rows:ee,selectedRow:A,selectedCol:W,getCellValue:B,setCellValue:te,evaluateCellFormula:ke,selectCell:fe,moveSelection:G,ensureRowForEnter:ae,copy:_e,cut:we,paste:Ce,clearCell:Re}=x,Ue=[10,15,25,50],y=w(15),i=w(1),C=N(()=>ee.value.length),se=N(()=>Math.max(1,Math.ceil(C.value/y.value))),Je=N(()=>{const o=C.value;if(o===0)return[];const t=(i.value-1)*y.value,r=Math.min(t+y.value,o),l=[];for(let u=t;u<r;u++)l.push(u);return l}),xt=N(()=>C.value===0?0:(i.value-1)*y.value+1),He=N(()=>Math.min(i.value*y.value,C.value));ve(A,o=>{const t=Math.floor(o/y.value)+1;t>=1&&t<=se.value&&t!==i.value&&(i.value=t)}),ve(C,()=>{i.value>se.value&&(i.value=Math.max(1,se.value))});const qe=p.STATUS_OPTIONS,ye=N(()=>p.mainPosted&&p.mainStatus!=="Rejected"),me=z.indexOf("tax"),lt=z.indexOf("reference"),xe=z.indexOf("amount"),Se=z.indexOf("invoice_number"),pe=w(null),le=w(null),ge=w(new Set),et=w(new Map),Me=w(null),it=w([]),tt=w(!1),Ee=w(null),Z=w([]),Ye=w(!1),Xe=w(null),c=w(null),n=w(new Map);async function m(){if(!D.value)return;tt.value=!0;const{data:o}=await g(de.TAX_VALUE,{limit:500});it.value=o,tt.value=!1}function f(){Ee.value=null,Z.value=[],Xe.value=null}async function k(o,t){const r=B(o,Se),l=r!=null&&String(r).trim()!==""?String(r).trim():"";if(Ee.value===o){f();return}if(Ee.value=o,Z.value=[],Xe.value=null,!l){Xe.value="Enter invoice number first, then add tax via row menu (⋯).",Ye.value=!1,Oe(()=>U(t));return}Ye.value=!0;const{data:u,error:b}=await M(de.PAYABLE_INVOICE,{invoiceNumber:l},100);Ye.value=!1,b?Z.value=[{TaxName:`Error: ${b}`,Rate:void 0}]:Z.value=u.map(O=>({TaxName:O.TaxName??"—",Rate:O.Rate})),Oe(()=>U(t))}function U(o){var l;const t=c.value,r=(l=o.target)==null?void 0:l.closest(".cell-tax-breakdown-trigger");if(t&&r){const u=r.getBoundingClientRect();t.style.position="fixed",t.style.left=`${u.left}px`,t.style.top=`${u.bottom+4}px`,t.style.zIndex="50"}}function oe(o){const t=(o??"").trim();if(!t)return null;const r=/^(\d{4})-(\d{2})-(\d{2})$/.exec(t);if(r){const b=new Date(parseInt(r[1],10),parseInt(r[2],10)-1,parseInt(r[3],10));return Number.isNaN(b.getTime())?null:b}const l=/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/.exec(t);if(l){const b=new Date(parseInt(l[3],10),parseInt(l[1],10)-1,parseInt(l[2],10));return Number.isNaN(b.getTime())?null:b}const u=new Date(t);return Number.isNaN(u.getTime())?null:u}function re(o,t){const{fieldData:r}=o,l=oe(r.Start_Date),u=oe(r.End_Date);return!(l!==null&&l>t||u!==null&&u<t)}const be=N(()=>{const o=new Date;return o.setHours(0,0,0,0),it.value.filter(t=>re(t,o))}),ie=N(()=>{const o=be.value,t=new Map;for(const{fieldData:r}of o){const l=(r.Tax_Type??"").trim()||"—";t.has(l)||t.set(l,[]),t.get(l).push(r)}return Array.from(t.entries()).map(([r,l])=>({typeKey:r,typeLabel:r,items:l}))}),E=N(()=>{const o=le.value;if(!o)return[];const t=ie.value.find(r=>r.typeLabel===o);return(t==null?void 0:t.items)??[]});function ot(o){if(o==null||o==="")return"—";const t=Number(o);return Number.isNaN(t)?"—":`${t}%`}function Ge(o){const t=B(o,me);if(t==null||String(t).trim()==="")return"";const r=Number(t);return Number.isNaN(r)?String(t).trim():`${r}%`}async function dt(o){if(!D.value)return;const t=B(o,Se),r=t!=null&&String(t).trim()!==""?String(t).trim():"";if(r===""){n.value.set(o,[]);return}const{data:l}=await ce(de.PAYABLE_INVOICE,{invoiceNumber:r},100);n.value.set(o,l.map(u=>u.fieldData))}function De(o){pe.value===o?(pe.value=null,le.value=null):(pe.value=o,le.value=null,dt(o))}function H(o,t,r){const l=n.value.get(o);if(!l||l.length===0)return!1;const u=r!=null&&r!==""?Number(r):0,b=String(t??"").trim();return l.some(O=>String(O.TaxName??"").trim()===b&&Number(O.Rate)===(Number.isNaN(u)?0:u))}function ct(o,t){if(t.items.length===1){const r=t.items[0],l=r.Tax_Rate,u=r.Tax_Name??"";ut(o,l,u)}else le.value=t.typeLabel}async function gt(o,t,r){if(!D.value||!t.trim())return null;const l=B(o,Se),u=l!=null&&String(l).trim()!==""?String(l).trim():"";if(u==="")return null;const b=r!=null&&r!==""?Number(r):0,{data:O}=await ce(de.PAYABLE_INVOICE,{invoiceNumber:u},100),je=O.find(Ne=>{var at,Pt;return String(((at=Ne.fieldData)==null?void 0:at.TaxName)??"").trim()===t.trim()&&Number((Pt=Ne.fieldData)==null?void 0:Pt.Rate)===(Number.isNaN(b)?0:b)});if(je!=null&&je.recordId){await V(de.PAYABLE_INVOICE,je.recordId);const Ne=n.value.get(o)??[];return n.value.set(o,Ne.filter(at=>!(String(at.TaxName??"").trim()===t.trim()&&Number(at.Rate)===(Number.isNaN(b)?0:b)))),!0}const Pe={invoiceNumber:u,TaxName:t.trim(),Rate:Number.isNaN(b)?0:b};await P(de.PAYABLE_INVOICE,Pe);const Ve=n.value.get(o)??[];return n.value.set(o,[...Ve,Pe]),!1}async function ut(o,t,r){const l=t!=null&&t!==""?Number(t):0,u=p.currentTransRef;if(u&&D.value&&p.isDirty){const O=await p.syncToFileMaker({markPosted:!1});if(O.error){_.error("Save failed: "+O.error+". Save your changes before selecting a tax."),pe.value=null,le.value=null;return}}const b=r&&D.value?await gt(o,r,t):null;if(u&&r&&D.value)await p.fetchDetailsByTransRef(u);else if(b===!0)te(o,me,"0"),te(o,lt,"");else{const O=B(o,xe),je=typeof O=="number"?O:parseFloat(String(O)),Pe=!Number.isNaN(je)&&l!==0?je*(l/100):l,Ve=l!==0?String(Pe):"";te(o,me,Ve),te(o,lt,Ve)}pe.value=null,le.value=null,Oe(()=>{var O;fe(o,me),(O=ue.value)==null||O.focus()})}function rt(){pe.value=null,le.value=null}_t(()=>{document.addEventListener("click",rt),m(),he()}),Tt(()=>{document.removeEventListener("click",rt),Me.value&&clearTimeout(Me.value)}),ve(D,o=>{o&&m()}),ve(ee,()=>{he()},{deep:!0});const vt=w(null),ue=w(null),Y=w("");function kt(o,t){return A.value===o&&W.value===t}const nt=N(()=>String(B(A.value,W.value)??""));ve([A,W],()=>{Y.value=nt.value,Oe(()=>{var o;(o=ue.value)==null||o.focus(),ue.value&&(ue.value.value=Y.value)})},{immediate:!0,flush:"sync"}),ve(nt,o=>{Y.value!==o&&(Y.value=o,Oe(()=>{ue.value&&(ue.value.value=o)}))});function wt(){const o=Y.value.trim();te(A.value,W.value,o),he()}function Bt(o,t,r){Y.value=r,z[t]==="invoice_number"&&(he(),pt(r.trim(),o))}function he(){const o=new Set,t=new Map;for(let r=0;r<ee.value.length;r++){let l;r===A.value&&W.value===Se&&Y.value!==void 0?l=Y.value:l=B(r,Se);const u=l!=null&&String(l).trim()!==""?String(l).trim():"";if(u==="")continue;const b=u.toLowerCase();t.has(b)?(o.add(t.get(b)),o.add(r)):t.set(b,r)}ge.value=o}function pt(o,t){Me.value&&clearTimeout(Me.value),!(!o||!D.value)&&(Me.value=setTimeout(async()=>{await Lt(o,t)},500))}async function Lt(o,t){if(!o||!D.value)return;const r=ee.value[t],l=r==null?void 0:r.recordId;if(et.value.has(o)&&!l){if(et.value.get(o))ge.value.add(t);else{const Ne=B(t,Se);Ne!=null&&String(Ne).trim()!==""&&String(Ne).trim().toLowerCase(),he()}return}const u=Number(o),b=Number.isNaN(u)?o:u,{data:O}=await ce(de.PAYABLES_DETAILS,{InvoiceNumber:b},100),Pe=(l?O.filter(Ve=>Ve.recordId!==l):O).length>0;l||et.value.set(o,Pe),Pe?ge.value.add(t):he()}function $e(o){const t=Y.value.trim();te(A.value,W.value,t),G(o),o==="enter"&&ae(),Oe(()=>{var r;return(r=ue.value)==null?void 0:r.focus()})}function Ct(){var o;Y.value=String(B(A.value,W.value)??""),(o=ue.value)==null||o.blur()}const ft=["invoice_number","amount","total"];function Rt(o){if(o==="amount")return ft.includes(o)?"Amount before VAT *":"Amount before VAT";if(o==="reference")return"Tax Amount";const t=o.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase());return ft.includes(o)?`${t} *`:t}function j(o){return o==="status"}function q(o){return o==="tax"}function ne(o){const t=B(o,me);if(t==null||t==="")return!1;const r=Number(t);return!Number.isNaN(r)&&r>0}function Ke(o){return o==="total"}function Te(o){return o==="reference"}const Ze=["amount","tax","reference","total"];function Be(o,t){const r=B(o,t);if(r==null||r==="")return"";if(cr(r)){const u=ke(String(r));return typeof u=="number"?St(u):String(u)}const l=z[t];if(Ze.includes(l)){const u=St(r);return u!==""?u:r}return r}const mt={invoice_number:"12ch",amount:"12ch",tax:"10ch",reference:"12ch",total:"12ch"};function At(o){return{minWidth:mt[o]??"10ch"}}const Ht=N(()=>({tableLayout:"auto",minWidth:"100%"}));function qt(o,t){const r=A.value===o&&W.value===t,u=z[t]==="invoice_number"&&ge.value.has(o);return{"bg-[var(--color-accent-soft)] ring-2 ring-[var(--color-accent)] ring-inset":r,"bg-[var(--color-bg-card)]":!r,"cell-duplicate":u}}function Yt(o,t){Y.value=String(B(o,t)??""),fe(o,t),!j(z[t])&&!q(z[t])&&!Ke(z[t])&&!Te(z[t])&&Oe(()=>{var r;return(r=ue.value)==null?void 0:r.focus()})}const Le=w({visible:!1,x:0,y:0});function Xt(o){p.mainPosted||(Le.value={visible:!0,x:o.clientX,y:o.clientY})}function Ae(o){var t,r;if(Le.value={...Le.value,visible:!1},Ee.value!==null&&(o!=null&&o.target)){const l=o.target;!((t=l.closest)!=null&&t.call(l,".cell-tax-breakdown-popover"))&&!((r=l.closest)!=null&&r.call(l,".cell-tax-breakdown-trigger"))&&f()}}function Gt(){_e(),Ae()}function Kt(){Ce(),Ae()}function Zt(){we(),Ae()}function Qt(){Re(),Ae()}function Jt(o){if(Le.value.visible){Ae();return}switch(o.key){case"ArrowUp":o.preventDefault(),G("up");break;case"ArrowDown":o.preventDefault(),G("down"),ae();break;case"ArrowLeft":o.preventDefault(),G("left");break;case"ArrowRight":o.preventDefault(),G("right");break;case"Tab":o.preventDefault(),G(o.shiftKey?"tabReverse":"tab");break;case"Enter":o.preventDefault(),G("enter"),ae();break}}return _t(()=>{var o;window.addEventListener("click",Ae),(o=vt.value)==null||o.focus()}),Tt(()=>{window.removeEventListener("click",Ae)}),(o,t)=>(a(),s("div",vr,[e("div",{ref_key:"gridRef",ref:vt,class:"data-grid-scroll flex-1 min-h-0 overflow-auto outline-none focus:outline-none focus:ring-0",tabindex:"0",onKeydown:Jt,onContextmenu:Q(Xt,["prevent"])},[e("table",{class:"data-grid-table border-collapse font-mono text-[var(--input-size)]",style:bt({...Ht.value,"--row-header-width":v(Ie)+"px"})},[e("thead",pr,[e("tr",null,[t[13]||(t[13]=e("th",{class:"row-header-th sticky left-0 z-20 border-b border-r border-[var(--color-border)] px-3 py-2 text-[var(--label-size)] font-medium text-[var(--color-text-muted)]"}," # ",-1)),(a(!0),s(F,null,K(v(z),(r,l)=>(a(),s("th",{key:r,class:"border-b border-r border-[var(--color-border)] px-3 py-2 text-left text-[var(--label-size)] font-medium text-[var(--color-text-muted)] whitespace-nowrap",style:bt(At(r))},h(Rt(r)),5))),128)),t[14]||(t[14]=e("th",{class:"data-grid-actions-th border-b border-[var(--color-border)] px-2 py-2 text-[var(--label-size)] font-medium text-[var(--color-text-muted)] w-14"},[e("span",{class:"sr-only"},"Options")],-1))])]),e("tbody",null,[(a(!0),s(F,null,K(Je.value,r=>(a(),s("tr",{key:r,class:"data-grid-row hover:bg-white/[0.04] transition-colors"},[e("td",{class:X(["row-header-td sticky left-0 z-10 border-b border-r border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-2 text-center text-[var(--color-text-muted)] tabular-nums",{"bg-[var(--color-accent-soft)]":v(A)===r}]),onClick:l=>v(fe)(r,0)},h(r+1),11,fr),(a(!0),s(F,null,K(v(z),(l,u)=>(a(),s("td",{key:`${r}-${l}`,class:X(["border-b border-r border-[var(--color-border)] px-3 py-2 text-left whitespace-nowrap",qt(r,u)]),style:bt(At(l)),onClick:b=>Yt(r,u)},[ye.value?(a(),s("span",br,h(Be(r,u)),1)):j(l)?(a(),s("select",{key:1,value:v(B)(r,u),class:"cell-select w-full min-w-0 border-0 bg-transparent text-[var(--color-text)] focus:ring-0 focus:outline-none",onClick:t[0]||(t[0]=Q(()=>{},["stop"])),onChange:b=>v(te)(r,u,b.target.value)},[(a(!0),s(F,null,K(v(qe),b=>(a(),s("option",{key:b,value:b},h(b),9,_r))),128))],40,hr)):q(l)?(a(),s(F,{key:2},[e("div",yr,[e("span",xr,h(Be(r,u)),1),ne(r)?(a(),s("button",{key:0,type:"button",class:"cell-tax-breakdown-trigger shrink-0 p-0.5 rounded text-[var(--color-text-muted)] hover:text-[var(--color-text)] hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-[var(--color-accent)]","aria-label":"Show tax breakdown",onClick:Q(b=>k(r,b),["stop"])},[...t[15]||(t[15]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],8,gr)):R("",!0)]),Ee.value===r?(a(),s("div",{key:0,ref_for:!0,ref_key:"taxBreakdownPopoverRef",ref:c,class:"cell-tax-breakdown-popover",role:"tooltip"},[Ye.value?(a(),s("div",kr,"Loading…")):(a(),s(F,{key:1},[t[16]||(t[16]=e("div",{class:"cell-tax-breakdown-title"},"Tax breakdown",-1)),Z.value.length?(a(),s("ul",wr,[(a(!0),s(F,null,K(Z.value,(b,O)=>(a(),s("li",{key:O},h(b.TaxName)+" — "+h(b.Rate!=null?b.Rate+"%":""),1))),128))])):(a(),s("div",Cr,h(Xe.value||"No taxes recorded for this invoice. Use row menu (⋯) to add tax."),1))],64))],512)):R("",!0)],64)):Ke(l)?(a(),s("span",Rr,h(Be(r,u)),1)):Te(l)?(a(),s("span",Sr,h(Be(r,u)),1)):(a(),s(F,{key:5},[kt(r,u)?(a(),s("input",{key:`input-${r}-${u}`,ref_for:!0,ref_key:"cellInputRef",ref:ue,value:Y.value,type:"text",class:X(["cell-input w-full min-w-0 px-1.5 py-0.5 border-0 rounded bg-transparent text-[var(--color-text)] focus:ring-2 focus:ring-inset focus:outline-none",l==="invoice_number"&&ge.value.has(r)?"focus:ring-red-500 border-red-500/50":"focus:ring-[var(--color-accent)]"]),onInput:b=>Bt(r,u,b.target.value),onBlur:wt,onKeydown:[t[1]||(t[1]=ze(Q(b=>$e("enter"),["prevent"]),["enter"])),t[2]||(t[2]=ze(Q(b=>$e("tab"),["prevent"]),["tab"])),ze(Ct,["escape"]),t[3]||(t[3]=ze(Q(b=>$e("enter"),["prevent"]),["down"])),t[4]||(t[4]=ze(Q(b=>$e("enterReverse"),["prevent"]),["up"])),t[5]||(t[5]=ze(Q(b=>$e("left"),["prevent"]),["left"])),t[6]||(t[6]=ze(Q(b=>$e("right"),["prevent"]),["right"]))]},null,42,$r)):(a(),s("span",{key:1,class:X(["cell-display",{"cell-display--duplicate":l==="invoice_number"&&ge.value.has(r)}])},h(Be(r,u)),3))],64))],14,mr))),128)),e("td",{class:"data-grid-actions-td border-b border-[var(--color-border)] px-2 py-2 w-14 align-middle",onClick:t[9]||(t[9]=Q(()=>{},["stop"]))},[ye.value?R("",!0):(a(),s("div",Tr,[e("button",{type:"button",class:X(["data-grid-row-actions__trigger",{"data-grid-row-actions__trigger--open":pe.value===r}]),"aria-expanded":pe.value===r,"aria-haspopup":"true","aria-label":"Row options",onClick:l=>De(r)},[...t[17]||(t[17]=[e("svg",{class:"data-grid-row-actions__icon",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{d:"M12 10.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 4.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 16.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z"})],-1)])],10,jr),S(Qe,{name:"row-menu"},{default:Fe(()=>[pe.value===r?(a(),s("div",{key:0,class:"data-grid-row-actions__dropdown",role:"menu",onClick:t[8]||(t[8]=Q(()=>{},["stop"]))},[e("div",Nr,[le.value?(a(),s("div",Mr,[t[18]||(t[18]=e("span",{class:"data-grid-row-actions__header-title"},"Tax",-1)),Ge(r)?(a(),s("span",Er,h(Ge(r)),1)):R("",!0)])):R("",!0),le.value===null?(a(),s(F,{key:1},[tt.value?(a(),s("div",Dr,[...t[19]||(t[19]=[e("span",{class:"data-grid-row-actions__state-text"},"Loading…",-1)])])):ie.value.length===0?(a(),s("div",Br,[...t[20]||(t[20]=[e("span",{class:"data-grid-row-actions__state-text"},"No tax types",-1)])])):(a(),s("div",Lr,[e("div",Ar,[t[23]||(t[23]=e("div",{class:"data-grid-row-actions__group-label"},"Set tax",-1)),e("div",Pr,[(a(!0),s(F,null,K(ie.value,l=>(a(),s("button",{key:l.typeKey,type:"button",class:X(["data-grid-row-actions__option",{"data-grid-row-actions__option--expandable":l.items.length>1,"data-grid-row-actions__option--selected":l.items.length===1&&H(r,l.items[0].Tax_Name??"",l.items[0].Tax_Rate)}]),role:"menuitem",onClick:u=>ct(r,l)},[l.items.length===1&&H(r,l.items[0].Tax_Name??"",l.items[0].Tax_Rate)?(a(),s("svg",zr,[...t[21]||(t[21]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),s("span",Or)),e("span",Fr,h(l.typeLabel),1),l.items.length===1?(a(),s("span",Wr,h(ot(l.items[0].Tax_Rate)),1)):(a(),s("svg",Ir,[...t[22]||(t[22]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])]))],10,Vr))),128))])])]))],64)):(a(),s(F,{key:2},[e("button",{type:"button",class:"data-grid-row-actions__back",onClick:t[7]||(t[7]=l=>le.value=null)},[t[24]||(t[24]=e("svg",{class:"data-grid-row-actions__back-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)),e("span",null,h(le.value),1)]),e("div",Ur,[e("div",Hr,[(a(!0),s(F,null,K(E.value,(l,u)=>(a(),s("button",{key:u,type:"button",class:X(["data-grid-row-actions__option",{"data-grid-row-actions__option--selected":H(r,l.Tax_Name??"",l.Tax_Rate)}]),role:"menuitem",onClick:b=>ut(r,l.Tax_Rate,l.Tax_Name??"")},[H(r,l.Tax_Name??"",l.Tax_Rate)?(a(),s("svg",Yr,[...t[25]||(t[25]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),s("span",Xr)),e("span",Gr,h(l.Tax_Name??"—"),1),e("span",Kr,h(ot(l.Tax_Rate)),1)],10,qr))),128))])])],64))])])):R("",!0)]),_:2},1024)]))])]))),128))])],4)],544),C.value>0?(a(),s("div",Zr,[e("div",Qr,[e("span",Jr," Showing "+h(xt.value)+"–"+h(He.value)+" of "+h(C.value)+" row"+h(C.value!==1?"s":""),1),e("label",en,[t[26]||(t[26]=e("span",null,"Rows per page",-1)),e("select",{value:y.value,class:"rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-card)] px-2 py-1.5 text-[var(--color-text)] focus:ring-2 focus:ring-[var(--color-accent)] focus:border-transparent",onChange:t[10]||(t[10]=r=>y.value=Number(r.target.value))},[(a(),s(F,null,K(Ue,r=>e("option",{key:r,value:r},h(r),9,on)),64))],40,tn)])]),e("div",rn,[e("button",{type:"button",class:"pagination-btn rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-1.5 text-[var(--color-text-muted)] hover:bg-white/5 hover:text-[var(--color-text)] disabled:opacity-40 disabled:pointer-events-none transition-colors",disabled:i.value<=1,"aria-label":"Previous page",onClick:t[11]||(t[11]=r=>i.value=Math.max(1,i.value-1))}," Prev ",8,nn),e("span",an," Page "+h(i.value)+" of "+h(se.value),1),e("button",{type:"button",class:"pagination-btn rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-1.5 text-[var(--color-text-muted)] hover:bg-white/5 hover:text-[var(--color-text)] disabled:opacity-40 disabled:pointer-events-none transition-colors",disabled:i.value>=se.value,"aria-label":"Next page",onClick:t[12]||(t[12]=r=>i.value=Math.min(se.value,i.value+1))}," Next ",8,sn)])])):R("",!0),e("div",ln,[e("div",dn,[t[27]||(t[27]=e("span",{class:"entry-total-row__label text-[var(--color-text-muted)] font-medium"},"Entry total",-1)),e("span",cn,h(T.value),1)]),e("span",un,h(v(L).vendor.currency)+" "+h(d(v(p).entryTotal)),1)]),S(ur,{visible:Le.value.visible,x:Le.value.x,y:Le.value.y,onCopy:Gt,onPaste:Kt,onCut:Zt,onClear:Qt},null,8,["visible","x","y"])]))}}),pn=st(vn,[["__scopeId","data-v-8251613f"]]),fn={class:"content-area flex flex-col flex-1 min-h-0 w-full max-w-[1600px] mx-auto px-4 py-5 md:px-6 md:py-6"},mn={class:"flex flex-wrap items-center gap-2 mb-4"},bn={class:"flex flex-1 flex-wrap items-center justify-center gap-2"},hn={key:0,class:"booklet-bar glass-input inline-flex items-center overflow-hidden rounded-full border border-[var(--color-border)]"},_n=["aria-label","aria-current","onClick"],yn=["disabled"],xn=["disabled"],gn=["disabled"],kn={key:0,class:"text-xl font-bold text-[var(--color-text)] tabular-nums tracking-tight"},wn={key:1,class:"text-xl font-bold text-[var(--color-text)] tabular-nums tracking-tight"},Cn={key:0,class:"rejection-history mb-4"},Rn={key:0,class:"rejection-history__skeleton"},Sn={key:1,class:"rejection-history__timeline"},$n={class:"rejection-history__card"},Tn={class:"rejection-history__meta"},jn={class:"rejection-history__num"},Nn={key:0,class:"rejection-history__badge"},Mn={class:"rejection-history__date"},En={key:1,class:"rejection-history__by"},Dn={class:"rejection-history__reason"},Bn={key:1,class:"expiry-check-banner",role:"status"},Ln={class:"expiry-check-banner__content"},An={class:"expiry-check-banner__item-icon","aria-hidden":"true"},Pn={key:0,class:"expiry-check-banner__icon-svg",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},Vn={key:1,class:"expiry-check-banner__icon-svg",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},zn={key:2,class:"expiry-check-banner__icon-placeholder"},On={class:"expiry-check-banner__text"},Fn={class:"expiry-check-banner__item-icon","aria-hidden":"true"},Wn={key:0,class:"expiry-check-banner__icon-svg",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},In={key:1,class:"expiry-check-banner__icon-svg",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},Un={key:2,class:"expiry-check-banner__icon-placeholder"},Hn={class:"expiry-check-banner__text"},qn={key:2,class:"reject-reason-banner",role:"alert"},Yn={class:"reject-reason-banner__content"},Xn={class:"reject-reason-banner__text"},Gn={key:0,class:"expiry-check-banner mb-4"},Kn={class:"expiry-check-banner__content"},Zn={class:"expiry-check-banner__item"},Qn={class:"expiry-check-banner__item"},Jn={class:"vendor-details-row relative mb-4"},ea={class:"glass overflow-hidden rounded-[var(--radius-card)] border border-[var(--color-border)]"},ta={class:"flex w-full items-center justify-between px-4 py-3"},oa={class:"border-t border-[var(--color-border)] px-4 pb-4 pt-3"},ra={class:"grid grid-cols-1 gap-3 sm:gap-4 md:grid-cols-2 lg:grid-cols-3"},na={key:0,type:"button",disabled:"",class:"booklet-circle absolute -left-16 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full flex items-center justify-center glass-input border-2 opacity-30 pointer-events-none","aria-label":"Previous entry"},aa={key:1,type:"button",disabled:"",class:"booklet-circle absolute -right-16 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full flex items-center justify-center glass-input border-2 opacity-30 pointer-events-none","aria-label":"Next entry"},sa={class:"mb-3"},la={class:"glass rounded-xl border border-[var(--color-border)] px-4 py-3 flex items-center gap-3"},ia={class:"mb-3"},da={class:"flex-1 min-h-[360px] flex flex-col min-w-0"},ca={class:"data-grid-wrapper flex flex-col flex-1 min-h-0 rounded-xl border border-[var(--color-border)] bg-[var(--color-bg-card)] shadow-sm overflow-hidden"},ua={class:"data-grid-scroll flex-1 min-h-0 overflow-auto"},va={class:"data-grid-table border-collapse font-mono text-[var(--input-size)] w-full"},pa={class:"sticky top-0 z-10 bg-[var(--color-bg-dark)]"},fa={class:"border-b border-r border-[var(--color-border)] px-3 py-2.5",colspan:"2"},ma={class:"border-b border-r border-[var(--color-border)] px-3 py-2.5",colspan:"4"},ba={class:"row-header-th sticky left-0 z-20 border-b border-r border-[var(--color-border)] px-3 py-2"},ha={class:"row-header-td sticky left-0 z-10 border-b border-r border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-2 text-center"},_a={class:"border-b border-[var(--color-border)] px-2 py-2 w-14"},ya={class:"vendor-details-row relative mb-4"},xa=["disabled"],ga=["disabled"],ka={class:"mb-3"},wa={class:"flex-1 min-h-[360px] flex flex-col min-w-0"},Ft=60,Ca=We({__name:"EntryView",setup($){const x=so(),p=lo(),L=N(()=>{const c=x.query.from;return c==="invoices"?{name:"invoices"}:c==="cheque-collection"?{name:"cheque-collection"}:co()}),_=Ut(),d=yt(),T=jt(),g=to(),{isConnected:M,updateRecord:ce,createRecord:P,findRecordsByQueryWithIds:V}=Mt(),D=It(),z=uo(),{roleLower:Ie,userFullName:ee}=oo(),A=w(!1),W=w(!1),B=w(!1),te=N(()=>_.rowCount.value>1),ke=N(()=>Ie.value==="manager"||Ie.value==="admin"),fe=N(()=>{if(!d.currentTransRef)return!1;const c=d.mainStatus;return c==="Draft"||c==="Rejected"||c==="Posted"}),G=N(()=>d.mainExpiryCheckDis??"—"),ae=N(()=>d.mainWhtExpiryCheckDis??"—");function _e(c,n){if(c){const f=c.toLowerCase().trim();if(f==="invalid"||f==="expired"||f==="no")return!0;if(f==="valid"||f==="ok"||f==="yes"||f==="good")return!1}const m=n!=null&&n!=="—"?String(n).toLowerCase():"";return m?!!(m.includes("invalid")||m.includes("expired")||/\bno\b/.test(m)):!1}function we(c,n){if(c){const f=c.toLowerCase().trim();if(f==="valid"||f==="ok"||f==="yes"||f==="good")return!0;if(f==="invalid"||f==="expired"||f==="no")return!1}const m=n!=null&&n!=="—"?String(n).toLowerCase():"";return!m||m.includes("invalid")||m.includes("expired")||/\bno\b/.test(m)?!1:!!(m.includes("valid")||m.includes("ok")||m.includes("yes")||m.includes("good"))}const Ce=w("next"),Re=N(()=>Ce.value==="next"?"booklet-next":"booklet-prev");function Ue(c){if(!(c!=null&&c.trim()))return"";const n=c.trim(),m=/^(\d{1,2})\/(\d{1,2})\/(\d{4})\s+(\d{1,2}):(\d{2}):(\d{2})/.exec(n);if(m){const[,f,k,U,oe,re]=m,be=parseInt(oe,10),ie=be>=12?"PM":"AM",E=be%12||12;return`${f}/${k}/${U} ${E}:${re} ${ie}`}return n}function y(){const c=x.query.transRef;if(c!=null&&c.trim())d.fetchDetailsByTransRef(c.trim());else{d.clearAll(),T.reset();const n=new Date,m=n.getFullYear(),f=String(n.getMonth()+1).padStart(2,"0"),k=String(n.getDate()).padStart(2,"0");T.setField("payment_terms",`${m}-${f}-${k}`)}}function i(){var n;const c=(n=x.query.transRef)==null?void 0:n.trim();if(c&&d.currentTransRef===c){if(g.mode==="rejected"){g.ensureCurrent(c);return}d.mainPosted?g.removeByRef(c):g.ensureCurrent(c)}}function C(c){const n={transRef:c},m=x.query.from;return(m==="invoices"||m==="cheque-collection")&&(n.from=m),{name:"entry",query:n}}function se(){if(!g.hasPrev)return;Ce.value="prev",g.goPrev();const c=g.currentTransRef;c&&p.push(C(c))}function Je(){if(!g.hasNext)return;Ce.value="next",g.goNext();const c=g.currentTransRef;c&&p.push(C(c))}function xt(c){if(c===g.currentOpenIndex)return;Ce.value=c>g.currentOpenIndex?"next":"prev",g.setCurrentIndex(c);const n=g.currentTransRef;n&&p.push(C(n))}_t(y);const He=w(!1),qe=w(!1),ye=w([]),me=w(!1);async function lt(){const c=d.currentTransRef;if(!(c!=null&&c.trim())||!d.mainPosted||!M.value){ye.value=[],me.value=!1;return}me.value=!0;const{data:n,error:m}=await V(de.PAYABLES_REJECTION_HISTORY,{TransRef:c},50);if(m||!(n!=null&&n.length))ye.value=[];else{const f=n.map(k=>k.fieldData).filter(Boolean).map(k=>{const U=k;return{RejectedDate:k.RejectedDate??U["Rejected date"],RejectedBy:k.RejectedBy??U["Rejected by"],Reason:k.Reason??U.Reason}});f.sort((k,U)=>{const oe=k.RejectedDate??"";return(U.RejectedDate??"").localeCompare(oe)}),ye.value=f}me.value=!1}let xe=null;ro((c,n,m)=>{d.isDirty?(He.value=!0,xe=m):m()});function Se(){xe&&(xe(),xe=null),He.value=!1}function pe(){xe&&(xe(!1),xe=null),He.value=!1}ve(()=>x.query.transRef,y),ve(M,c=>{c&&x.query.transRef&&y()}),ve(()=>[x.query.transRef,d.currentTransRef,d.mainPosted],()=>i(),{immediate:!0}),ve(()=>[d.currentTransRef,d.mainPosted,d.loading],([c,n,m])=>{!m&&c&&n?lt():ye.value=[]},{immediate:!0});function le(){_.deleteRow(_.selectedRow.value)}const ge=w(0);function et(c){g.count<=1||(ge.value=c.touches[0].clientX)}function Me(c){if(g.count<=1)return;const m=c.changedTouches[0].clientX-ge.value;m>Ft&&g.hasPrev?se():m<-Ft&&g.hasNext&&Je()}function it(c){qe.value=!1,tt(c)}async function tt(c){const n=d.currentTransRef,m=d.currentMainRecordId;if(!(!n||!m||!M.value)){A.value=!0;try{const{error:f}=await ce(de.PAYABLES_MAIN,m,{Rejected:"Yes",RejectReason:c.trim()},{allowEmptyStrings:!1});if(f){D.error("Reject failed: "+f);return}const k=(ee.value||"").trim()||"Manager",{error:U}=await P(de.PAYABLES_REJECTION_HISTORY,{TransRef:n,RejectedDate:io(),RejectedBy:k,Reason:c.trim()});U&&D.error("Rejected but failed to record history: "+U);const oe=await zt(P,n,"Rejected",k,c.trim());oe&&D.error("Rejected but failed to record activity: "+oe),D.success("Entry rejected."),await d.fetchDetailsByTransRef(n),p.push(L.value)}finally{A.value=!1}}}async function Ee(){const c=d.currentMainRecordId,n=d.currentTransRef;if(!(!c||!M.value||!n)){W.value=!0;try{const m=(ee.value||"").trim()||"Manager",{error:f}=await ce(de.PAYABLES_MAIN,c,{Approved:"Yes",ApprovedDate:no(),ApprovedBy:m});if(f){D.error("Approve failed: "+f);return}const k=await zt(P,n,"Approved",m);k&&D.error("Approved but failed to record activity: "+k),D.success("Entry approved."),await d.fetchDetailsByTransRef(n),p.push(L.value)}finally{W.value=!1}}}function Z(c){const n=typeof c=="number"?c:parseFloat(String(c).replace(/,/g,""));return Number.isNaN(n)?String(c??"—"):n.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function Ye(c,n=""){const m=Math.floor(c),f=Math.round((c-m)*100),k=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],U=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],oe=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];function re(E){return E===0?"Zero":E<10?k[E]:E<20?U[E-10]:E<100?(oe[Math.floor(E/10)]+" "+k[E%10]).trim():E<1e3?(k[Math.floor(E/100)]+" Hundred "+re(E%100)).trim():E<1e6?(re(Math.floor(E/1e3))+" Thousand "+re(E%1e3)).trim():E<1e9?(re(Math.floor(E/1e6))+" Million "+re(E%1e6)).trim():String(E)}const be=m===0?"Zero":re(m),ie=n?` ${n}`:"";return f===0?`${be}${ie} only`:`${be}${ie} and ${f}/100`}async function Xe(){var f,k,U,oe,re,be;const c=d.mainStatus,n=z.invoiceDownloadWhen;if(d.mainPosted&&(n==="approved_only"?c==="Approved":n==="once_posted"&&(c==="Posted"||c==="Approved"))){B.value=!0;try{let ie=function(j){const q=(j.invoice_number??"").trim();if(!q)return"—";const ne=pt.get(q);return ne!=null&&ne.length?ne.map(Te=>{const Ze=Number(Te.Rate??0),Be=(Te.TaxName??"").trim()||"Tax",mt=Ze!==0?`${Ze}%`:"";return`${Be}${mt?` ${mt}`:""}`}).join(", "):"—"};const[E,ot]=await Promise.all([Ot(()=>import("./pdfmake-B32-QUBv.js").then(j=>j.p),__vite__mapDeps([0,1])),Ot(()=>import("./vfs_fonts-D-4-wbPz.js").then(j=>j.v),__vite__mapDeps([2,1]))]),Ge=E.default??E,dt=ot.default??ot;Ge.addVirtualFileSystem&&dt&&Ge.addVirtualFileSystem(dt);const De=((f=d.currentTransRef)==null?void 0:f.trim())??"",H=T.vendor,ct=typeof d.entryTotal=="number"?d.entryTotal:0,gt=Z(ct),ut=(H.currency?`${H.currency} `:"")+gt,rt=new Date().toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),vt=[De,H.vendor_id,H.vendor_name].filter(Boolean).join("  ·  ")||"—",ue=Ye(ct,H.currency||""),Y=d.rows.filter(j=>(j.invoice_number??"").trim()!==""||(j.amount??"").trim()!==""||(j.total??"").trim()!==""),kt=Y.reduce((j,q)=>{const ne=parseFloat(String(q.amount??"").replace(/,/g,""));return j+(Number.isNaN(ne)?0:ne)},0),nt=Y.reduce((j,q)=>{const ne=parseFloat(String(q.tax??"").replace(/,/g,""));return j+(Number.isNaN(ne)?0:ne)},0),wt=(H.currency?`${H.currency} `:"")+Z(kt),Bt=(H.currency?`${H.currency} `:"")+Z(nt),he=[...new Set(Y.map(j=>(j.invoice_number??"").trim()).filter(Boolean))],pt=new Map;M.value&&he.length>0&&(await Promise.all(he.map(q=>V(de.PAYABLE_INVOICE,{invoiceNumber:q},100)))).forEach((q,ne)=>{var Te;const Ke=he[ne];Ke&&((Te=q.data)!=null&&Te.length)&&pt.set(Ke,q.data.map(Ze=>Ze.fieldData).filter(Boolean))});const $e=[[{text:"Invoice No.",fillColor:"#ebebeb",bold:!0},{text:"Amount",fillColor:"#ebebeb",bold:!0,alignment:"right"},{text:"Tax",fillColor:"#ebebeb",bold:!0,alignment:"right"},{text:"Tax Amount",fillColor:"#ebebeb",bold:!0,alignment:"right"},{text:"Tax breakdown",fillColor:"#ebebeb",bold:!0,fontSize:9},{text:"Total",fillColor:"#ebebeb",bold:!0,alignment:"right"}],...Y.map(j=>{const q=(j.reference??"").trim()||(j.tax??"");return[(j.invoice_number??"").trim()||"—",{text:Z(j.amount??""),alignment:"right"},{text:Z(j.tax??""),alignment:"right"},{text:Z(q),alignment:"right"},{text:ie(j),fontSize:9},{text:Z(j.total??""),alignment:"right"}]})],Ct=De?`APPROVED · ${De}`:"APPROVED",ft={pageSize:"A4",pageOrientation:"landscape",pageMargins:[40,50,40,70],defaultStyle:{fontSize:10,color:"#000"},watermark:{text:Ct,color:"#b0b0b0",opacity:.12,bold:!0,angle:-45},content:[{columns:[{text:"Invoice Payment - PDF",fontSize:15,bold:!0},{text:rt.toUpperCase(),fontSize:10,alignment:"right",width:"*"}],margin:[0,0,0,10]},{canvas:[{type:"line",x1:0,y1:0,x2:762,y2:0}],margin:[0,4,0,10]},{text:vt,alignment:"center",bold:!0,fontSize:12,margin:[0,0,0,6]},{table:{widths:[120,"*"],body:[[{text:"Vendor ID",bold:!0,fillColor:"#f5f5f5"},((k=H.vendor_id)==null?void 0:k.trim())||"—"],[{text:"Vendor name",bold:!0,fillColor:"#f5f5f5"},((U=H.vendor_name)==null?void 0:U.trim())||"—"],[{text:"Date",bold:!0,fillColor:"#f5f5f5"},((oe=H.payment_terms)==null?void 0:oe.trim())||rt],[{text:"Email",bold:!0,fillColor:"#f5f5f5"},((re=H.contact_email)==null?void 0:re.trim())||"—"],[{text:"Currency",bold:!0,fillColor:"#f5f5f5"},((be=H.currency)==null?void 0:be.trim())||"—"]]},layout:{hLineWidth:()=>.2,vLineWidth:()=>.2},margin:[0,0,0,12]},{canvas:[{type:"line",x1:0,y1:0,x2:762,y2:0}],margin:[0,0,0,12]},{table:{headerRows:1,widths:[110,95,90,95,"*",100],body:$e},layout:{hLineWidth:()=>.25,vLineWidth:()=>.25},margin:[0,0,0,14]},{columns:[{width:"*",stack:[{text:"Amount in words",bold:!0,fontSize:9,margin:[0,0,0,4]},{text:ue,fontSize:10}],fillColor:"#f8f8f8",margin:[0,4,8,4]},{width:240,table:{widths:[130,"*"],body:[[{text:"Sub Total (excl. tax)",fontSize:9,fillColor:"#f5f5f5"},{text:wt,fontSize:9,alignment:"right",fillColor:"#f5f5f5"}],[{text:"Total Tax",fontSize:9,fillColor:"#f5f5f5"},{text:Z(nt),fontSize:9,alignment:"right",fillColor:"#f5f5f5"}],[{text:"Advance Payment",fontSize:9,fillColor:"#f5f5f5"},{text:"—",fontSize:9,alignment:"right",fillColor:"#f5f5f5"}],[{text:"Amount to Pay",fontSize:9,bold:!0,fillColor:"#f5f5f5"},{text:ut,fontSize:9,bold:!0,alignment:"right",fillColor:"#f5f5f5"}]]},layout:{hLineWidth:()=>.2,vLineWidth:()=>.2}}]}],footer:(j,q)=>({margin:[40,10,40,0],stack:[{text:`PAGE ${j} of ${q}`,fontSize:9,alignment:"center"},{text:"Finance Payables  ·  "+new Date().toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}),fontSize:8,alignment:"center",margin:[0,2,0,0]}]})},Rt=De?`Approved-Payable-${De.replace(/[/\\?%*:|"<>]/g,"-")}.pdf`:"Approved-Payable.pdf";Ge.createPdf(ft).download(Rt),D.success("PDF downloaded.")}catch(ie){const E=ie instanceof Error?ie.message:"PDF download failed.";D.error(E)}finally{B.value=!1}}}return(c,n)=>{const m=ao("router-link");return a(),s("div",fn,[S(Zo,{visible:He.value,onConfirm:Se,onCancel:pe},null,8,["visible"]),S(rr,{visible:qe.value,onSubmit:it,onCancel:n[0]||(n[0]=f=>qe.value=!1)},null,8,["visible"]),e("div",mn,[S(m,{to:L.value,class:"pill-btn glass-input inline-flex items-center gap-2 rounded-2xl border border-[var(--color-border)] bg-white/5 px-4 py-2.5 text-[var(--label-size)] font-medium text-[var(--color-text-muted)] no-underline transition-colors hover:bg-white/10 hover:text-[var(--color-text)]"},{default:Fe(()=>[...n[3]||(n[3]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),J(" Back to list ",-1)])]),_:1},8,["to"]),e("div",bn,[v(g).count>1?(a(),s("div",hn,[(a(!0),s(F,null,K(v(g).openEntryRefs,(f,k)=>(a(),s("button",{key:f,type:"button",class:X(["booklet-page-btn min-w-[2rem] px-2.5 py-2 text-[var(--label-size)] font-medium transition-colors",k===v(g).currentOpenIndex?"bg-[var(--color-accent-soft)] text-[var(--color-accent)]":"text-[var(--color-text-muted)] hover:bg-white/5 hover:text-[var(--color-text)]"]),"aria-label":`Entry ${k+1} of ${v(g).count}`,"aria-current":k===v(g).currentOpenIndex?"true":void 0,onClick:U=>xt(k)},h(k+1),11,_n))),128))])):R("",!0),ke.value&&v(d).mainPosted&&v(d).mainStatus==="Posted"&&v(d).currentMainRecordId?(a(),s(F,{key:1},[e("button",{type:"button",class:"pill-btn glass-input inline-flex items-center gap-2 !rounded-xl border border-[var(--color-border)] bg-white/5 px-6 py-2.5 text-[var(--label-size)] font-medium text-[var(--color-text-muted)] transition-colors hover:bg-white/10 hover:text-[var(--color-text)] disabled:opacity-50 disabled:cursor-not-allowed",disabled:A.value||W.value,onClick:n[1]||(n[1]=f=>qe.value=!0)},[n[4]||(n[4]=e("svg",{class:"h-4 w-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)),J(" "+h(A.value?"Rejecting…":"Reject"),1)],8,yn),e("button",{type:"button",class:"pill-btn inline-flex items-center gap-2 !rounded-xl border-0 bg-emerald-600 px-6 py-2.5 text-[var(--label-size)] font-medium text-white transition-colors hover:bg-emerald-500 disabled:opacity-50 disabled:cursor-not-allowed",disabled:A.value||W.value,onClick:Ee},[n[5]||(n[5]=e("svg",{class:"h-4 w-4 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1)),J(" "+h(W.value?"Approving…":"Approve"),1)],8,xn)],64)):R("",!0),v(z).invoiceDownloadWhen!=="none"&&v(d).mainPosted&&(v(z).invoiceDownloadWhen==="once_posted"&&(v(d).mainStatus==="Posted"||v(d).mainStatus==="Approved")||v(z).invoiceDownloadWhen==="approved_only"&&v(d).mainStatus==="Approved")?(a(),s("button",{key:2,type:"button",class:"pill-btn inline-flex items-center gap-2 rounded-full bg-slate-600 px-4 py-2.5 text-[var(--label-size)] font-semibold text-white shadow-md hover:bg-slate-500 transition-colors",disabled:B.value,onClick:Xe},[n[6]||(n[6]=e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)),J(" "+h(B.value?"Downloading…":"Download PDF"),1)],8,gn)):R("",!0)]),v(d).loading?(a(),s("span",kn,[S(I,{width:"8rem",height:"1.5rem"})])):v(d).currentTransRef?(a(),s("span",wn,h(v(d).currentTransRef),1)):R("",!0)]),v(d).mainPosted&&v(d).mainStatus==="Posted"&&ye.value.length>0?(a(),s("section",Cn,[n[9]||(n[9]=Vt('<header class="rejection-history__header" data-v-3d002640><div class="rejection-history__header-inner" data-v-3d002640><svg class="rejection-history__icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-3d002640><circle cx="12" cy="12" r="10" data-v-3d002640></circle><polyline points="12 6 12 12 16 14" data-v-3d002640></polyline></svg><div data-v-3d002640><h3 class="rejection-history__title" data-v-3d002640>Rejection history</h3><p class="rejection-history__subtitle" data-v-3d002640> Prior rejections for this entry. Officer has since resubmitted. </p></div></div></header>',1)),me.value?(a(),s("div",Rn,[(a(),s(F,null,K(2,f=>e("div",{key:f,class:"rejection-history__skeleton-item"},[...n[7]||(n[7]=[e("div",{class:"rejection-history__skeleton-dot"},null,-1),e("div",{class:"rejection-history__skeleton-content"},[e("div",{class:"rejection-history__skeleton-line",style:{width:"45%"}}),e("div",{class:"rejection-history__skeleton-line",style:{width:"80%"}})],-1)])])),64))])):(a(),s("ul",Sn,[(a(!0),s(F,null,K(ye.value,(f,k)=>(a(),s("li",{key:k,class:"rejection-history__item"},[n[8]||(n[8]=e("span",{class:"rejection-history__line"},null,-1)),e("span",{class:X(["rejection-history__dot",{"rejection-history__dot--first":k===0}]),"aria-hidden":"true"},null,2),e("div",$n,[e("div",Tn,[e("span",jn,"#"+h(k+1),1),k===0?(a(),s("span",Nn,"Most recent")):R("",!0),e("span",Mn,h(Ue(f.RejectedDate)),1),f.RejectedBy?(a(),s("span",En,"by "+h(f.RejectedBy),1)):R("",!0)]),e("p",Dn,h(f.Reason),1)])]))),128))]))])):R("",!0),fe.value?(a(),s("div",Bn,[n[16]||(n[16]=Vt('<span class="expiry-check-banner__icon" aria-hidden="true" data-v-3d002640><svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-3d002640><rect x="3" y="4" width="18" height="18" rx="2" ry="2" data-v-3d002640></rect><line x1="16" y1="2" x2="16" y2="6" data-v-3d002640></line><line x1="8" y1="2" x2="8" y2="6" data-v-3d002640></line><line x1="3" y1="10" x2="21" y2="10" data-v-3d002640></line></svg></span>',1)),e("div",Ln,[G.value?(a(),s("div",{key:0,class:X(["expiry-check-banner__item",{"expiry-check-banner__item--invalid":_e(v(d).mainExpiryCheck,G.value),"expiry-check-banner__item--valid":we(v(d).mainExpiryCheck,G.value)}])},[e("span",An,[_e(v(d).mainExpiryCheck,G.value)?(a(),s("svg",Pn,[...n[10]||(n[10]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 9l-6 6M9 9l6 6"},null,-1)])])):we(v(d).mainExpiryCheck,G.value)?(a(),s("svg",Vn,[...n[11]||(n[11]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):(a(),s("span",zn))]),n[12]||(n[12]=e("strong",{class:"expiry-check-banner__label"},"GRA Expiry:",-1)),e("span",On,h(G.value),1)],2)):R("",!0),ae.value?(a(),s("div",{key:1,class:X(["expiry-check-banner__item",{"expiry-check-banner__item--invalid":_e(v(d).mainWhtExpiryCheck,ae.value),"expiry-check-banner__item--valid":we(v(d).mainWhtExpiryCheck,ae.value)}])},[e("span",Fn,[_e(v(d).mainWhtExpiryCheck,ae.value)?(a(),s("svg",Wn,[...n[13]||(n[13]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 9l-6 6M9 9l6 6"},null,-1)])])):we(v(d).mainWhtExpiryCheck,ae.value)?(a(),s("svg",In,[...n[14]||(n[14]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"},null,-1)])])):(a(),s("span",Un))]),n[15]||(n[15]=e("strong",{class:"expiry-check-banner__label"},"WHT Expiry:",-1)),e("span",Hn,h(ae.value),1)],2)):R("",!0)])])):R("",!0),v(d).mainStatus==="Rejected"&&(v(d).mainRejectReason||"").trim()?(a(),s("div",qn,[n[18]||(n[18]=e("span",{class:"reject-reason-banner__icon","aria-hidden":"true"},[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 8v4M12 16h.01"})])],-1)),e("div",Yn,[n[17]||(n[17]=e("strong",{class:"reject-reason-banner__label"},"Rejection reason",-1)),e("p",Xn,h(v(d).mainRejectReason),1)])])):R("",!0),e("div",{class:X(["booklet-flip-view",{"booklet-flip-view--swipeable":v(g).count>1}]),onTouchstart:et,onTouchend:Me},[S(Qe,{name:Re.value,mode:"out-in"},{default:Fe(()=>[v(d).loading?(a(),s("div",{key:`loading-${v(x).query.transRef||"new"}`,class:"entry-page flex flex-col flex-1 min-h-0"},[v(x).query.transRef?(a(),s("div",Gn,[n[19]||(n[19]=e("span",{class:"expiry-check-banner__icon opacity-60","aria-hidden":"true"},[e("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e("line",{x1:"16",y1:"2",x2:"16",y2:"6"}),e("line",{x1:"8",y1:"2",x2:"8",y2:"6"}),e("line",{x1:"3",y1:"10",x2:"21",y2:"10"})])],-1)),e("div",Kn,[e("div",Zn,[S(I,{width:"1.25rem",height:"1.25rem"}),S(I,{width:"5.5rem",height:"0.9rem"}),S(I,{width:"12rem",height:"1.25rem"})]),e("div",Qn,[S(I,{width:"1.25rem",height:"1.25rem"}),S(I,{width:"5.5rem",height:"0.9rem"}),S(I,{width:"18rem",height:"1.25rem"})])])])):R("",!0),e("div",Jn,[e("section",ea,[e("div",ta,[S(I,{width:"7rem",height:"1.125rem"}),S(I,{width:"1.25rem",height:"1.25rem"})]),e("div",oa,[e("div",ra,[(a(),s(F,null,K(6,f=>e("div",{key:f,class:"block"},[S(I,{width:"6rem",height:"0.813rem",class:"mb-1"}),S(I,{width:"100%",height:"2.5rem"})])),64))])])]),v(g).count>1?(a(),s("button",na,[...n[20]||(n[20]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])])):R("",!0),v(g).count>1?(a(),s("button",aa,[...n[21]||(n[21]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])):R("",!0)]),e("div",sa,[e("div",la,[S(I,{width:"6rem",height:"2.25rem"}),S(I,{width:"6rem",height:"2.25rem"})])]),e("div",ia,[S(I,{width:"100%",height:"0.813rem",class:"max-w-[600px]"})]),e("div",da,[e("div",ca,[e("div",ua,[e("table",va,[e("thead",pa,[e("tr",null,[n[22]||(n[22]=e("th",{class:"row-header-th sticky left-0 z-20 border-b border-r border-[var(--color-border)] px-3 py-2.5"},null,-1)),e("th",fa,[S(I,{width:"5rem",height:"0.813rem"})]),e("th",ma,[S(I,{width:"6rem",height:"0.813rem"})]),n[23]||(n[23]=e("th",{class:"border-b border-[var(--color-border)] px-2 py-2 w-14"},null,-1))]),e("tr",null,[e("th",ba,[S(I,{width:"1rem",height:"0.813rem"})]),(a(),s(F,null,K(6,f=>e("th",{key:f,class:"border-b border-r border-[var(--color-border)] px-3 py-2"},[S(I,{width:"4rem",height:"0.813rem"})])),64)),n[24]||(n[24]=e("th",{class:"border-b border-[var(--color-border)] px-2 py-2 w-14"},null,-1))])]),e("tbody",null,[(a(),s(F,null,K(5,f=>e("tr",{key:f,class:"data-grid-row"},[e("td",ha,[S(I,{width:"1.5rem",height:"0.938rem"})]),(a(),s(F,null,K(6,k=>e("td",{key:k,class:"border-b border-r border-[var(--color-border)] px-3 py-2"},[S(I,{width:"5rem",height:"0.938rem"})])),64)),e("td",_a,[S(I,{width:"2.5rem",height:"2.5rem",class:"rounded-[10px]"})])])),64))])])])])])])):(a(),s("div",{key:`entry-${v(x).query.transRef||"new"}`,class:"entry-page flex flex-col flex-1 min-h-0"},[e("div",ya,[S(Xo),v(g).count>1?(a(),s("button",{key:0,type:"button",disabled:!v(g).hasPrev,class:"booklet-circle absolute -left-16 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full flex items-center justify-center glass-input border-2 text-orange-400/90 hover:text-orange-400 hover:bg-orange-500/10 border-orange-500/70 hover:border-orange-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:ring-offset-2 focus:ring-offset-[var(--color-bg)] disabled:opacity-30 disabled:pointer-events-none disabled:border-[var(--color-border)] disabled:text-[var(--color-text-muted)] transition-all shadow-lg","aria-label":"Previous entry",onClick:se},[...n[25]||(n[25]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],8,xa)):R("",!0),v(g).count>1?(a(),s("button",{key:1,type:"button",disabled:!v(g).hasNext,class:"booklet-circle absolute -right-16 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full flex items-center justify-center glass-input border-2 text-orange-400/90 hover:text-orange-400 hover:bg-orange-500/10 border-orange-500/70 hover:border-orange-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:ring-offset-2 focus:ring-offset-[var(--color-bg)] disabled:opacity-30 disabled:pointer-events-none disabled:border-[var(--color-border)] disabled:text-[var(--color-text-muted)] transition-all shadow-lg","aria-label":"Next entry",onClick:Je},[...n[26]||(n[26]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,ga)):R("",!0)]),e("div",ka,[S(sr,{"can-delete-row":te.value,onAddRow:n[2]||(n[2]=f=>v(_).addRow()),onDeleteRow:le},null,8,["can-delete-row"])]),n[27]||(n[27]=e("p",{class:"mb-3 text-[var(--label-size)] text-[var(--color-text-muted)]"},[e("strong",{class:"text-[var(--color-text)]"},"Required to save:"),J(" Fill "),e("span",{class:"text-red-400/90"},"*"),J(" Vendor name or Vendor ID above; in the grid, each row must have at least one of: Invoice Number, Amount, or Total. ")],-1)),e("div",wa,[S(pn)])]))]),_:1},8,["name"])],34)])}}}),Ta=st(Ca,[["__scopeId","data-v-3d002640"]]);export{Ta as default};
