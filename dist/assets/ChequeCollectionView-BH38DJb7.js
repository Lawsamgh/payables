import{C as ye,d as Ge,u as Xe,a5 as Je,r as f,H as le,o as qe,a as et,c as r,e as t,g as h,h as Be,s as ne,f as ve,p as I,v as E,q as y,t as u,F as me,B as pe,I as Ie,w as se,S as tt,m as lt,R as at,i as j,L as D,M as ot,x as nt,j as s,a4 as fe,N as b,U as st,_ as rt}from"./index-B7jQKMlp.js";import"./useSpreadsheet-PoyIU8AQ.js";function it(v){if(v==null)return"";const m=String(v);return m.includes(",")||m.includes('"')||m.includes(`
`)||m.includes("\r")?'"'+m.replace(/"/g,'""')+'"':m}function ut(v,m){const x="\uFEFF",_=new Blob([x+m],{type:"text/csv;charset=utf-8"}),V=URL.createObjectURL(_),A=document.createElement("a");A.href=V,A.download=v,A.click(),URL.revokeObjectURL(V)}const Ee=[{key:"TransRef",label:"TransRef"},{key:"BankName",altKey:"Bank Name",label:"Bank"},{key:"ChequeNo",altKey:"Cheque No",label:"Cheque No"},{key:"Amount",label:"Amount"},{key:"ChequePayee",altKey:"Cheque Payee",label:"Cheque Payee"},{key:"ReceivedBy",altKey:"Received By",label:"Received By"},{key:"IDNo",altKey:"ID No",label:"ID No"},{key:"Contact",label:"Contact"},{key:"TinNo",altKey:"Tin No",label:"Tin No"},{key:"CollectionDate",altKey:"Collection Date",label:"Collection Date"},{key:"IssuedBy",altKey:"Issued By",label:"Issued By"}];function dt(v,m,x){const _=v[m]??v[x??""];return _!=null&&_!==""?String(_).trim():""}function ct(v){if(v==null||v==="")return"";const m=typeof v=="number"?v:parseFloat(String(v));return Number.isNaN(m)?"":ye(m)}const vt=new Set(["IDNo","TinNo","ChequeNo"]);function mt(v,m){if(v.key==="Amount"){const _=m[v.key]??m[v.altKey??""];return ct(_)}const x=dt(m,v.key,v.altKey);return x&&vt.has(v.key)?"	"+x:x}function pt(v,m="csv"){const x=Ee.map(C=>C.label),_=v.map(C=>{const ae=C.fieldData??{};return Ee.map(q=>it(mt(q,ae))).join(",")}),V=[x.join(","),..._].join(`\r
`),re=`cheque-collections-${new Date().toISOString().slice(0,10)}.csv`;ut(re,V)}const ft={class:"content-area flex flex-col flex-1 min-h-0 w-full max-w-[1600px] mx-auto px-4 py-5 md:px-6 md:py-6"},ht={class:"flex flex-wrap items-center justify-between gap-4 mb-6"},yt={class:"flex flex-wrap items-center gap-3"},bt={class:"flex flex-wrap items-center gap-2"},_t=["disabled"],xt={key:0,class:"tax-search-bar"},Ct={class:"tax-search-bar__row"},gt={key:0,class:"tax-search-bar__hint"},kt={class:"tax-table-wrap"},wt={key:0,class:"tax-table-skeleton"},Nt={class:"tax-table-skeleton__search"},Rt={class:"tax-table"},St={key:1,class:"tax-table-error"},Tt={key:2,class:"tax-table-empty"},Dt={key:3,class:"tax-table-empty"},qt={key:4},Bt={class:"tax-table-scroll"},It={class:"tax-table"},Et={class:"cheque-table-actions"},At={key:1,class:"text-[var(--color-text-muted)]"},Pt={class:"cheque-table-actions"},Lt=["onClick"],Mt={key:1,class:"text-[var(--color-text-muted)]"},Vt={key:0,class:"pagination"},$t=["disabled"],Ft={class:"pagination__label"},Ut=["disabled"],jt={key:0,class:"tax-modal-backdrop"},zt={class:"tax-modal cheque-modal",role:"dialog","aria-labelledby":"add-collection-title","aria-modal":"true"},Ot={class:"tax-modal__header"},Kt={id:"add-collection-title",class:"tax-modal__title"},Yt={key:0,class:"tax-modal__error",role:"alert"},Ht={class:"tax-modal__error-text"},Qt={class:"tax-modal__section"},Wt={key:0,class:"text-2xl font-semibold text-[var(--color-text)] mb-4"},Zt={key:1,class:"text-[var(--label-size)] text-[var(--color-text-muted)] mb-3"},Gt={key:2,class:"tax-modal__label"},Xt={key:0,class:"flex-1 min-w-0 text-[var(--color-text)] truncate text-[var(--label-size)]"},Jt={class:"font-semibold"},el={key:1,class:"flex-1 min-w-0 text-[var(--color-text-muted)]"},tl={class:"payable-select-search"},ll={key:0,class:"payable-select-hint"},al={class:"payable-select-list",role:"listbox","aria-label":"Select payable"},ol=["aria-selected","onClick"],nl={class:"payable-select-item__ref"},sl={class:"payable-select-item__vendor"},rl={class:"payable-select-item__amount"},il={key:0,class:"payable-select-item payable-select-item--empty"},ul={key:1,class:"payable-select-item payable-select-item--empty"},dl={key:2,class:"payable-select-item payable-select-item--empty"},cl={class:"tax-modal__row"},vl={class:"tax-modal__label"},ml={class:"tax-modal__label"},pl={class:"tax-modal__row"},fl={class:"tax-modal__label"},hl=["value"],yl={class:"tax-modal__label"},bl={class:"tax-modal__section"},_l={class:"tax-modal__row"},xl={class:"tax-modal__label"},Cl={class:"tax-modal__label"},gl={class:"tax-modal__label"},kl={class:"tax-modal__section"},wl={class:"tax-modal__row"},Nl={class:"tax-modal__label"},Rl={class:"tax-modal__label"},Sl={class:"tax-modal__actions"},Tl=["disabled"],he=10,Dl=Ge({__name:"ChequeCollectionView",setup(v){const{createRecord:m,findRecordsWithIds:x,findRecordsByQueryWithIds:_,updateRecord:V,isConnected:A,loggedInEmail:re}=nt(),C=Xe(),ae=Je(),q=f([]),O=f(!0),K=f(null),z=f(!1),N=f(null),R=f(""),P=f(null),Y=f(!1),H=f([]),B=f(""),g=f(!1),Q=f(!1),be=f(null),_e=f(null),W=f(""),Z=f("");function G(){const l=new Date,e=l.getFullYear(),o=String(l.getMonth()+1).padStart(2,"0"),a=String(l.getDate()).padStart(2,"0");return`${e}-${o}-${a}`}function Ae(l){const e=X(l,"CollectionDate");if(!e)return!1;const o=G(),d=e.replace(/\//g,"-").match(/^(\d{4})-(\d{1,2})-(\d{1,2})/);if(d){const[,c,k,p]=d;return`${c}-${k.padStart(2,"0")}-${p.padStart(2,"0")}`===o}const i=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(i){const[,c,k,p]=i;return`${p}-${c.padStart(2,"0")}-${k.padStart(2,"0")}`===o}return!1}const n=f({TransRef:"",BankName:"",ChequeNo:"",Amount:"",ChequePayee:"",ReceivedBy:"",IDNo:"",Contact:"",TinNo:"",CollectionDate:G()});function X(l,e){const o=l.fieldData,a=o[e]??o[e.replace(/([A-Z])/g," $1").trim()];return a!=null&&a!==""?String(a).trim():""}function $(l,e){return X(l,e)||"—"}function Pe(l){return l!=null&&l.trim()?l.trim():"—"}function xe(l){if(l==null||l==="")return"—";const e=typeof l=="number"?l:parseFloat(String(l));return Number.isNaN(e)?"—":ye(e)}const F=j(()=>{const l=R.value.toLowerCase();return l?q.value.filter(e=>{const o=e.fieldData,a=String(o.TransRef??o.TransRef??"").toLowerCase(),d=String(o.ChequeNo??o["Cheque No"]??"").toLowerCase(),i=String(o.ChequePayee??o["Cheque Payee"]??"").toLowerCase(),c=String(o.BankName??o["Bank Name"]??"").toLowerCase();return a.includes(l)||d.includes(l)||i.includes(l)||c.includes(l)}):q.value}),S=f(1),J=j(()=>Math.max(1,Math.ceil(F.value.length/he))),Le=j(()=>{const l=(S.value-1)*he;return F.value.slice(l,l+he)});le(R,()=>{S.value=1}),le(J,l=>{S.value>l&&(S.value=Math.max(1,l))});function Me(){pt(F.value,"csv")}function Ve(l){return l?String(l.Status??l.status??"").trim():""}const Ce=j(()=>{const l=ee.value,e=B.value.trim().toLowerCase();return e?l.filter(o=>{const a=o.fieldData,d=String(a.TransRef??a.TransRef??"").toLowerCase(),i=String(a.VendorName??a["Vendor Name"]??"").toLowerCase(),c=String(a.VendorID??a["Vendor ID"]??"").toLowerCase();return d.includes(e)||i.includes(e)||c.includes(e)}):l});function $e(l){const e=l.fieldData,o=String(e.TransRef??e.TransRef??e.Trans_Ref??"").trim(),a=String(e.VendorID??e["Vendor ID"]??e.Vendor_Id??"").trim(),d=String(e.VendorName??e["Vendor Name"]??e.Vendor_Name??"").trim(),i=e.Total??e.total??e.Total,c=typeof i=="number"?i:i!=null&&i!==""?parseFloat(String(i)):void 0;n.value.TransRef=o,n.value.Amount=c!=null&&!Number.isNaN(c)?c:"",Z.value=a,W.value=d,B.value="",setTimeout(()=>{g.value=!1},0)}async function Fe(){if(!A.value){H.value=[];return}Q.value=!0;const{data:l,error:e}=await x(D.PAYABLES_MAIN,{limit:500});if(Q.value=!1,e){H.value=[];return}H.value=l.filter(o=>Ve(o.fieldData)==="Approved")}const ge=j(()=>{const l=new Set;for(const e of q.value){const o=e.fieldData,a=(o==null?void 0:o.TransRef)??(o==null?void 0:o.TransRef);a!=null&&String(a).trim()&&l.add(String(a).trim())}return l}),ee=j(()=>H.value.filter(l=>{const e=l.fieldData,o=String((e==null?void 0:e.TransRef)??(e==null?void 0:e.TransRef)??"").trim();return o&&!ge.value.has(o)})),ke=j(()=>{const l=Z.value.trim(),e=W.value.trim();return!l&&!e?n.value.TransRef??"":l?e?`${l} · ${e}`:l:e});function Ue(){n.value.TransRef="",n.value.Amount="",Z.value="",W.value="",g.value=!1,B.value=""}function we(l){const e=be.value;e&&!e.contains(l.target)&&(g.value=!1)}le(g,l=>{l&&(B.value="",st(()=>{var e;return(e=_e.value)==null?void 0:e.focus()}))}),le(z,l=>{l&&!N.value&&Fe(),l||(Oe(),N.value=null)}),qe(()=>{document.addEventListener("click",we)}),et(()=>{document.removeEventListener("click",we)});function je(l){const e=String(l??"").trim();if(!e)return G();const o=e.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(o){const[,a,d,i]=o;return`${i}-${a.padStart(2,"0")}-${d.padStart(2,"0")}`}return/^\d{4}-\d{2}-\d{2}$/.test(e)?e:G()}function ze(l){const e=l.fieldData,o=i=>{const c=e[i]??e[i.replace(/([A-Z])/g," $1").trim()];return c!=null&&c!==""?String(c).trim():""},a=o("TransRef"),d=o("ChequePayee");n.value={TransRef:a,BankName:o("BankName"),ChequeNo:o("ChequeNo"),Amount:o("Amount")||"",ChequePayee:d,ReceivedBy:o("ReceivedBy"),IDNo:o("IDNo"),Contact:o("Contact"),TinNo:o("TinNo"),CollectionDate:je(e.CollectionDate??e["Collection Date"])},Z.value=a,W.value=d,N.value=l.recordId?String(l.recordId):null,P.value=null,g.value=!1,z.value=!0}function ie(){z.value=!1,N.value=null}function Oe(){n.value={TransRef:"",BankName:"",ChequeNo:"",Amount:"",ChequePayee:"",ReceivedBy:"",IDNo:"",Contact:"",TinNo:"",CollectionDate:G()},P.value=null,Z.value="",W.value="",B.value="",g.value=!1}function Ke(l){if(!l)return"";const e=l.FullName??l["Full Name"]??l.fullName??l.fullname;return e!=null&&String(e).trim()?String(e).trim():""}function Ye(l){return/^[^@]+@[^@]+\.[^@]+$/.test(l.trim())}async function He(){var i,c,k;const l=(i=re.value)==null?void 0:i.trim();if(!l)return null;const e=l.toLowerCase();let o;const{data:a}=await _(D.PAYABLES_USERS,{Email:l},1);if(o=(c=a[0])==null?void 0:c.fieldData,!(a!=null&&a.length)){const{data:p}=await _(D.PAYABLES_USERS,{email:l},1);p!=null&&p.length&&(o=(k=p[0])==null?void 0:k.fieldData)}if(!o){const{data:p}=await x(D.PAYABLES_USERS,{limit:500}),T=p==null?void 0:p.find(L=>{const w=L==null?void 0:L.fieldData;return((w==null?void 0:w.Email)??(w==null?void 0:w.email)??"").toString().trim().toLowerCase()===e});o=T==null?void 0:T.fieldData}const d=Ke(o);return d&&!Ye(d)?d:null}function Qe(){var l,e;return(l=n.value.TransRef)!=null&&l.trim()?(e=n.value.ChequePayee)!=null&&e.trim()?null:"Cheque Payee (Vendor Name) is required.":"Please select a payable from the list."}async function We(){var a,d,i,c,k,p,T,L,w,oe,Ne,Re,Se,Te;if(Y.value)return;if(!A.value){C.error("Not connected to FileMaker."),P.value=null;return}const l=Qe();if(l){C.error(l),P.value=null;return}Y.value=!0,P.value=null;const e=N.value,o=!!e;try{const Ze=n.value.Amount===""?void 0:typeof n.value.Amount=="number"?n.value.Amount:parseFloat(String(n.value.Amount)),de={TransRef:((a=n.value.TransRef)==null?void 0:a.trim())||void 0,BankName:((d=n.value.BankName)==null?void 0:d.trim())||void 0,ChequeNo:((i=n.value.ChequeNo)==null?void 0:i.trim())||void 0,Amount:Ze,ChequePayee:(c=n.value.ChequePayee)==null?void 0:c.trim(),ReceivedBy:((k=n.value.ReceivedBy)==null?void 0:k.trim())||void 0,IDNo:((p=n.value.IDNo)==null?void 0:p.trim())||void 0,Contact:((T=n.value.Contact)==null?void 0:T.trim())||void 0,TinNo:((L=n.value.TinNo)==null?void 0:L.trim())||void 0,CollectionDate:fe(n.value.CollectionDate)};if(!o){const U=await He();de.IssuedBy=U||void 0}if(o){const{error:U}=await V(D.CHEQUE_COLLECTION,e,de);if(U){C.error(U),P.value=null;return}const te=(w=n.value.TransRef)==null?void 0:w.trim();if(te){const{data:ce}=await _(D.PAYABLES_MAIN,{TransRef:te},1),M=ce[0];M!=null&&M.recordId&&await V(D.PAYABLES_MAIN,M.recordId,{ChequeIssuedDate:fe(n.value.CollectionDate),BankName:(oe=n.value.BankName)==null?void 0:oe.trim(),ChequeNo:(Ne=n.value.ChequeNo)==null?void 0:Ne.trim()})}C.success("Collection record updated.")}else{const{error:U}=await m(D.CHEQUE_COLLECTION,de);if(U){C.error(U),P.value=null;return}const te=(Re=n.value.TransRef)==null?void 0:Re.trim();if(te){const{data:ce}=await _(D.PAYABLES_MAIN,{TransRef:te},1),M=ce[0];if(M!=null&&M.recordId){const{error:De}=await V(D.PAYABLES_MAIN,M.recordId,{ChequeIssued:"Yes",ChequeIssuedDate:fe(n.value.CollectionDate),BankName:(Se=n.value.BankName)==null?void 0:Se.trim(),ChequeNo:(Te=n.value.ChequeNo)==null?void 0:Te.trim()});De&&C.error("Collection saved but Payables_Main update failed: "+De)}}C.success("Collection record added.")}ie(),await ue()}finally{Y.value=!1}}async function ue(){if(!A.value){q.value=[],O.value=!1;return}O.value=!0,K.value=null;const{data:l,error:e}=await x(D.CHEQUE_COLLECTION,{limit:500});O.value=!1,e?(C.error(e),K.value=null,q.value=[],ae.setCollectionCount(0)):(q.value=l,ae.setCollectionCount(l.length))}return qe(ue),le(A,l=>{l&&ue()}),(l,e)=>{const o=ot("router-link");return s(),r("div",ft,[t("header",ht,[t("div",yt,[h(o,{to:"/",class:"pill-btn glass-input inline-flex items-center gap-1.5 px-3 py-2 text-[var(--label-size)] text-[var(--color-text-muted)] no-underline hover:text-[var(--color-text)]"},{default:Be(()=>[...e[19]||(e[19]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),ne(" Back ",-1)])]),_:1}),e[20]||(e[20]=t("h1",{class:"text-xl font-bold tracking-tight text-[var(--color-text)]"}," Cheque collection ",-1))]),t("div",bt,[t("button",{type:"button",class:"pill-btn glass-input inline-flex items-center gap-2 rounded-full border border-[var(--color-border)] px-4 py-2.5 text-[var(--label-size)] font-medium text-[var(--color-text-muted)] transition-colors hover:bg-white/5 hover:text-[var(--color-text)]",disabled:F.value.length===0,"aria-label":"Export cheque collections to CSV",onClick:Me},[...e[21]||(e[21]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),ne(" Export ",-1)])],8,_t),t("button",{type:"button",class:"pill-btn inline-flex items-center gap-2 rounded-full bg-orange-500 px-4 py-2.5 text-[var(--label-size)] font-semibold text-white shadow-md hover:bg-orange-600 transition-colors",onClick:e[0]||(e[0]=a=>z.value=!0)},[...e[22]||(e[22]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ne(" Add collection ",-1)])])])]),e[48]||(e[48]=t("p",{class:"text-[var(--label-size)] text-[var(--color-text-muted)] mb-4"}," Record cheque handovers to vendors. Search by TransRef, ChequePayee, or Cheque No. ",-1)),!O.value&&!K.value&&q.value.length>0?(s(),r("div",xt,[t("div",Ct,[t("div",{class:ve(["search-bar__wrap tax-search-bar__search",{"search-bar__wrap--has-value":R.value}])},[e[24]||(e[24]=t("span",{class:"search-bar__icon","aria-hidden":"true"},[t("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[t("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),I(t("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>R.value=a),type:"search",class:"search-bar__input",placeholder:"Search TransRef, ChequePayee, Cheque No…",autocomplete:"off","aria-label":"Search collection records"},null,512),[[E,R.value,void 0,{trim:!0}]]),R.value?(s(),r("button",{key:0,type:"button",class:"search-bar__clear","aria-label":"Clear search",onClick:e[2]||(e[2]=a=>R.value="")},[...e[23]||(e[23]=[t("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])):y("",!0)],2)]),R.value?(s(),r("p",gt,u(F.value.length)+" result"+u(F.value.length===1?"":"s"),1)):y("",!0)])):y("",!0),t("div",kt,[O.value?(s(),r("div",wt,[t("div",Nt,[h(b,{width:"100%",height:"2.75rem",class:"rounded-xl"})]),t("table",Rt,[t("thead",null,[t("tr",null,[t("th",null,[h(b,{width:"4rem",height:"0.875rem",class:"rounded"})]),t("th",null,[h(b,{width:"5rem",height:"0.875rem",class:"rounded"})]),t("th",null,[h(b,{width:"4rem",height:"0.875rem",class:"rounded"})]),t("th",null,[h(b,{width:"4rem",height:"0.875rem",class:"rounded"})]),t("th",null,[h(b,{width:"6rem",height:"0.875rem",class:"rounded"})]),t("th",null,[h(b,{width:"5rem",height:"0.875rem",class:"rounded"})]),t("th",null,[h(b,{width:"4rem",height:"0.875rem",class:"rounded"})])])]),t("tbody",null,[(s(),r(me,null,pe(6,a=>t("tr",{key:a,class:"tax-table-skeleton__row"},[t("td",null,[h(b,{width:"4rem",height:"0.875rem",class:"rounded"})]),t("td",null,[h(b,{width:"4rem",height:"0.875rem",class:"rounded"})]),t("td",null,[h(b,{width:"4rem",height:"0.875rem",class:"rounded"})]),t("td",null,[h(b,{width:"4rem",height:"0.875rem",class:"rounded"})]),t("td",null,[h(b,{width:"5rem",height:"0.875rem",class:"rounded"})]),t("td",null,[h(b,{width:"5rem",height:"0.875rem",class:"rounded"})]),t("td",null,[h(b,{width:"4rem",height:"0.875rem",class:"rounded"})])])),64))])])])):K.value?(s(),r("div",St,u(K.value),1)):q.value.length===0?(s(),r("div",Tt,[e[25]||(e[25]=t("p",null,"No collection records yet.",-1)),t("button",{type:"button",class:"pill-btn mt-2 inline-flex items-center gap-2 rounded-full bg-orange-500 px-4 py-2.5 text-[var(--label-size)] font-semibold text-white shadow-md hover:bg-orange-600 transition-colors",onClick:e[3]||(e[3]=a=>z.value=!0)}," Add your first record ")])):F.value.length===0?(s(),r("div",Dt,[t("p",null,u(R.value?"No matching records.":"No collection records yet."),1),R.value?(s(),r("button",{key:0,type:"button",class:"pill-btn mt-2 text-[var(--color-text-muted)] hover:text-[var(--color-text)]",onClick:e[4]||(e[4]=a=>R.value="")}," Clear search ")):y("",!0)])):(s(),r("div",qt,[t("div",Bt,[t("table",It,[e[28]||(e[28]=t("thead",null,[t("tr",null,[t("th",null,"TransRef"),t("th",null,"Bank"),t("th",null,"Cheque No"),t("th",null,"Amount"),t("th",null,"Cheque Payee"),t("th",null,"Received By"),t("th",null,"Collection Date"),t("th",null,"Issued By"),t("th",{class:"cheque-table-actions"},"View"),t("th",{class:"cheque-table-actions"},"Edit")])],-1)),t("tbody",null,[(s(!0),r(me,null,pe(Le.value,(a,d)=>(s(),r("tr",{key:a.recordId||d},[t("td",null,u($(a,"TransRef")),1),t("td",null,u($(a,"BankName")),1),t("td",null,u($(a,"ChequeNo")),1),t("td",null,u(xe($(a,"Amount"))),1),t("td",null,u($(a,"ChequePayee")),1),t("td",null,u($(a,"ReceivedBy")),1),t("td",null,u(Pe($(a,"CollectionDate"))),1),t("td",null,u($(a,"IssuedBy")),1),t("td",Et,[X(a,"TransRef")?(s(),Ie(o,{key:0,to:{name:"entry",query:{transRef:X(a,"TransRef"),from:"cheque-collection"}},class:"cheque-view-btn",title:`View payable ${X(a,"TransRef")}`,"aria-label":"View record"},{default:Be(()=>[...e[26]||(e[26]=[t("svg",{class:"cheque-view-btn__icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),t("circle",{cx:"12",cy:"12",r:"3"})],-1)])]),_:1},8,["to","title"])):(s(),r("span",At,"—"))]),t("td",Pt,[Ae(a)?(s(),r("button",{key:0,type:"button",class:"cheque-view-btn",title:"Edit record","aria-label":"Edit record",onClick:i=>ze(a)},[...e[27]||(e[27]=[t("svg",{class:"cheque-view-btn__icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"}),t("path",{d:"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"})],-1)])],8,Lt)):(s(),r("span",Mt,"—"))])]))),128))])])]),J.value>1?(s(),r("div",Vt,[t("button",{type:"button",class:"pagination__btn",disabled:S.value<=1,"aria-label":"Previous page",onClick:e[5]||(e[5]=a=>S.value=Math.max(1,S.value-1))},[...e[29]||(e[29]=[t("svg",{class:"pagination__icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],8,$t),t("span",Ft," Page "+u(S.value)+" of "+u(J.value),1),t("button",{type:"button",class:"pagination__btn",disabled:S.value>=J.value,"aria-label":"Next page",onClick:e[6]||(e[6]=a=>S.value=Math.min(J.value,S.value+1))},[...e[30]||(e[30]=[t("svg",{class:"pagination__icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,Ut)])):y("",!0)]))]),(s(),Ie(at,{to:"body"},[z.value?(s(),r("div",jt,[t("div",zt,[t("header",Ot,[t("h2",Kt,u(N.value?"Edit collection record":"Add collection record"),1),t("button",{type:"button",class:"tax-modal__close","aria-label":"Close",onClick:ie},[...e[31]||(e[31]=[t("svg",{class:"tax-modal__close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),P.value?(s(),r("div",Yt,[e[32]||(e[32]=t("svg",{class:"tax-modal__error-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),t("span",Ht,u(P.value),1)])):y("",!0),t("form",{class:"tax-modal__form",onSubmit:se(We,["prevent"])},[t("section",Qt,[e[40]||(e[40]=t("h3",{class:"tax-modal__section-title"},"Cheque details",-1)),n.value.TransRef?(s(),r("p",Wt,u(ke.value),1)):y("",!0),N.value?(s(),r("p",Zt," TransRef: "+u(n.value.TransRef),1)):y("",!0),N.value?y("",!0):(s(),r("label",Gt,[e[35]||(e[35]=t("span",null,[ne("Select approved payable "),t("span",{class:"text-[var(--color-text-muted)] font-normal"},"(only those not yet collected)")],-1)),N.value?y("",!0):(s(),r("div",{key:0,class:"payable-select-wrap",ref_key:"payableSelectWrapRef",ref:be},[t("div",{class:ve(["payable-select-trigger glass-input flex items-center gap-2 w-full px-3 py-2.5 rounded-lg cursor-pointer",{"payable-select-trigger--focused":g.value}]),onClick:e[7]||(e[7]=a=>g.value=!g.value)},[n.value.TransRef?(s(),r("span",Xt,[t("span",Jt,u(ke.value),1)])):(s(),r("span",el," Search by vendor or TransRef… ")),n.value.TransRef?(s(),r("button",{key:2,type:"button",class:"payable-select-clear shrink-0 p-1 rounded hover:bg-white/10 text-[var(--color-text-muted)] hover:text-[var(--color-text)] transition-colors","aria-label":"Clear selection",onClick:se(Ue,["stop"])},[...e[33]||(e[33]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):y("",!0),(s(),r("svg",{class:ve(["h-4 w-4 shrink-0 text-[var(--color-text-muted)] transition-transform",{"rotate-180":g.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[34]||(e[34]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))],2),!N.value&&g.value?(s(),r("div",{key:0,class:"payable-select-dropdown",onClick:e[10]||(e[10]=se(()=>{},["stop"]))},[t("div",tl,[I(t("input",{ref_key:"payableSearchInputRef",ref:_e,"onUpdate:modelValue":e[8]||(e[8]=a=>B.value=a),type:"search",class:"glass-input w-full px-3 py-2.5 rounded-lg text-[var(--label-size)]",placeholder:"Search by vendor name or TransRef…",autocomplete:"off",onKeydown:e[9]||(e[9]=tt(a=>g.value=!1,["escape"]))},null,544),[[E,B.value]]),!Q.value&&ee.value.length>0&&!B.value?(s(),r("p",ll,u(ee.value.length)+" approved "+u(ee.value.length===1?"payable":"payables")+" awaiting collection ",1)):y("",!0)]),t("ul",al,[(s(!0),r(me,null,pe(Ce.value,a=>{var d,i,c,k,p,T,L,w;return s(),r("li",{key:((d=a.fieldData)==null?void 0:d.TransRef)??a.recordId,class:"payable-select-item-wrapper"},[t("button",{type:"button",class:"payable-select-item",role:"option","aria-selected":n.value.TransRef===(((i=a.fieldData)==null?void 0:i.TransRef)??""),onClick:se(oe=>$e(a),["stop","prevent"])},[t("span",nl,u(((c=a.fieldData)==null?void 0:c.TransRef)??"—"),1),t("span",sl,u(((k=a.fieldData)==null?void 0:k.VendorName)??((p=a.fieldData)==null?void 0:p["Vendor Name"])??((T=a.fieldData)==null?void 0:T.Vendor_Name)??"—"),1),t("span",rl,u(((L=a.fieldData)==null?void 0:L.Currency)??"")+" "+u(xe((w=a.fieldData)==null?void 0:w.Total)),1)],8,ol)])}),128)),B.value&&Ce.value.length===0?(s(),r("li",il," No matching approved payables ")):!B.value&&ee.value.length===0&&!Q.value?(s(),r("li",ul,u(ge.value.size>0&&H.value.length>0?"All approved payables have already been recorded":"No approved payables found"),1)):Q.value?(s(),r("li",dl," Loading approved payables… ")):y("",!0)])])):y("",!0)],512))])),t("div",cl,[t("label",vl,[e[36]||(e[36]=t("span",null,"Bank Name",-1)),I(t("input",{"onUpdate:modelValue":e[11]||(e[11]=a=>n.value.BankName=a),type:"text",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"Bank name"},null,512),[[E,n.value.BankName]])]),t("label",ml,[e[37]||(e[37]=t("span",null,"Cheque No",-1)),I(t("input",{"onUpdate:modelValue":e[12]||(e[12]=a=>n.value.ChequeNo=a),type:"text",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"Cheque number"},null,512),[[E,n.value.ChequeNo]])])]),t("div",pl,[t("label",fl,[e[38]||(e[38]=t("span",null,"Amount",-1)),t("input",{value:lt(ye)(n.value.Amount),type:"text",readonly:"",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"Auto-filled when payable selected"},null,8,hl)]),t("label",yl,[e[39]||(e[39]=t("span",null,"Cheque Payee (Vendor Name)",-1)),I(t("input",{"onUpdate:modelValue":e[13]||(e[13]=a=>n.value.ChequePayee=a),type:"text",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"Vendor name"},null,512),[[E,n.value.ChequePayee]])])])]),t("section",bl,[e[44]||(e[44]=t("h3",{class:"tax-modal__section-title"},"Received by",-1)),t("div",_l,[t("label",xl,[e[41]||(e[41]=t("span",null,"Received By",-1)),I(t("input",{"onUpdate:modelValue":e[14]||(e[14]=a=>n.value.ReceivedBy=a),type:"text",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"Person name"},null,512),[[E,n.value.ReceivedBy]])]),t("label",Cl,[e[42]||(e[42]=t("span",null,"ID No",-1)),I(t("input",{"onUpdate:modelValue":e[15]||(e[15]=a=>n.value.IDNo=a),type:"text",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"ID number"},null,512),[[E,n.value.IDNo]])])]),t("label",gl,[e[43]||(e[43]=t("span",null,"Contact",-1)),I(t("input",{"onUpdate:modelValue":e[16]||(e[16]=a=>n.value.Contact=a),type:"text",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"Phone / email"},null,512),[[E,n.value.Contact]])])]),t("section",kl,[e[47]||(e[47]=t("h3",{class:"tax-modal__section-title"},"Other",-1)),t("div",wl,[t("label",Nl,[e[45]||(e[45]=t("span",null,"Tin No",-1)),I(t("input",{"onUpdate:modelValue":e[17]||(e[17]=a=>n.value.TinNo=a),type:"text",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"TIN"},null,512),[[E,n.value.TinNo]])]),t("label",Rl,[e[46]||(e[46]=t("span",null,"Collection Date",-1)),I(t("input",{"onUpdate:modelValue":e[18]||(e[18]=a=>n.value.CollectionDate=a),type:"date",class:"glass-input w-full px-3 py-2.5 rounded-lg"},null,512),[[E,n.value.CollectionDate]])])])]),t("div",Sl,[t("button",{type:"button",class:"tax-modal__btn-cancel",onClick:ie}," Cancel "),t("button",{type:"submit",class:"tax-modal__btn-submit",disabled:Y.value},u(Y.value?"Saving…":N.value?"Save":"Add"),9,Tl)])],32)])])):y("",!0)]))])}}}),Il=rt(Dl,[["__scopeId","data-v-cfb166e9"]]);export{Il as default};
