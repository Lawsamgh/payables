import{Q as U,i as p,r as F}from"./index-B7jQKMlp.js";const Z=/^([A-Z]+)(\d+)$/i;function I(n){if(!n||!/^[A-Z]+$/i.test(n))return-1;let s=0;const c=n.toUpperCase();for(let a=0;a<c.length;a++)s=s*26+(c.charCodeAt(a)-64);return s-1}function $(n,s){if(!n||typeof n!="string")return null;const c=n.trim().toUpperCase().match(Z);if(c){const a=I(c[1]),l=parseInt(c[2],10)-1;if(l>=0&&a>=0)return{row:l,col:a}}return s&&n in s?{row:-1,col:s[n]}:null}function L(n,s){const c=n.match(/^([A-Za-z_]+)(\d+)$/);if(c&&s){const a=s[c[1]],l=parseInt(c[2],10)-1;if(a!==void 0&&l>=0)return{row:l,col:a}}return null}function O(n,s,c={}){if(!n||typeof n!="string")return n;const a=n.trim();if(!a.startsWith("="))return n;const l=a.slice(1).trim(),h=l.match(/^SUM\s*\(\s*([A-Za-z0-9]+)\s*:\s*([A-Za-z0-9]+)\s*\)$/i);if(h){const f=h[1],r=h[2],v=$(f,c)??L(f,c),u=$(r,c)??L(r,c);if(v&&u){const R=Math.min(v.row,u.row),E=Math.max(v.row,u.row),y=Math.min(v.col,u.col),A=Math.max(v.col,u.col);let N=0;for(let g=R;g<=E;g++)for(let e=y;e<=A;e++){const t=s(g,e),o=parseFloat(String(t));Number.isNaN(o)||(N+=o)}return N}}let d=l;const k=l.match(/\b[A-Z]+\d+\b/gi)??[],b=new Set;for(const f of k){if(b.has(f))continue;b.add(f);const r=$(f,c);if(r&&r.row>=0){const v=s(r.row,r.col),u=parseFloat(String(v)),R=Number.isNaN(u)?"0":String(u);d=d.replace(new RegExp(f.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),R)}}const m=d.replace(/\s/g,"");if(/^[\d.\s+\-*/()]+$/.test(m))try{return Function(`"use strict"; return (${m})`)()}catch{return n}return n}const S=["invoice_number","amount","tax","reference","total"],D=60,W=150,M=S.length,i=F({row:0,col:0}),x=F(null),_=F(!1);function H(){const n=U(),s=p(()=>n.rows),c=p(()=>s.value.length),a=p(()=>M),l=p(()=>i.value),h=p(()=>i.value.row),d=p(()=>i.value.col),k=p(()=>{const e={};return S.forEach((t,o)=>{const w=t.replace(/_/g," ").replace(/\b\w/g,C=>C.toUpperCase());e[w]=o,e[t]=o}),e});function b(e,t){const o=s.value[e];if(!o)return"";const w=S[t],C=o[w];return C??""}function m(e,t,o){const w=S[t];n.updateCell(e,w,String(o))}function f(e){return O(e,b,k.value)}function r(e,t){const o=Math.max(0,Math.min(e,c.value-1)),w=Math.max(0,Math.min(t,M-1));i.value={row:o,col:w}}function v(e){const{row:t,col:o}=i.value;switch(e){case"up":r(t-1,o);break;case"down":r(t+1,o);break;case"left":r(t,o-1);break;case"right":r(t,o+1);break;case"tab":o<M-1?r(t,o+1):r(t+1,0);break;case"tabReverse":o>0?r(t,o-1):r(t-1,M-1);break;case"enter":r(t+1,o);break;case"enterReverse":r(t-1,o);break}}function u(){n.addRow(),r(c.value-1,0)}function R(e){n.removeRow(e),c.value===0&&n.addRow();const t=Math.min(e,c.value-1);t>=0&&r(t,d.value)}function E(){const{row:e,col:t}=i.value,o=b(e,t);x.value=o,_.value=!1}function y(){E(),_.value=!0}function A(){if(x.value==null)return;const{row:e,col:t}=i.value;m(e,t,x.value),_.value&&(m(i.value.row,i.value.col,""),_.value=!1,x.value=null)}function N(){const{row:e,col:t}=i.value;m(e,t,"")}function g(){const{row:e}=i.value;e===c.value-1&&u()}return{COLUMN_KEYS:S,ROW_HEADER_WIDTH:D,COL_WIDTH:W,COL_COUNT:M,rows:s,rowCount:c,colCount:a,selected:l,selectedRow:h,selectedCol:d,headerToCol:k,getCellValue:b,setCellValue:m,evaluateCellFormula:f,selectCell:r,moveSelection:v,addRow:u,deleteRow:R,copy:E,cut:y,paste:A,clearCell:N,ensureRowForEnter:g,hasClipboard:p(()=>x.value!=null)}}export{H as u};
