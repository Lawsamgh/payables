import{d as fe,H as be,l as B,m as oe,I as ye,c as r,a as t,f as d,w as ne,s as O,i as A,v as D,x as N,b as S,Q as we,F as j,r as q,t as c,q as Te,C as M,J as z,T as ge,G as ke,h as p,g as F,L as K,A as Ce,z as De,o}from"./index-DHrrxsNC.js";import{_ as v}from"./Skeleton.vue_vue_type_script_setup_true_lang-CR2pGYDY.js";const Se={class:"content-area flex flex-col flex-1 min-h-0 w-full max-w-[1600px] mx-auto px-4 py-5 md:px-6 md:py-6"},Ne={class:"flex flex-wrap items-center justify-between gap-4 mb-6"},Me={class:"flex flex-wrap items-center gap-3"},$e={key:0,class:"tax-search-bar"},Ee={class:"tax-search-bar__row"},Le={class:"tax-search-bar__filter-wrap"},Re=["value"],Ae={key:0,class:"tax-search-bar__hint"},Ve={class:"tax-table-wrap"},Ue={key:0,class:"tax-table-skeleton"},Be={class:"tax-table-skeleton__search"},je={class:"tax-table"},qe={class:"tax-table__actions-th"},ze={class:"tax-table__actions-td"},Fe={key:1,class:"tax-table-error"},He={key:2,class:"tax-table-empty"},Ie={key:3,class:"tax-table-empty"},Oe={key:4,class:"tax-table-scroll"},Ke={class:"tax-table"},Xe={key:0,class:"tax-table__status-badge"},Qe={key:1},Ge={class:"tax-table__actions-td"},Je=["onClick"],Pe={key:0,class:"tax-modal-backdrop"},We=["aria-labelledby"],Ye={class:"tax-modal__header"},Ze=["id"],et={key:0,class:"tax-modal__error",role:"alert"},tt={class:"tax-modal__error-text"},at={class:"tax-modal__section"},lt={class:"tax-modal__label"},st={class:"tax-modal__search-dropdown-input-wrap"},ot=["onKeydown"],nt={key:0,class:"tax-modal__search-dropdown-list",role:"listbox"},rt=["aria-selected","onMousedown"],it=["aria-selected"],ut={class:"tax-modal__label"},dt={class:"tax-modal__label"},vt={class:"tax-modal__section"},ct={class:"tax-modal__row"},pt={class:"tax-modal__label"},xt={class:"tax-modal__label"},mt={class:"tax-modal__actions"},_t=["disabled"],yt=fe({__name:"TaxView",setup(ht){const{createRecord:re,updateRecord:ie,findRecordsWithIds:ue,isConnected:H}=De(),X=be(),w=p([]),$=p(!0),E=p(null),T=p(!1),b=p(""),g=p(""),de=F(()=>{const a=new Set;for(const{fieldData:e}of w.value){const s=(e.Status??"").trim();s&&a.add(s)}return Array.from(a).sort()}),V=F(()=>{let a=w.value;const e=b.value.toLowerCase(),s=g.value.trim();return s&&(a=a.filter(l=>(l.fieldData.Status??"").trim()===s)),e?a.filter(l=>{const i=l.fieldData,n=(i.Tax_Type??"").toLowerCase(),C=(i.Tax_Name??"").toLowerCase(),U=(i.Status??"").toLowerCase(),le=Z(i.Tax_Rate).toLowerCase();return n.includes(e)||C.includes(e)||U.includes(e)||le.includes(e)}):a}),m=p(null),u=p({Tax_Type:"",Tax_Name:"",Tax_Rate:void 0,Start_Date:"",End_Date:""}),f=p(""),y=p(null),L=p(!1),_=p(""),h=p(!1),x=p(0),Q=p(null),G=F(()=>{const a=new Set;for(const{fieldData:e}of w.value){const s=(e.Tax_Type??"").trim();s&&a.add(s.toUpperCase())}return Array.from(a).sort()}),k=F(()=>{const a=_.value.trim().toLowerCase();return a?G.value.filter(e=>e.toLowerCase().includes(a)):G.value});function J(a){const e=k.value.length+1;x.value=(x.value+a+e)%e}function ve(){const a=x.value,e=k.value;a<e.length?P(e[a]):W()}function P(a){u.value.Tax_Type=a,_.value=a,f.value="",h.value=!1,x.value=0}function W(){const a=_.value.trim();u.value.Tax_Type="__other__",f.value=a?a.toUpperCase():"",_.value=f.value||"— Add new type —",h.value=!1,x.value=0}function ce(){setTimeout(()=>{if(!h.value)return;h.value=!1;const a=_.value.trim();a&&!u.value.Tax_Type&&(u.value.Tax_Type="__other__",f.value=a.toUpperCase(),_.value=f.value)},150)}function Y(a){var s;if((s=Q.value)!=null&&s.contains(a.target))return;h.value=!1;const e=_.value.trim();e&&!u.value.Tax_Type&&(u.value.Tax_Type="__other__",f.value=e.toUpperCase(),_.value=f.value)}async function I(){if(!H.value){w.value=[],$.value=!1;return}$.value=!0,E.value=null;const{data:a,error:e}=await ue(K.TAX_VALUE,{limit:500});$.value=!1,e?(E.value=e,w.value=[]):w.value=a}function Z(a){if(a==null||a==="")return"—";const e=Number(a);return Number.isNaN(e)?"—":`${e}%`}function ee(a){return a!=null&&a.trim()?a.trim():"—"}function te(a){if(!(a!=null&&a.trim()))return"";const e=a.trim(),s=/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/.exec(e);if(s){const i=s[1].padStart(2,"0"),n=s[2].padStart(2,"0");return`${s[3]}-${i}-${n}`}return/^(\d{4})-(\d{2})-(\d{2})$/.exec(e)?e:""}function pe(a){const e=(a??"").trim().toLowerCase();return e?e==="valid"?"tax-table__status--valid":e==="expired"?"tax-table__status--expired":"tax-table__status--other":""}function xe(a){const e=a.fieldData;u.value={Tax_Type:e.Tax_Type??"",Tax_Name:e.Tax_Name??"",Tax_Rate:e.Tax_Rate,Start_Date:te(e.Start_Date),End_Date:te(e.End_Date)},_.value=(e.Tax_Type??"").trim(),f.value="",m.value=a.recordId,y.value=null,T.value=!0}function ae(a){if(!(a!=null&&a.trim()))return;const e=a.trim(),s=/^(\d{4})-(\d{2})-(\d{2})$/.exec(e);if(!s)return;const[,l,i,n]=s;return`${i}/${n}/${l}`}function me(){m.value=null,u.value={Tax_Type:"",Tax_Name:"",Tax_Rate:void 0,Start_Date:"",End_Date:""},f.value="",_.value="",h.value=!1,x.value=0,y.value=null}B(T,a=>{a?m.value||me():h.value=!1}),B(h,a=>{a&&(x.value=0)}),B(k,()=>{x.value=Math.min(x.value,k.value.length)}),oe(()=>{document.addEventListener("click",Y)}),ye(()=>{document.removeEventListener("click",Y)});function _e(){const{Tax_Type:a,Tax_Name:e,Tax_Rate:s,Start_Date:l,End_Date:i}=u.value,n=[],C=a==null?void 0:a.trim();return C?C==="__other__"&&!f.value.trim()&&n.push("Tax Type (enter new type)"):n.push("Tax Type"),e!=null&&e.trim()||n.push("Tax Name"),(s==null||s===""||typeof s=="number"&&Number.isNaN(s))&&n.push("Tax Rate"),l!=null&&l.trim()||n.push("Start Date"),i!=null&&i.trim()||n.push("End Date"),n.length===0?null:n.length===1?`${n[0]} is required.`:`Please fill in: ${n.join(", ")}.`}async function he(){if(L.value)return;if(!H.value){y.value="Not connected to FileMaker.";return}const a=_e();if(a){y.value=a;return}L.value=!0,y.value=null;const e=m.value?String(m.value).trim():null;try{const{Tax_Type:s,Tax_Name:l,Tax_Rate:i,Start_Date:n,End_Date:C}=u.value,U=(s==null?void 0:s.trim())==="__other__"?f.value.trim():(s??"").trim(),se={Tax_Type:U?U.toUpperCase():void 0,Tax_Name:(l==null?void 0:l.trim())||void 0,Tax_Rate:i!=null&&i!==""?Number(i):void 0,Start_Date:ae(n),End_Date:ae(C)};if(e){const{error:R}=await ie(K.TAX_VALUE,e,se);if(R){y.value=R;return}X.success("Tax updated successfully.")}else{const{error:R}=await re(K.TAX_VALUE,se);if(R){y.value=R;return}X.success("Tax added successfully.")}T.value=!1,m.value=null,await I()}finally{L.value=!1}}return oe(I),B(H,a=>{a&&I()}),(a,e)=>{const s=Ce("router-link");return o(),r("div",Se,[t("header",Ne,[t("div",Me,[d(s,{to:"/",class:"pill-btn glass-input inline-flex items-center gap-1.5 px-3 py-2 text-[var(--label-size)] text-[var(--color-text-muted)] no-underline hover:text-[var(--color-text)]"},{default:ne(()=>[...e[17]||(e[17]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),O(" Back ",-1)])]),_:1}),e[18]||(e[18]=t("h1",{class:"text-xl font-bold tracking-tight text-[var(--color-text)]"},"Tax",-1))]),t("button",{type:"button",class:"pill-btn inline-flex items-center gap-2 rounded-full bg-orange-500 px-4 py-2.5 text-[var(--label-size)] font-semibold text-white shadow-md hover:bg-orange-600 transition-colors",onClick:e[0]||(e[0]=l=>T.value=!0)},[...e[19]||(e[19]=[t("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),O(" Add Tax ",-1)])])]),e[38]||(e[38]=t("p",{class:"text-[var(--label-size)] text-[var(--color-text-muted)] mb-4"}," Manage tax codes here. Add new rates and view existing ones. ",-1)),!$.value&&!E.value&&w.value.length>0?(o(),r("div",$e,[t("div",Ee,[t("div",{class:A(["search-bar__wrap tax-search-bar__search",{"search-bar__wrap--has-value":b.value}])},[e[21]||(e[21]=t("span",{class:"search-bar__icon","aria-hidden":"true"},[t("svg",{width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[t("path",{d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1)),D(t("input",{"onUpdate:modelValue":e[1]||(e[1]=l=>b.value=l),type:"search",class:"search-bar__input",placeholder:"Search tax type, name, status…",autocomplete:"off","aria-label":"Search tax table"},null,512),[[N,b.value,void 0,{trim:!0}]]),b.value?(o(),r("button",{key:0,type:"button",class:"search-bar__clear","aria-label":"Clear search",onClick:e[2]||(e[2]=l=>b.value="")},[...e[20]||(e[20]=[t("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)])])):S("",!0)],2),t("div",Le,[e[23]||(e[23]=t("span",{class:"tax-search-bar__filter-icon","aria-hidden":"true"},[t("svg",{width:"18",height:"18",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",viewBox:"0 0 24 24"},[t("path",{d:"M22 3H2l8 9.46V19l4 2v-8.54L22 3z"})])],-1)),D(t("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>g.value=l),class:"tax-search-bar__filter","aria-label":"Filter by status"},[e[22]||(e[22]=t("option",{value:""},"All statuses",-1)),(o(!0),r(j,null,q(de.value,l=>(o(),r("option",{key:l,value:l},c(l),9,Re))),128))],512),[[we,g.value]]),e[24]||(e[24]=t("span",{class:"tax-search-bar__filter-chevron","aria-hidden":"true"},[t("svg",{width:"12",height:"12",fill:"none",stroke:"currentColor","stroke-width":"2.5",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 9l6 6 6-6"})])],-1))])]),b.value||g.value?(o(),r("p",Ae,c(V.value.length)+" result"+c(V.value.length===1?"":"s"),1)):S("",!0)])):S("",!0),t("div",Ve,[$.value?(o(),r("div",Ue,[t("div",Be,[d(v,{width:"100%",height:"2.75rem",class:"rounded-xl"}),d(v,{width:"8rem",height:"2.5rem",class:"rounded-lg"})]),t("table",je,[t("thead",null,[t("tr",null,[t("th",null,[d(v,{width:"5rem",height:"0.875rem",class:"rounded"})]),t("th",null,[d(v,{width:"5rem",height:"0.875rem",class:"rounded"})]),t("th",null,[d(v,{width:"3rem",height:"0.875rem",class:"rounded"})]),t("th",null,[d(v,{width:"4.5rem",height:"0.875rem",class:"rounded"})]),t("th",null,[d(v,{width:"4.5rem",height:"0.875rem",class:"rounded"})]),t("th",null,[d(v,{width:"3.5rem",height:"0.875rem",class:"rounded"})]),t("th",qe,[d(v,{width:"2.5rem",height:"0.875rem",class:"rounded"})])])]),t("tbody",null,[(o(),r(j,null,q(6,l=>t("tr",{key:l,class:"tax-table-skeleton__row"},[t("td",null,[d(v,{width:"4rem",height:"0.875rem",class:"rounded"})]),t("td",null,[d(v,{width:"70%",height:"0.875rem",class:"rounded max-w-[8rem]"})]),t("td",null,[d(v,{width:"2.5rem",height:"0.875rem",class:"rounded"})]),t("td",null,[d(v,{width:"5rem",height:"0.875rem",class:"rounded"})]),t("td",null,[d(v,{width:"5rem",height:"0.875rem",class:"rounded"})]),t("td",null,[d(v,{width:"3.5rem",height:"1.25rem",class:"rounded-md"})]),t("td",ze,[d(v,{width:"3.5rem",height:"1.75rem",class:"rounded-lg"})])])),64))])])])):E.value?(o(),r("div",Fe,c(E.value),1)):w.value.length===0?(o(),r("div",He,[e[25]||(e[25]=t("p",null,"No tax codes yet.",-1)),t("button",{type:"button",class:"pill-btn mt-2 inline-flex items-center gap-2 rounded-full bg-orange-500 px-4 py-2.5 text-[var(--label-size)] font-semibold text-white shadow-md hover:bg-orange-600 transition-colors",onClick:e[4]||(e[4]=l=>T.value=!0)}," Add your first tax ")])):V.value.length===0?(o(),r("div",Ie,[t("p",null,c(b.value||g.value?"No matching tax codes.":"No tax codes yet."),1),b.value||g.value?(o(),r("button",{key:0,type:"button",class:"pill-btn mt-2 text-[var(--color-text-muted)] hover:text-[var(--color-text)]",onClick:e[5]||(e[5]=l=>{b.value="",g.value=""})}," Clear filters ")):S("",!0)])):(o(),r("div",Oe,[t("table",Ke,[e[27]||(e[27]=t("thead",null,[t("tr",null,[t("th",null,"Tax Type"),t("th",null,"Tax Name"),t("th",null,"Rate"),t("th",null,"Start Date"),t("th",null,"End Date"),t("th",null,"Status"),t("th",{class:"tax-table__actions-th"})])],-1)),t("tbody",null,[(o(!0),r(j,null,q(V.value,(l,i)=>{var n;return o(),r("tr",{key:l.recordId||i},[t("td",null,c(l.fieldData.Tax_Type??"—"),1),t("td",null,c(l.fieldData.Tax_Name??"—"),1),t("td",null,c(Z(l.fieldData.Tax_Rate)),1),t("td",null,c(ee(l.fieldData.Start_Date)),1),t("td",null,c(ee(l.fieldData.End_Date)),1),t("td",{class:A(pe(l.fieldData.Status))},[(n=l.fieldData.Status)!=null&&n.trim()?(o(),r("span",Xe,c(l.fieldData.Status),1)):(o(),r("span",Qe,"—"))],2),t("td",Ge,[t("button",{type:"button",class:"tax-table__edit-btn","aria-label":"Edit",onClick:C=>xe(l)},[...e[26]||(e[26]=[t("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor","stroke-width":"2",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1),O(" Edit ",-1)])],8,Je)])])}),128))])])]))]),(o(),Te(ke,{to:"body"},[T.value?(o(),r("div",Pe,[t("div",{class:"tax-modal",role:"dialog","aria-labelledby":m.value?"edit-tax-title":"add-tax-title","aria-modal":"true"},[t("header",Ye,[t("h2",{id:m.value?"edit-tax-title":"add-tax-title",class:"tax-modal__title"},c(m.value?"Edit Tax":"Add Tax"),9,Ze),t("button",{type:"button",class:"tax-modal__close","aria-label":"Close",onClick:e[6]||(e[6]=l=>{T.value=!1,m.value=null})},[...e[28]||(e[28]=[t("svg",{class:"tax-modal__close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),y.value?(o(),r("div",et,[e[29]||(e[29]=t("svg",{class:"tax-modal__error-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),t("span",tt,c(y.value),1)])):S("",!0),t("form",{class:"tax-modal__form",onSubmit:M(he,["prevent"])},[t("section",at,[e[34]||(e[34]=t("h3",{class:"tax-modal__section-title"},"Details",-1)),t("label",lt,[e[31]||(e[31]=t("span",null,"Tax Type",-1)),t("div",{ref_key:"taxTypeDropdownRef",ref:Q,class:"tax-modal__search-dropdown"},[t("div",st,[D(t("input",{"onUpdate:modelValue":e[7]||(e[7]=l=>_.value=l),type:"text",class:"tax-modal__search-dropdown-input",placeholder:"Search or select type…",autocomplete:"off",maxlength:"32",onFocus:e[8]||(e[8]=l=>h.value=!0),onBlur:ce,onKeydown:[e[9]||(e[9]=z(M(l=>J(1),["prevent"]),["down"])),e[10]||(e[10]=z(M(l=>J(-1),["prevent"]),["up"])),z(M(ve,["prevent"]),["enter"]),e[11]||(e[11]=z(l=>h.value=!1,["escape"]))]},null,40,ot),[[N,_.value]]),t("span",{class:A(["tax-modal__search-dropdown-chevron",{"tax-modal__search-dropdown-chevron--open":h.value}]),"aria-hidden":"true"},[...e[30]||(e[30]=[t("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M6 9l6 6 6-6"})],-1)])],2)]),d(ge,{name:"search-dropdown"},{default:ne(()=>[h.value?(o(),r("div",nt,[(o(!0),r(j,null,q(k.value,(l,i)=>(o(),r("button",{key:l,type:"button",class:A(["tax-modal__search-dropdown-item",{"tax-modal__search-dropdown-item--highlight":x.value===i}]),role:"option","aria-selected":x.value===i,onMousedown:M(n=>P(l),["prevent"])},c(l),43,rt))),128)),t("button",{type:"button",class:A(["tax-modal__search-dropdown-item tax-modal__search-dropdown-item--add",{"tax-modal__search-dropdown-item--highlight":x.value===k.value.length}]),role:"option","aria-selected":x.value===k.value.length,onMousedown:M(W,["prevent"])}," — Add new type — ",42,it)])):S("",!0)]),_:1})],512)]),t("label",ut,[e[32]||(e[32]=t("span",null,"Tax Name",-1)),D(t("input",{"onUpdate:modelValue":e[12]||(e[12]=l=>u.value.Tax_Name=l),type:"text",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"Display name",required:""},null,512),[[N,u.value.Tax_Name]])]),t("label",dt,[e[33]||(e[33]=t("span",null,"Tax Rate (%)",-1)),D(t("input",{"onUpdate:modelValue":e[13]||(e[13]=l=>u.value.Tax_Rate=l),type:"number",step:"0.01",min:"0",max:"100",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"e.g. 10",required:""},null,512),[[N,u.value.Tax_Rate,void 0,{number:!0}]])])]),t("section",vt,[e[37]||(e[37]=t("h3",{class:"tax-modal__section-title"},"Date range",-1)),t("div",ct,[t("label",pt,[e[35]||(e[35]=t("span",null,"Start Date",-1)),D(t("input",{"onUpdate:modelValue":e[14]||(e[14]=l=>u.value.Start_Date=l),type:"date",class:"glass-input w-full px-3 py-2.5 rounded-lg",required:""},null,512),[[N,u.value.Start_Date]])]),t("label",xt,[e[36]||(e[36]=t("span",null,"End Date",-1)),D(t("input",{"onUpdate:modelValue":e[15]||(e[15]=l=>u.value.End_Date=l),type:"date",class:"glass-input w-full px-3 py-2.5 rounded-lg",required:""},null,512),[[N,u.value.End_Date]])])])]),t("div",mt,[t("button",{type:"button",class:"tax-modal__btn-cancel",onClick:e[16]||(e[16]=l=>{T.value=!1,m.value=null})}," Cancel "),t("button",{type:"submit",class:"tax-modal__btn-submit",disabled:L.value},c(L.value?"Saving…":m.value?"Save":"Add Tax"),9,_t)])],32)],8,We)])):S("",!0)]))])}}});export{yt as default};
