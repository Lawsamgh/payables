const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdfmake-B32-QUBv.js","assets/_commonjsHelpers-Cpj98o6Y.js","assets/vfs_fonts-D-4-wbPz.js"])))=>i.map(i=>d[i]);
import{O as tt,N as ut,u as et,V as Z,L as ot,k as nt,d as ft,o as ct,E as mt,c as p,e as o,p as pt,v as vt,q as K,f as x,F as Y,z as J,t as P,m as bt,r as z,i as X,j as m,b as ht,G as _t,h as gt,w as yt,A as wt,K as xt,_ as St}from"./index-oHQmfbVN.js";import{u as rt}from"./documentSettingsStore-BGsV5kuI.js";function A(s){if(s==null||s==="")return"—";const g=typeof s=="number"?s:parseFloat(String(s).replace(/,/g,""));return Number.isNaN(g)?"—":g.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function Dt(s,g=""){const h=Math.floor(s),S=Math.round((s-h)*100),b=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],_=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],M=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];function l(r){return r===0?"Zero":r<10?b[r]:r<20?_[r-10]:r<100?(M[Math.floor(r/10)]+" "+b[r%10]).trim():r<1e3?(b[Math.floor(r/100)]+" Hundred "+l(r%100)).trim():r<1e6?(l(Math.floor(r/1e3))+" Thousand "+l(r%1e3)).trim():r<1e9?(l(Math.floor(r/1e6))+" Million "+l(r%1e6)).trim():String(r)}const y=h===0?"Zero":l(h),D=g?` ${g}`:"";return S===0?`${y}${D} only`:`${y}${D} and ${S}/100`}function Ct(){const s=tt(),g=ut(),h=rt(),{isConnected:S,findRecordsByQueryWithIds:b}=nt(),_=et();async function M(){var r,d,C,R,j,W;const l=s.mainStatus,y=h.invoiceDownloadWhen;if(!(s.mainPosted&&(y==="approved_only"?l==="Approved":y==="once_posted"?l==="Posted"||l==="Approved":!1)))return!1;try{let k=function(a){const f=(a.invoice_number??"").trim();if(!f)return"—";const v=G.get(f);return v!=null&&v.length?v.map(I=>{const H=Number(I.Rate??0),dt=(I.TaxName??"").trim()||"Tax",Q=H!==0?`${H}%`:"";return`${dt}${Q?` ${Q}`:""}`}).join(", "):"—"};const[N,O]=await Promise.all([Z(()=>import("./pdfmake-B32-QUBv.js").then(a=>a.p),__vite__mapDeps([0,1])),Z(()=>import("./vfs_fonts-D-4-wbPz.js").then(a=>a.v),__vite__mapDeps([2,1]))]),B=N.default??N,q=O.default??O;B.addVirtualFileSystem&&q&&B.addVirtualFileSystem(q);const T=((r=s.currentTransRef)==null?void 0:r.trim())??"",u=g.vendor,n=typeof s.entryTotal=="number"?s.entryTotal:0,t=A(n),i=(u.currency?`${u.currency} `:"")+t,e=new Date().toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),c=[T,u.vendor_id,u.vendor_name].filter(Boolean).join("  ·  ")||"—",V=Dt(n,u.currency||""),w=s.rows.filter(a=>(a.invoice_number??"").trim()!==""||(a.amount??"").trim()!==""||(a.total??"").trim()!==""),F=w.reduce((a,f)=>{const v=parseFloat(String(f.amount??"").replace(/,/g,""));return a+(Number.isNaN(v)?0:v)},0),L=w.reduce((a,f)=>{const v=parseFloat(String(f.tax??"").replace(/,/g,""));return a+(Number.isNaN(v)?0:v)},0),E=(u.currency?`${u.currency} `:"")+A(F),$=[...new Set(w.map(a=>(a.invoice_number??"").trim()).filter(Boolean))],G=new Map;S.value&&$.length>0&&(await Promise.all($.map(f=>b(ot.PAYABLE_INVOICE,{invoiceNumber:f},100)))).forEach((f,v)=>{var I;const U=$[v];U&&((I=f.data)!=null&&I.length)&&G.set(U,f.data.map(H=>H.fieldData).filter(Boolean))});const at=[[{text:"Invoice No.",fillColor:"#ebebeb",bold:!0},{text:"Amount",fillColor:"#ebebeb",bold:!0,alignment:"right"},{text:"Tax",fillColor:"#ebebeb",bold:!0,alignment:"right"},{text:"Tax Amount",fillColor:"#ebebeb",bold:!0,alignment:"right"},{text:"Tax breakdown",fillColor:"#ebebeb",bold:!0,fontSize:9},{text:"Total",fillColor:"#ebebeb",bold:!0,alignment:"right"}],...w.map(a=>{const f=(a.reference??"").trim()||(a.tax??"");return[(a.invoice_number??"").trim()||"—",{text:A(a.amount??""),alignment:"right"},{text:A(a.tax??""),alignment:"right"},{text:A(f),alignment:"right"},{text:k(a),fontSize:9},{text:A(a.total??""),alignment:"right"}]})],it=T?`APPROVED · ${T}`:"APPROVED",st={pageSize:"A4",pageOrientation:"landscape",pageMargins:[40,50,40,70],defaultStyle:{fontSize:10,color:"#000"},watermark:{text:it,color:"#b0b0b0",opacity:.12,bold:!0,angle:-45},content:[{columns:[{text:"Invoice Payment - PDF",fontSize:15,bold:!0},{text:e.toUpperCase(),fontSize:10,alignment:"right",width:"*"}],margin:[0,0,0,10]},{canvas:[{type:"line",x1:0,y1:0,x2:762,y2:0}],margin:[0,4,0,10]},{text:c,alignment:"center",bold:!0,fontSize:12,margin:[0,0,0,6]},{table:{widths:[120,"*"],body:[[{text:"Vendor ID",bold:!0,fillColor:"#f5f5f5"},((d=u.vendor_id)==null?void 0:d.trim())||"—"],[{text:"Vendor name",bold:!0,fillColor:"#f5f5f5"},((C=u.vendor_name)==null?void 0:C.trim())||"—"],[{text:"Date",bold:!0,fillColor:"#f5f5f5"},((R=u.payment_terms)==null?void 0:R.trim())||e],[{text:"Email",bold:!0,fillColor:"#f5f5f5"},((j=u.contact_email)==null?void 0:j.trim())||"—"],[{text:"Currency",bold:!0,fillColor:"#f5f5f5"},((W=u.currency)==null?void 0:W.trim())||"—"]]},layout:{hLineWidth:()=>.2,vLineWidth:()=>.2},margin:[0,0,0,12]},{canvas:[{type:"line",x1:0,y1:0,x2:762,y2:0}],margin:[0,0,0,12]},{table:{headerRows:1,widths:[110,95,90,95,"*",100],body:at},layout:{hLineWidth:()=>.25,vLineWidth:()=>.25},margin:[0,0,0,14]},{columns:[{width:"*",stack:[{text:"Amount in words",bold:!0,fontSize:9,margin:[0,0,0,4]},{text:V,fontSize:10}],fillColor:"#f8f8f8",margin:[0,4,8,4]},{width:240,table:{widths:[130,"*"],body:[[{text:"Sub Total (excl. tax)",fontSize:9,fillColor:"#f5f5f5"},{text:E,fontSize:9,alignment:"right",fillColor:"#f5f5f5"}],[{text:"Total Tax",fontSize:9,fillColor:"#f5f5f5"},{text:A(L),fontSize:9,alignment:"right",fillColor:"#f5f5f5"}],[{text:"Advance Payment",fontSize:9,fillColor:"#f5f5f5"},{text:"—",fontSize:9,alignment:"right",fillColor:"#f5f5f5"}],[{text:"Amount to Pay",fontSize:9,bold:!0,fillColor:"#f5f5f5"},{text:i,fontSize:9,bold:!0,alignment:"right",fillColor:"#f5f5f5"}]]},layout:{hLineWidth:()=>.2,vLineWidth:()=>.2}}]}],footer:(a,f)=>({margin:[40,10,40,0],stack:[{text:`PAGE ${a} of ${f}`,fontSize:9,alignment:"center"},{text:"Finance Payables  ·  "+new Date().toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}),fontSize:8,alignment:"center",margin:[0,2,0,0]}]})},lt=T?`Approved-Payable-${T.replace(/[/\\?%*:|"<>]/g,"-")}.pdf`:"Approved-Payable.pdf";return B.createPdf(st).download(lt),_.success("PDF downloaded."),!0}catch(k){const N=k instanceof Error?k.message:"PDF download failed.";return _.error(N),!1}}return{buildAndDownloadPdf:M}}const kt={class:"content-area flex flex-col flex-1 min-h-0 w-full max-w-[1600px] mx-auto px-4 py-5 md:px-6 md:py-6 min-h-[400px]"},Tt={class:"invoices-header sticky top-0 z-10 -mx-4 -mt-5 px-4 pt-5 pb-4 md:-mx-6 md:-mt-6 md:px-6 md:pt-6 md:pb-4 mb-6 bg-[#0f172a] border-b border-[var(--color-border)]"},Pt={class:"invoices-toolbar"},At={class:"invoice-search-wrap"},Nt={class:"invoice-search relative"},Ft={class:"status-filters"},Lt={key:0,class:"pdf-grid"},$t={key:1,class:"rounded-2xl bg-red-500/10 border border-red-500/20 px-5 py-4 text-[var(--label-size)] text-red-300"},zt={key:2,class:"glass rounded-2xl p-12 text-center"},Mt={class:"text-[var(--color-text-muted)]"},Rt={key:0,class:"invoices-empty-msg"},Bt={key:1,class:"pdf-grid"},Vt=["aria-label"],Et={class:"pdf-thumb__page"},It={class:"pdf-thumb__top"},jt={class:"pdf-thumb__top-right"},Wt=["disabled","onClick"],Ot={key:0,class:"pdf-thumb__download-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},qt={key:1,class:"pdf-thumb__download-spinner","aria-hidden":"true"},Ht={class:"pdf-thumb__title"},Ut={class:"pdf-thumb__sub"},Yt={class:"pdf-thumb__total"},Gt=ft({__name:"InvoicesView",setup(s){const{findRecordsWithIds:g,isConnected:h}=nt(),S=rt(),b=et(),_=tt(),{buildAndDownloadPdf:M}=Ct(),l=z([]),y=z(!1),D=z(null),r=z(""),d=z(""),C=z(null),R=X(()=>{let n=l.value;const t=d.value;t&&(n=n.filter(e=>String(e.fieldData.Status??"").trim()===t));const i=r.value.trim().toLowerCase();return i&&(n=n.filter(e=>{const c=e.fieldData,V=String(c.TransRef??"").toLowerCase(),w=String(c.VendorName??"").toLowerCase(),F=String(c.Status??"").toLowerCase(),L=W(c.Date).toLowerCase(),E=k(c).toLowerCase(),$=String(c.Currency??"").toLowerCase();return V.includes(i)||w.includes(i)||F.includes(i)||L.includes(i)||E.includes(i)||$.includes(i)})),[...n].sort((e,c)=>{const V=e.fieldData.CreationTimestamp??e.fieldData.Date??"",w=c.fieldData.CreationTimestamp??c.fieldData.Date??"",F=new Date(V).getTime(),L=new Date(w).getTime(),E=Number.isNaN(F)?0:F;return(Number.isNaN(L)?0:L)-E})}),j=X(()=>d.value!==""||r.value.trim()!=="");function W(n){if(!n)return"—";try{const t=new Date(n);return Number.isNaN(t.getTime())?n:t.toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"})}catch{return n}}function k(n){const t=(n.Currency??"").toString().trim(),i=n.Total,e=wt(i);return e?t?`${t} ${e}`:e:"—"}function N(n){const t=(n??"").toLowerCase();return t==="draft"?"pdf-thumb__status--draft":t==="posted"?"pdf-thumb__status--posted":t==="rejected"?"pdf-thumb__status--rejected":t==="approved"?"pdf-thumb__status--approved":"pdf-thumb__status--neutral"}function O(n){const t=(n??"").toLowerCase();return t==="draft"?"bg-amber-500/15 text-amber-400":t==="posted"?"bg-blue-500/15 text-blue-400":t==="rejected"?"bg-red-500/15 text-red-400":t==="approved"?"bg-emerald-500/15 text-emerald-400":"bg-white/10 text-[var(--color-text-muted)]"}function B(n){const t=S.invoiceDownloadWhen;if(t==="none")return!1;const i=(n??"").trim();return t==="approved_only"?i==="Approved":t==="once_posted"?i==="Posted"||i==="Approved":!1}async function q(n){const t=(n??"").trim();if(!(!t||!h.value)){C.value=t;try{if(await _.fetchDetailsByTransRef(t),_.error){b.error(_.error);return}if(!_.mainPosted){b.error("Entry not found or not available for PDF download.");return}const i=_.mainStatus,e=S.invoiceDownloadWhen;if(!(e==="approved_only"?i==="Approved":e==="once_posted"?i==="Posted"||i==="Approved":!1)){b.error("This entry is not available for PDF download with current settings.");return}await M()}catch(i){const e=i instanceof Error?i.message:"Download failed.";b.error(e)}finally{C.value=null}}}function T(n){const t=(n??"").toLowerCase();return t==="draft"?"pdf-thumb__dot--draft":t==="posted"?"pdf-thumb__dot--posted":t==="rejected"?"pdf-thumb__dot--rejected":t==="approved"?"pdf-thumb__dot--approved":"pdf-thumb__dot--neutral"}async function u(){if(!h.value){l.value=[];return}y.value=!0,D.value=null;try{const n=await g(ot.PAYABLES_MAIN,{limit:500});n.error?(b.error(n.error),l.value=[]):l.value=n.data}finally{y.value=!1}}return ct(u),mt(h,n=>{n&&u()}),(n,t)=>{const i=xt("router-link");return m(),p("div",kt,[o("header",Tt,[t[11]||(t[11]=o("h1",{class:"text-[1.75rem] font-bold tracking-tight text-[var(--color-text)] md:text-[2rem]",style:{"letter-spacing":"-0.025em","line-height":"1.2"}}," Invoices ",-1)),t[12]||(t[12]=o("p",{class:"mt-1.5 text-[13px] text-[var(--color-text-muted)]"}," All payable entries as PDF-style thumbnails. Click any thumbnail to open the entry. ",-1)),o("div",Pt,[o("div",At,[t[9]||(t[9]=o("label",{for:"invoice-search",class:"sr-only"},"Search invoices",-1)),o("div",Nt,[t[8]||(t[8]=o("svg",{class:"invoice-search__icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),pt(o("input",{id:"invoice-search","onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),type:"search",autocomplete:"off",placeholder:"Search by ref, vendor…",class:"invoice-search__input glass-input"},null,512),[[vt,r.value]]),r.value?(m(),p("button",{key:0,type:"button",class:"invoice-search__clear","aria-label":"Clear search",onClick:t[1]||(t[1]=e=>r.value="")},[...t[7]||(t[7]=[o("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])):K("",!0)])]),o("div",Ft,[t[10]||(t[10]=o("span",{class:"status-filters__label"},"Status",-1)),o("button",{type:"button",class:x(["status-filter-pill",{"status-filter-pill--active":d.value===""}]),onClick:t[2]||(t[2]=e=>d.value="")}," All ",2),o("button",{type:"button",class:x(["status-filter-pill status-filter-pill--draft",{"status-filter-pill--active":d.value==="Draft"}]),onClick:t[3]||(t[3]=e=>d.value="Draft")}," Draft ",2),o("button",{type:"button",class:x(["status-filter-pill status-filter-pill--posted",{"status-filter-pill--active":d.value==="Posted"}]),onClick:t[4]||(t[4]=e=>d.value="Posted")}," Posted ",2),o("button",{type:"button",class:x(["status-filter-pill status-filter-pill--rejected",{"status-filter-pill--active":d.value==="Rejected"}]),onClick:t[5]||(t[5]=e=>d.value="Rejected")}," Rejected ",2),o("button",{type:"button",class:x(["status-filter-pill status-filter-pill--approved",{"status-filter-pill--active":d.value==="Approved"}]),onClick:t[6]||(t[6]=e=>d.value="Approved")}," Approved ",2)])])]),y.value?(m(),p("div",Lt,[(m(),p(Y,null,J(12,e=>o("div",{key:e,class:"pdf-tile pdf-tile--skeleton"},[...t[13]||(t[13]=[ht('<div class="pdf-thumb" data-v-b44283ac><div class="pdf-thumb__page animate-pulse" data-v-b44283ac><div class="pdf-thumb__top" data-v-b44283ac><span class="pdf-thumb__tag" data-v-b44283ac>PDF</span><span class="pdf-thumb__dot pdf-thumb__dot--neutral" data-v-b44283ac></span></div><div class="pdf-thumb__title-line" data-v-b44283ac></div><div class="pdf-thumb__sub-line" data-v-b44283ac></div><div class="pdf-thumb__line pdf-thumb__line--w1" data-v-b44283ac></div><div class="pdf-thumb__line pdf-thumb__line--w2" data-v-b44283ac></div><div class="pdf-thumb__line pdf-thumb__line--w3" data-v-b44283ac></div><div class="pdf-thumb__line pdf-thumb__line--w4" data-v-b44283ac></div></div></div>',1)])])),64))])):D.value?(m(),p("div",$t,P(D.value),1)):l.value.length===0?(m(),p("div",zt,[o("p",Mt,P(bt(h)?"No invoices yet.":"Connect to FileMaker to load invoices."),1)])):(m(),p(Y,{key:3},[R.value.length===0?(m(),p("p",Rt," No invoices match your "+P(j.value?"filters":"search")+". ",1)):(m(),p("div",Bt,[(m(!0),p(Y,null,J(R.value,e=>(m(),_t(i,{key:e.recordId,to:{name:"entry",query:{transRef:e.fieldData.TransRef??"",from:"invoices"}},class:"pdf-tile"},{default:gt(()=>[o("div",{class:"pdf-thumb","aria-label":`Open invoice ${String(e.fieldData.TransRef??"").trim()}`},[o("div",Et,[o("div",It,[t[15]||(t[15]=o("span",{class:"pdf-thumb__tag"},"PDF",-1)),o("div",jt,[B(e.fieldData.Status)?(m(),p("button",{key:0,type:"button",class:"pdf-thumb__download",title:"Download PDF","aria-label":"Download PDF",disabled:C.value!==null,onClick:yt(c=>q(e.fieldData.TransRef),["stop"])},[C.value!==(e.fieldData.TransRef??"")?(m(),p("svg",Ot,[...t[14]||(t[14]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"},null,-1)])])):(m(),p("span",qt))],8,Wt)):K("",!0),o("span",{class:x(["pdf-thumb__dot",T(e.fieldData.Status)])},null,2)])]),o("div",Ht,P(e.fieldData.TransRef||"—"),1),o("div",Ut,P(e.fieldData.VendorName||"—"),1),o("div",Yt,P(k(e.fieldData)),1),o("span",{class:x(["pdf-thumb__status",N(e.fieldData.Status)])},P(e.fieldData.Status||"—"),3),o("div",{class:x(["pdf-thumb__icon",O(e.fieldData.Status)]),"aria-hidden":"true"},[...t[16]||(t[16]=[o("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})],-1)])],2),t[17]||(t[17]=o("div",{class:"pdf-thumb__line pdf-thumb__line--w1"},null,-1)),t[18]||(t[18]=o("div",{class:"pdf-thumb__line pdf-thumb__line--w2"},null,-1)),t[19]||(t[19]=o("div",{class:"pdf-thumb__line pdf-thumb__line--w3"},null,-1)),t[20]||(t[20]=o("div",{class:"pdf-thumb__line pdf-thumb__line--w4"},null,-1))])],8,Vt)]),_:2},1032,["to"]))),128))]))],64))])}}}),Jt=St(Gt,[["__scopeId","data-v-b44283ac"]]);export{Jt as default};
