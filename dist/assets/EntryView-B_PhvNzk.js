const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdfmake-B32-QUBv.js","assets/_commonjsHelpers-Cpj98o6Y.js","assets/vfs_fonts-D-4-wbPz.js"])))=>i.map(i=>d[i]);
import{d as Ae,N as jt,O as et,o as mt,a as Nt,E as me,j as a,c as s,e,f as ve,g as P,T as Fe,h as Ee,p as Mt,H as Ut,x as se,F as U,z as oe,w as ae,t as x,q as B,m as _,i as V,r as C,L as fe,k as Dt,_ as tt,G as Et,P as At,v as ao,n as ft,u as Ht,Q as Me,A as St,R as De,C as so,S as lo,b as io,U as uo,V as Ft,K as co,I as vo,l as fo,W as po,X as mo}from"./index-oHQmfbVN.js";import{_ as re}from"./Skeleton.vue_vue_type_script_setup_true_lang-Lbwj0Rap.js";import{u as bo}from"./documentSettingsStore-BGsV5kuI.js";const ho={class:"vendor-details glass overflow-hidden rounded-2xl border border-[var(--color-border)] shadow-sm"},_o=["aria-expanded"],go={class:"vendor-details__body"},yo={class:"vendor-details__grid"},xo={class:"vendor-details__field"},wo={class:"tax-modal__search-dropdown-input-wrap"},ko=["value","readonly"],Co={key:0,class:"tax-modal__search-dropdown-list",role:"listbox"},Ro=["onMousedown"],So={class:"font-semibold text-[var(--color-accent)]"},$o={key:0,class:"ml-2 text-[var(--color-text-muted)] text-[0.8125rem]"},To={key:0,class:"px-4 py-3 text-[0.8125rem] text-[var(--color-text-muted)] m-0"},No={key:1,class:"px-4 py-3 text-[0.8125rem] text-[var(--color-text-muted)] m-0"},jo={key:2,class:"px-4 py-3 text-[0.8125rem] text-[var(--color-text-muted)] m-0"},Mo={class:"vendor-details__field"},Do=["value","readonly"],Eo={class:"vendor-details__field"},Ao=["value","readonly"],Lo={class:"vendor-details__field"},Po=["value","readonly"],Bo={class:"vendor-details__field"},zo={class:"vendor-details__select-wrap"},Vo=["value","disabled"],Oo={key:0,class:"vendor-details__error",role:"alert"},Fo=Ae({__name:"VendorDetails",setup(p){const b=jt(),d=et(),{findRecordsWithIds:R,isConnected:m}=Dt(),i=V(()=>b.vendor),T=C(!1),y=C(null),N=C(!1),H=C(""),E=V(()=>d.mainPosted&&d.mainStatus!=="Rejected"),h=C([]),M=C(!1);function j(v){const u=v.fieldData;return String(u.Vendor_ID??u["Vendor ID"]??"").trim()}function Z(v){const u=v.fieldData;return String(u.Vendor_Name??u["Vendor Name"]??"").trim()}function K(v){const u=j(v);return u!==""&&u===i.value.vendor_id}const F=V(()=>{const v=H.value.toLowerCase();return v?h.value.filter(u=>{const D=j(u).toLowerCase(),ye=Z(u).toLowerCase();return D.includes(v)||ye.includes(v)}):h.value});async function G(){if(!m.value){h.value=[];return}M.value=!0;const{data:v,error:u}=await R(fe.VENDOR_TBL,{limit:500});M.value=!1,h.value=u?[]:v}function O(v){H.value=v,b.setField("vendor_id",v),E.value||d.markDirty(),N.value=!0}function Q(v){const u=j(v),D=Z(v);b.setField("vendor_id",u),b.setField("vendor_name",D),H.value="",N.value=!1,E.value||d.markDirty()}function S(v,u){b.setField(v,u),E.value||d.markDirty()}function w(v){y.value&&!y.value.contains(v.target)&&(N.value=!1)}return mt(()=>{G(),document.addEventListener("click",w)}),Nt(()=>{document.removeEventListener("click",w)}),me(m,v=>{v&&G()}),(v,u)=>(a(),s("section",ho,[e("button",{type:"button",class:"vendor-details__header","aria-expanded":!T.value,onClick:u[0]||(u[0]=D=>T.value=!T.value)},[u[8]||(u[8]=e("span",{class:"vendor-details__title"},"Vendor details",-1)),(a(),s("svg",{class:ve(["vendor-details__chevron",{"vendor-details__chevron--open":!T.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[...u[7]||(u[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))],8,_o),P(Fe,{name:"vendor-details-body"},{default:Ee(()=>[Mt(e("div",go,[e("div",yo,[e("label",xo,[u[10]||(u[10]=e("span",{class:"vendor-details__label"},[se("Vendor ID "),e("span",{class:"vendor-details__required"},"Required")],-1)),e("div",{ref_key:"vendorDropdownRef",ref:y,class:"tax-modal__search-dropdown"},[e("div",wo,[e("input",{value:i.value.vendor_id,type:"text",class:"tax-modal__search-dropdown-input",placeholder:"Search or select vendor…",readonly:E.value,autocomplete:"off",onFocus:u[1]||(u[1]=D=>E.value?null:N.value=!0),onInput:u[2]||(u[2]=D=>O(D.target.value))},null,40,ko),e("span",{class:ve(["tax-modal__search-dropdown-chevron",{"tax-modal__search-dropdown-chevron--open":N.value}]),"aria-hidden":"true"},[...u[9]||(u[9]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M6 9l6 6 6-6"})],-1)])],2)]),P(Fe,{name:"search-dropdown"},{default:Ee(()=>[N.value&&!E.value?(a(),s("div",Co,[(a(!0),s(U,null,oe(F.value,(D,ye)=>(a(),s("button",{key:D.recordId||ye,type:"button",role:"option",class:ve(["tax-modal__search-dropdown-item",{"tax-modal__search-dropdown-item--highlight":K(D)}]),onMousedown:ae(ot=>Q(D),["prevent"])},[e("span",So,x(j(D)),1),Z(D)?(a(),s("span",$o,x(Z(D)),1)):B("",!0)],42,Ro))),128)),h.value.length>0&&F.value.length===0?(a(),s("p",To," No matching vendors ")):h.value.length===0&&!M.value?(a(),s("p",No," No vendors yet ")):M.value?(a(),s("p",jo," Loading… ")):B("",!0)])):B("",!0)]),_:1})],512)]),e("label",Mo,[u[11]||(u[11]=e("span",{class:"vendor-details__label"},[se("Vendor name "),e("span",{class:"vendor-details__required"},"Required")],-1)),e("input",{value:i.value.vendor_name,type:"text",class:"vendor-details__input",placeholder:"Acme Corp",readonly:E.value,onInput:u[3]||(u[3]=D=>S("vendor_name",D.target.value))},null,40,Do)]),e("label",Eo,[u[12]||(u[12]=e("span",{class:"vendor-details__label"},"Date",-1)),e("input",{value:i.value.payment_terms,type:"date",class:"vendor-details__input vendor-details__input--date",readonly:E.value,onInput:u[4]||(u[4]=D=>S("payment_terms",D.target.value))},null,40,Ao)]),e("label",Lo,[u[13]||(u[13]=e("span",{class:"vendor-details__label"},"Contact email",-1)),e("input",{value:i.value.contact_email,type:"email",class:"vendor-details__input",placeholder:"vendor@example.com",readonly:E.value,onInput:u[5]||(u[5]=D=>S("contact_email",D.target.value))},null,40,Po)]),e("label",Bo,[u[16]||(u[16]=e("span",{class:"vendor-details__label"},"Currency",-1)),e("div",zo,[e("select",{value:i.value.currency,class:"vendor-details__input vendor-details__select",disabled:E.value,onChange:u[6]||(u[6]=D=>S("currency",D.target.value))},[...u[14]||(u[14]=[e("option",{value:"GHS"},"GHS",-1),e("option",{value:"EUR"},"EUR",-1),e("option",{value:"GBP"},"GBP",-1),e("option",{value:"USD"},"USD",-1),e("option",{value:"CAD"},"CAD",-1)])],40,Vo),u[15]||(u[15]=e("svg",{class:"vendor-details__select-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-6 6-6-6"})],-1))])])]),_(b).error?(a(),s("p",Oo,x(_(b).error),1)):B("",!0)],512),[[Ut,!T.value]])]),_:1})]))}}),Io=tt(Fo,[["__scopeId","data-v-9a7cd194"]]),Wo={key:0,class:"unsaved-modal-backdrop",role:"dialog","aria-modal":"true","aria-labelledby":"unsaved-modal-title","aria-describedby":"unsaved-modal-desc"},Uo=Ae({__name:"UnsavedChangesModal",props:{visible:{type:Boolean}},emits:["confirm","cancel"],setup(p,{emit:b}){const d=b;function R(){d("confirm")}function m(){d("cancel")}return(i,T)=>(a(),Et(At,{to:"body"},[P(Fe,{name:"unsaved-modal"},{default:Ee(()=>[p.visible?(a(),s("div",Wo,[e("div",{class:"unsaved-modal"},[T[0]||(T[0]=e("div",{class:"unsaved-modal__icon-wrap"},[e("svg",{class:"unsaved-modal__icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),T[1]||(T[1]=e("h2",{id:"unsaved-modal-title",class:"unsaved-modal__title"}," Unsaved changes ",-1)),T[2]||(T[2]=e("p",{id:"unsaved-modal-desc",class:"unsaved-modal__message"}," You have unsaved changes. Leave anyway? ",-1)),e("div",{class:"unsaved-modal__actions"},[e("button",{type:"button",class:"unsaved-modal__btn unsaved-modal__btn--primary",onClick:m}," Stay "),e("button",{type:"button",class:"unsaved-modal__btn unsaved-modal__btn--danger",onClick:R}," Leave ")])])])):B("",!0)]),_:1})]))}}),Ho=tt(Uo,[["__scopeId","data-v-574025db"]]),Yo={key:0,class:"reject-modal-backdrop",role:"dialog","aria-modal":"true","aria-labelledby":"reject-modal-title","aria-describedby":"reject-modal-desc"},qo={key:0,class:"reject-modal__error",role:"alert"},Zo={class:"reject-modal__actions"},Xo=["disabled"],Ko=Ae({__name:"RejectReasonModal",props:{visible:{type:Boolean}},emits:["submit","cancel"],setup(p,{emit:b}){const d=p,R=b,m=C(""),i=C(""),T=C(!1),y=C(null);me(()=>d.visible,E=>{E&&(m.value="",i.value="",T.value=!1,requestAnimationFrame(()=>{var h;(h=y.value)==null||h.focus()}))});function N(){R("cancel")}function H(){const E=m.value.trim();if(!E){i.value="Please enter a reason for rejection.";return}i.value="",T.value=!0,R("submit",E)}return(E,h)=>(a(),Et(At,{to:"body"},[P(Fe,{name:"reject-modal"},{default:Ee(()=>[p.visible?(a(),s("div",Yo,[e("div",{class:"reject-modal",role:"document",onClick:h[1]||(h[1]=ae(()=>{},["stop"]))},[e("header",{class:"reject-modal__header"},[h[3]||(h[3]=e("h2",{id:"reject-modal-title",class:"reject-modal__title"},"Reject entry",-1)),e("button",{type:"button",class:"reject-modal__close","aria-label":"Cancel",onClick:N},[...h[2]||(h[2]=[e("svg",{class:"reject-modal__close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),h[5]||(h[5]=e("p",{id:"reject-modal-desc",class:"reject-modal__desc"}," Enter the reason the officer needs to address. This will be shown when they view the rejected entry. ",-1)),e("form",{class:"reject-modal__form",onSubmit:ae(H,["prevent"])},[h[4]||(h[4]=e("label",{class:"reject-modal__label",for:"reject-reason-input"}," Reason ",-1)),Mt(e("textarea",{id:"reject-reason-input",ref_key:"textareaRef",ref:y,"onUpdate:modelValue":h[0]||(h[0]=M=>m.value=M),class:"reject-modal__textarea",placeholder:"e.g. Wrong vendor name, missing invoice number, amount mismatch...",rows:"4",autofocus:""},null,512),[[ao,m.value]]),i.value?(a(),s("p",qo,x(i.value),1)):B("",!0),e("div",Zo,[e("button",{type:"button",class:"reject-modal__btn reject-modal__btn--cancel",onClick:N}," Cancel "),e("button",{type:"submit",class:"reject-modal__btn reject-modal__btn--danger",disabled:T.value},x(T.value?"Rejecting…":"Reject"),9,Xo)])],32)])])):B("",!0)]),_:1})]))}}),Go=tt(Ko,[["__scopeId","data-v-2598b29b"]]),Qo={key:0,class:"flex flex-wrap items-center gap-2 rounded-[var(--radius-card)] border border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-2 backdrop-blur-[var(--blur-glass)]"},Jo=["disabled"],en=Ae({__name:"Toolbar",props:{canDeleteRow:{type:Boolean,default:!0}},emits:["add-row","delete-row"],setup(p){const b=et(),d=V(()=>b.mainPosted);return(R,m)=>d.value?B("",!0):(a(),s("div",Qo,[e("button",{type:"button",class:"pill-btn flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-[var(--input-size)] text-[var(--color-text)] hover:bg-[var(--color-accent-soft)]",onClick:m[0]||(m[0]=i=>R.$emit("add-row"))},[...m[3]||(m[3]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),se(" Add row ",-1)])]),e("button",{type:"button",class:"pill-btn flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-[var(--input-size)] text-[var(--color-text)] hover:bg-red-500/10 hover:text-red-400",disabled:!p.canDeleteRow,onClick:m[1]||(m[1]=i=>R.$emit("delete-row"))},[...m[4]||(m[4]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),se(" Delete row ",-1)])],8,Jo),_(b).hasUndoDelete?(a(),s("button",{key:0,type:"button",class:"pill-btn flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-[var(--input-size)] text-[var(--color-accent)] hover:bg-[var(--color-accent-soft)]",onClick:m[2]||(m[2]=i=>_(b).undoDelete())},[...m[5]||(m[5]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1),se(" Undo delete ",-1)])])):B("",!0)]))}}),tn=/^([A-Z]+)(\d+)$/i;function on(p){if(!p||!/^[A-Z]+$/i.test(p))return-1;let b=0;const d=p.toUpperCase();for(let R=0;R<d.length;R++)b=b*26+(d.charCodeAt(R)-64);return b-1}function $t(p,b){if(!p||typeof p!="string")return null;const d=p.trim().toUpperCase().match(tn);if(d){const R=on(d[1]),m=parseInt(d[2],10)-1;if(m>=0&&R>=0)return{row:m,col:R}}return b&&p in b?{row:-1,col:b[p]}:null}function It(p,b){const d=p.match(/^([A-Za-z_]+)(\d+)$/);if(d&&b){const R=b[d[1]],m=parseInt(d[2],10)-1;if(R!==void 0&&m>=0)return{row:m,col:R}}return null}function nn(p,b,d={}){if(!p||typeof p!="string")return p;const R=p.trim();if(!R.startsWith("="))return p;const m=R.slice(1).trim(),i=m.match(/^SUM\s*\(\s*([A-Za-z0-9]+)\s*:\s*([A-Za-z0-9]+)\s*\)$/i);if(i){const E=i[1],h=i[2],M=$t(E,d)??It(E,d),j=$t(h,d)??It(h,d);if(M&&j){const Z=Math.min(M.row,j.row),K=Math.max(M.row,j.row),F=Math.min(M.col,j.col),G=Math.max(M.col,j.col);let O=0;for(let Q=Z;Q<=K;Q++)for(let S=F;S<=G;S++){const w=b(Q,S),v=parseFloat(String(w));Number.isNaN(v)||(O+=v)}return O}}let T=m;const y=m.match(/\b[A-Z]+\d+\b/gi)??[],N=new Set;for(const E of y){if(N.has(E))continue;N.add(E);const h=$t(E,d);if(h&&h.row>=0){const M=b(h.row,h.col),j=parseFloat(String(M)),Z=Number.isNaN(j)?"0":String(j);T=T.replace(new RegExp(E.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),Z)}}const H=T.replace(/\s/g,"");if(/^[\d.\s+\-*/()]+$/.test(H))try{return Function(`"use strict"; return (${H})`)()}catch{return p}return p}const Je=["invoice_number","amount","tax","reference","total"],rn=60,an=150,Ge=Je.length,_e=C({row:0,col:0}),Qe=C(null),vt=C(!1);function Yt(){const p=et(),b=V(()=>p.rows),d=V(()=>b.value.length),R=V(()=>Ge),m=V(()=>_e.value),i=V(()=>_e.value.row),T=V(()=>_e.value.col),y=V(()=>{const S={};return Je.forEach((w,v)=>{const u=w.replace(/_/g," ").replace(/\b\w/g,D=>D.toUpperCase());S[u]=v,S[w]=v}),S});function N(S,w){const v=b.value[S];if(!v)return"";const u=Je[w],D=v[u];return D??""}function H(S,w,v){const u=Je[w];p.updateCell(S,u,String(v))}function E(S){return nn(S,N,y.value)}function h(S,w){const v=Math.max(0,Math.min(S,d.value-1)),u=Math.max(0,Math.min(w,Ge-1));_e.value={row:v,col:u}}function M(S){const{row:w,col:v}=_e.value;switch(S){case"up":h(w-1,v);break;case"down":h(w+1,v);break;case"left":h(w,v-1);break;case"right":h(w,v+1);break;case"tab":v<Ge-1?h(w,v+1):h(w+1,0);break;case"tabReverse":v>0?h(w,v-1):h(w-1,Ge-1);break;case"enter":h(w+1,v);break;case"enterReverse":h(w-1,v);break}}function j(){p.addRow(),h(d.value-1,0)}function Z(S){p.removeRow(S),d.value===0&&p.addRow();const w=Math.min(S,d.value-1);w>=0&&h(w,T.value)}function K(){const{row:S,col:w}=_e.value,v=N(S,w);Qe.value=v,vt.value=!1}function F(){K(),vt.value=!0}function G(){if(Qe.value==null)return;const{row:S,col:w}=_e.value;H(S,w,Qe.value),vt.value&&(H(_e.value.row,_e.value.col,""),vt.value=!1,Qe.value=null)}function O(){const{row:S,col:w}=_e.value;H(S,w,"")}function Q(){const{row:S}=_e.value;S===d.value-1&&j()}return{COLUMN_KEYS:Je,ROW_HEADER_WIDTH:rn,COL_WIDTH:an,COL_COUNT:Ge,rows:b,rowCount:d,colCount:R,selected:m,selectedRow:i,selectedCol:T,headerToCol:y,getCellValue:N,setCellValue:H,evaluateCellFormula:E,selectCell:h,moveSelection:M,addRow:j,deleteRow:Z,copy:K,cut:F,paste:G,clearCell:O,ensureRowForEnter:Q,hasClipboard:V(()=>Qe.value!=null)}}const Tt=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],sn=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];function ln(p){return p.length>0?p.charAt(0).toUpperCase()+p.slice(1):""}function pt(p){if(p===0)return"";if(p<20)return Tt[p];if(p<100){const m=Math.floor(p/10),i=p%10;return(sn[m]+(i>0?"-"+Tt[i]:"")).trim()}const b=Math.floor(p/100),d=p%100,R=d>0?" "+pt(d):"";return Tt[b]+" hundred"+R}function dn(p){if(!Number.isFinite(p)||Number.isNaN(p))return"Zero";const b=Math.max(0,Math.min(99999999999e-2,p)),d=Math.floor(b),R=Math.round((b-d)*100);if(d===0&&R===0)return"Zero";let m="";if(d>=1e6){const T=Math.floor(d/1e6);m+=pt(T)+" million "}let i=d%1e6;if(i>=1e3){const T=Math.floor(i/1e3);m+=pt(T)+" thousand "}return i=d%1e3,i>0&&(m+=(m.length>0?"and ":"")+pt(i)),m=m.trim(),m===""&&(m="zero"),R>0&&(m+=" and "+String(R).padStart(2,"0")+"/100"),ln(m.trim())}function un(p){return p==null?!1:String(p).trim().startsWith("=")}const cn=Ae({__name:"ContextMenu",props:{visible:{type:Boolean,default:!1},x:{default:0},y:{default:0}},emits:["copy","paste","cut","clear"],setup(p,{emit:b}){const d=b;function R(){d("copy")}function m(){d("paste")}function i(){d("cut")}function T(){d("clear")}return(y,N)=>(a(),Et(At,{to:"body"},[Mt(e("div",{class:"fixed z-[100] min-w-[160px] rounded-[var(--radius-card)] border border-[var(--color-border)] py-1 shadow-xl",style:ft([{background:"var(--color-bg-card)","backdrop-filter":"blur(var(--blur-glass))","-webkit-backdrop-filter":"blur(var(--blur-glass))",transition:"opacity 0.15s var(--ease)"},{left:`${p.x}px`,top:`${p.y}px`}]),onClick:N[0]||(N[0]=ae(()=>{},["stop"]))},[e("button",{type:"button",class:"flex w-full items-center gap-2 px-3 py-2 text-left text-[var(--input-size)] text-[var(--color-text)] hover:bg-white/10",onClick:R},[...N[1]||(N[1]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),se(" Copy ",-1)])]),e("button",{type:"button",class:"flex w-full items-center gap-2 px-3 py-2 text-left text-[var(--input-size)] text-[var(--color-text)] hover:bg-white/10",onClick:m},[...N[2]||(N[2]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})],-1),se(" Paste ",-1)])]),e("button",{type:"button",class:"flex w-full items-center gap-2 px-3 py-2 text-left text-[var(--input-size)] text-[var(--color-text)] hover:bg-white/10",onClick:i},[...N[3]||(N[3]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.242 4.242 3 3 0 004.242-4.242zm0-5.758a3 3 0 10-4.242-4.242 3 3 0 004.242 4.242z"})],-1),se(" Cut ",-1)])]),e("button",{type:"button",class:"flex w-full items-center gap-2 px-3 py-2 text-left text-[var(--input-size)] text-[var(--color-text)] hover:bg-white/10",onClick:T},[...N[4]||(N[4]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),se(" Clear ",-1)])])],4),[[Ut,p.visible]])]))}}),vn={class:"data-grid-wrapper flex flex-col flex-1 min-h-0 rounded-xl border border-[var(--color-border)] bg-[var(--color-bg-card)] shadow-sm overflow-hidden"},fn={class:"sticky top-0 z-10 bg-[var(--color-bg-dark)]"},pn=["onClick"],mn=["onClick"],bn={key:0,class:"cell-display"},hn=["value","onChange"],_n=["value"],gn={class:"cell-tax-wrap flex items-center gap-1 min-w-0"},yn={class:"cell-display flex-1 min-w-0"},xn=["onClick"],wn={key:0,class:"cell-tax-breakdown-loading"},kn={key:0,class:"cell-tax-breakdown-list"},Cn={key:1,class:"cell-tax-breakdown-empty"},Rn={key:3,class:"cell-display"},Sn={key:4,class:"cell-display"},$n=["value","onInput"],Tn={key:0,class:"data-grid-row-actions"},Nn=["aria-expanded","onClick"],jn={class:"data-grid-row-actions__panel"},Mn={key:0,class:"data-grid-row-actions__header"},Dn={key:0,class:"data-grid-row-actions__header-badge"},En={key:0,class:"data-grid-row-actions__state"},An={key:1,class:"data-grid-row-actions__state"},Ln={key:2},Pn={class:"data-grid-row-actions__group"},Bn={class:"data-grid-row-actions__list"},zn=["onClick"],Vn={key:0,class:"data-grid-row-actions__checkmark",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},On={key:1,class:"data-grid-row-actions__checkmark-placeholder"},Fn={class:"data-grid-row-actions__option-label"},In={key:2,class:"data-grid-row-actions__option-meta"},Wn={key:3,class:"data-grid-row-actions__chevron",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},Un={class:"data-grid-row-actions__group"},Hn={class:"data-grid-row-actions__list"},Yn=["onClick"],qn={key:0,class:"data-grid-row-actions__checkmark",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},Zn={key:1,class:"data-grid-row-actions__checkmark-placeholder"},Xn={class:"data-grid-row-actions__option-label"},Kn={class:"data-grid-row-actions__option-meta"},Gn={key:0,class:"flex flex-wrap items-center justify-between gap-3 px-4 py-3 border-t border-[var(--color-border)] bg-[var(--color-bg-dark)]/50 text-[var(--label-size)]"},Qn={class:"flex items-center gap-4"},Jn={class:"text-[var(--color-text-muted)]"},er={class:"flex items-center gap-2 text-[var(--color-text-muted)]"},tr=["value"],or=["value"],nr={class:"flex items-center gap-2"},rr=["disabled"],ar={class:"px-2 py-1.5 text-[var(--color-text-muted)]"},sr=["disabled"],lr={class:"entry-total-row flex flex-wrap items-end justify-between gap-6 px-4 py-4 border-t-2 border-[var(--color-border)] bg-[var(--color-bg-dark)]"},ir={class:"entry-total-row__left flex flex-col items-start gap-0.5"},dr={class:"entry-total-row__words"},ur={class:"entry-total-row__value text-xl font-bold text-[var(--color-text)] tabular-nums tracking-tight"},cr=Ae({__name:"DataGrid",setup(p){const b=Yt(),d=et(),R=jt(),m=Ht();function i(o){return St(o)||"0.00"}const T=V(()=>dn(d.entryTotal)),{findRecordsWithIds:y,findRecordsByQuery:N,findRecordsByQueryWithIds:H,createRecord:E,deleteRecord:h,isConnected:M}=Dt(),{COLUMN_KEYS:j,ROW_HEADER_WIDTH:Z,rows:K,selectedRow:F,selectedCol:G,getCellValue:O,setCellValue:Q,evaluateCellFormula:S,selectCell:w,moveSelection:v,ensureRowForEnter:u,copy:D,cut:ye,paste:ot,clearCell:Le}=b,Pe=[10,15,25,50],ne=C(15),q=C(1),ge=V(()=>K.value.length),le=V(()=>Math.max(1,Math.ceil(ge.value/ne.value))),bt=V(()=>{const o=ge.value;if(o===0)return[];const t=(q.value-1)*ne.value,n=Math.min(t+ne.value,o),r=[];for(let f=t;f<n;f++)r.push(f);return r}),ht=V(()=>ge.value===0?0:(q.value-1)*ne.value+1),_t=V(()=>Math.min(q.value*ne.value,ge.value));me(F,o=>{const t=Math.floor(o/ne.value)+1;t>=1&&t<=le.value&&t!==q.value&&(q.value=t)}),me(ge,()=>{q.value>le.value&&(q.value=Math.max(1,le.value))});const nt=d.STATUS_OPTIONS,rt=V(()=>d.mainPosted&&d.mainStatus!=="Rejected"),Se=j.indexOf("tax"),at=j.indexOf("reference"),gt=j.indexOf("amount"),xe=j.indexOf("invoice_number"),X=C(null),ue=C(null),we=C(new Set),c=C(new Map),l=C(null),z=C([]),$=C(!1),k=C(null),Y=C([]),ce=C(!1),J=C(null),be=C(null),ee=C(new Map);async function A(){if(!M.value)return;$.value=!0;const{data:o}=await y(fe.TAX_VALUE,{limit:500});z.value=o,$.value=!1}function Ie(){k.value=null,Y.value=[],J.value=null}async function We(o,t){const n=O(o,xe),r=n!=null&&String(n).trim()!==""?String(n).trim():"";if(k.value===o){Ie();return}if(k.value=o,Y.value=[],J.value=null,!r){J.value="Enter invoice number first, then add tax via row menu (⋯).",ce.value=!1,De(()=>Ue(t));return}ce.value=!0;const{data:f,error:g}=await N(fe.PAYABLE_INVOICE,{invoiceNumber:r},100);ce.value=!1,g?Y.value=[{TaxName:`Error: ${g}`,Rate:void 0}]:Y.value=f.map(W=>({TaxName:W.TaxName??"—",Rate:W.Rate})),De(()=>Ue(t))}function Ue(o){var r;const t=be.value,n=(r=o.target)==null?void 0:r.closest(".cell-tax-breakdown-trigger");if(t&&n){const f=n.getBoundingClientRect();t.style.position="fixed",t.style.left=`${f.left}px`,t.style.top=`${f.bottom+4}px`,t.style.zIndex="50"}}function ke(o){const t=(o??"").trim();if(!t)return null;const n=/^(\d{4})-(\d{2})-(\d{2})$/.exec(t);if(n){const g=new Date(parseInt(n[1],10),parseInt(n[2],10)-1,parseInt(n[3],10));return Number.isNaN(g.getTime())?null:g}const r=/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/.exec(t);if(r){const g=new Date(parseInt(r[3],10),parseInt(r[1],10)-1,parseInt(r[2],10));return Number.isNaN(g.getTime())?null:g}const f=new Date(t);return Number.isNaN(f.getTime())?null:f}function te(o,t){const{fieldData:n}=o,r=ke(n.Start_Date),f=ke(n.End_Date);return!(r!==null&&r>t||f!==null&&f<t)}const st=V(()=>{const o=new Date;return o.setHours(0,0,0,0),z.value.filter(t=>te(t,o))}),He=V(()=>{const o=st.value,t=new Map;for(const{fieldData:n}of o){const r=(n.Tax_Type??"").trim()||"—";t.has(r)||t.set(r,[]),t.get(r).push(n)}return Array.from(t.entries()).map(([n,r])=>({typeKey:n,typeLabel:n,items:r}))}),yt=V(()=>{const o=ue.value;if(!o)return[];const t=He.value.find(n=>n.typeLabel===o);return(t==null?void 0:t.items)??[]});function Ye(o){if(o==null||o==="")return"—";const t=Number(o);return Number.isNaN(t)?"—":`${t}%`}function lt(o){const t=O(o,Se);if(t==null||String(t).trim()==="")return"";const n=Number(t);return Number.isNaN(n)?String(t).trim():`${n}%`}async function xt(o){if(!M.value)return;const t=O(o,xe),n=t!=null&&String(t).trim()!==""?String(t).trim():"";if(n===""){ee.value.set(o,[]);return}const{data:r}=await H(fe.PAYABLE_INVOICE,{invoiceNumber:n},100);ee.value.set(o,r.map(f=>f.fieldData))}function Be(o){X.value===o?(X.value=null,ue.value=null):(X.value=o,ue.value=null,xt(o))}function ze(o,t,n){const r=ee.value.get(o);if(!r||r.length===0)return!1;const f=n!=null&&n!==""?Number(n):0,g=String(t??"").trim();return r.some(W=>String(W.TaxName??"").trim()===g&&Number(W.Rate)===(Number.isNaN(f)?0:f))}function it(o,t){if(t.items.length===1){const n=t.items[0],r=n.Tax_Rate,f=n.Tax_Name??"";kt(o,r,f)}else ue.value=t.typeLabel}async function wt(o,t,n){if(!M.value||!t.trim())return null;const r=O(o,xe),f=r!=null&&String(r).trim()!==""?String(r).trim():"";if(f==="")return null;const g=n!=null&&n!==""?Number(n):0,{data:W}=await H(fe.PAYABLE_INVOICE,{invoiceNumber:f},100),Ce=W.find(Re=>{var Ke,Ot;return String(((Ke=Re.fieldData)==null?void 0:Ke.TaxName)??"").trim()===t.trim()&&Number((Ot=Re.fieldData)==null?void 0:Ot.Rate)===(Number.isNaN(g)?0:g)});if(Ce!=null&&Ce.recordId){await h(fe.PAYABLE_INVOICE,Ce.recordId);const Re=ee.value.get(o)??[];return ee.value.set(o,Re.filter(Ke=>!(String(Ke.TaxName??"").trim()===t.trim()&&Number(Ke.Rate)===(Number.isNaN(g)?0:g)))),!0}const Ne={invoiceNumber:f,TaxName:t.trim(),Rate:Number.isNaN(g)?0:g};await E(fe.PAYABLE_INVOICE,Ne);const je=ee.value.get(o)??[];return ee.value.set(o,[...je,Ne]),!1}async function kt(o,t,n){const r=t!=null&&t!==""?Number(t):0,f=d.currentTransRef;if(f&&M.value&&d.isDirty){const W=await d.syncToFileMaker({markPosted:!1});if(W.error){m.error("Save failed: "+W.error+". Save your changes before selecting a tax."),X.value=null,ue.value=null;return}}const g=n&&M.value?await wt(o,n,t):null;if(f&&n&&M.value)await d.fetchDetailsByTransRef(f);else if(g===!0)Q(o,Se,"0"),Q(o,at,"");else{const W=O(o,gt),Ce=typeof W=="number"?W:parseFloat(String(W)),Ne=!Number.isNaN(Ce)&&r!==0?Ce*(r/100):r,je=r!==0?String(Ne):"";Q(o,Se,je),Q(o,at,je)}X.value=null,ue.value=null,De(()=>{var W;w(o,Se),(W=he.value)==null||W.focus()})}function Ve(){X.value=null,ue.value=null}mt(()=>{document.addEventListener("click",Ve),A(),I()}),Nt(()=>{document.removeEventListener("click",Ve),l.value&&clearTimeout(l.value)}),me(M,o=>{o&&A()}),me(K,()=>{I()},{deep:!0});const qe=C(null),he=C(null),ie=C("");function Ct(o,t){return F.value===o&&G.value===t}const dt=V(()=>String(O(F.value,G.value)??""));me([F,G],()=>{ie.value=dt.value,De(()=>{var o;(o=he.value)==null||o.focus(),he.value&&(he.value.value=ie.value)})},{immediate:!0,flush:"sync"}),me(dt,o=>{ie.value!==o&&(ie.value=o,De(()=>{he.value&&(he.value.value=o)}))});function Rt(){const o=ie.value.trim();Q(F.value,G.value,o),I()}function L(o,t,n){ie.value=n,j[t]==="invoice_number"&&(I(),de(n.trim(),o))}function I(){const o=new Set,t=new Map;for(let n=0;n<K.value.length;n++){let r;n===F.value&&G.value===xe&&ie.value!==void 0?r=ie.value:r=O(n,xe);const f=r!=null&&String(r).trim()!==""?String(r).trim():"";if(f==="")continue;const g=f.toLowerCase();t.has(g)?(o.add(t.get(g)),o.add(n)):t.set(g,n)}we.value=o}function de(o,t){l.value&&clearTimeout(l.value),!(!o||!M.value)&&(l.value=setTimeout(async()=>{await Ze(o,t)},500))}async function Ze(o,t){if(!o||!M.value)return;const n=K.value[t],r=n==null?void 0:n.recordId;if(c.value.has(o)&&!r){if(c.value.get(o))we.value.add(t);else{const Re=O(t,xe);Re!=null&&String(Re).trim()!==""&&String(Re).trim().toLowerCase(),I()}return}const f=Number(o),g=Number.isNaN(f)?o:f,{data:W}=await H(fe.PAYABLES_DETAILS,{InvoiceNumber:g},100),Ne=(r?W.filter(je=>je.recordId!==r):W).length>0;r||c.value.set(o,Ne),Ne?we.value.add(t):I()}function pe(o){const t=ie.value.trim();Q(F.value,G.value,t),v(o),o==="enter"&&u(),De(()=>{var n;return(n=he.value)==null?void 0:n.focus()})}function Oe(){var o;ie.value=String(O(F.value,G.value)??""),(o=he.value)==null||o.blur()}const ut=["invoice_number","amount","total"];function ct(o){if(o==="amount")return ut.includes(o)?"Amount before VAT *":"Amount before VAT";if(o==="reference")return"Tax Amount";const t=o.replace(/_/g," ").replace(/\b\w/g,n=>n.toUpperCase());return ut.includes(o)?`${t} *`:t}function Lt(o){return o==="status"}function Pt(o){return o==="tax"}function qt(o){const t=O(o,Se);if(t==null||t==="")return!1;const n=Number(t);return!Number.isNaN(n)&&n>0}function Bt(o){return o==="total"}function zt(o){return o==="reference"}const Zt=["amount","tax","reference","total"];function Xe(o,t){const n=O(o,t);if(n==null||n==="")return"";if(un(n)){const f=S(String(n));return typeof f=="number"?St(f):String(f)}const r=j[t];if(Zt.includes(r)){const f=St(n);return f!==""?f:n}return n}const Xt={invoice_number:"12ch",amount:"12ch",tax:"10ch",reference:"12ch",total:"12ch"};function Vt(o){return{minWidth:Xt[o]??"10ch"}}const Kt=V(()=>({tableLayout:"auto",minWidth:"100%"}));function Gt(o,t){const n=F.value===o&&G.value===t,f=j[t]==="invoice_number"&&we.value.has(o);return{"bg-[var(--color-accent-soft)] ring-2 ring-[var(--color-accent)] ring-inset":n,"bg-[var(--color-bg-card)]":!n,"cell-duplicate":f}}function Qt(o,t){ie.value=String(O(o,t)??""),w(o,t),!Lt(j[t])&&!Pt(j[t])&&!Bt(j[t])&&!zt(j[t])&&De(()=>{var n;return(n=he.value)==null?void 0:n.focus()})}const $e=C({visible:!1,x:0,y:0});function Jt(o){d.mainPosted||($e.value={visible:!0,x:o.clientX,y:o.clientY})}function Te(o){var t,n;if($e.value={...$e.value,visible:!1},k.value!==null&&(o!=null&&o.target)){const r=o.target;!((t=r.closest)!=null&&t.call(r,".cell-tax-breakdown-popover"))&&!((n=r.closest)!=null&&n.call(r,".cell-tax-breakdown-trigger"))&&Ie()}}function eo(){D(),Te()}function to(){ot(),Te()}function oo(){ye(),Te()}function no(){Le(),Te()}function ro(o){if($e.value.visible){Te();return}switch(o.key){case"ArrowUp":o.preventDefault(),v("up");break;case"ArrowDown":o.preventDefault(),v("down"),u();break;case"ArrowLeft":o.preventDefault(),v("left");break;case"ArrowRight":o.preventDefault(),v("right");break;case"Tab":o.preventDefault(),v(o.shiftKey?"tabReverse":"tab");break;case"Enter":o.preventDefault(),v("enter"),u();break}}return mt(()=>{var o;window.addEventListener("click",Te),(o=qe.value)==null||o.focus()}),Nt(()=>{window.removeEventListener("click",Te)}),(o,t)=>(a(),s("div",vn,[e("div",{ref_key:"gridRef",ref:qe,class:"data-grid-scroll flex-1 min-h-0 overflow-auto outline-none focus:outline-none focus:ring-0",tabindex:"0",onKeydown:ro,onContextmenu:ae(Jt,["prevent"])},[e("table",{class:"data-grid-table border-collapse font-mono text-[var(--input-size)]",style:ft({...Kt.value,"--row-header-width":_(Z)+"px"})},[e("thead",fn,[e("tr",null,[t[13]||(t[13]=e("th",{class:"row-header-th sticky left-0 z-20 border-b border-r border-[var(--color-border)] px-3 py-2 text-[var(--label-size)] font-medium text-[var(--color-text-muted)]"}," # ",-1)),(a(!0),s(U,null,oe(_(j),(n,r)=>(a(),s("th",{key:n,class:"border-b border-r border-[var(--color-border)] px-3 py-2 text-left text-[var(--label-size)] font-medium text-[var(--color-text-muted)] whitespace-nowrap",style:ft(Vt(n))},x(ct(n)),5))),128)),t[14]||(t[14]=e("th",{class:"data-grid-actions-th border-b border-[var(--color-border)] px-2 py-2 text-[var(--label-size)] font-medium text-[var(--color-text-muted)] w-14"},[e("span",{class:"sr-only"},"Options")],-1))])]),e("tbody",null,[(a(!0),s(U,null,oe(bt.value,n=>(a(),s("tr",{key:n,class:"data-grid-row hover:bg-white/[0.04] transition-colors"},[e("td",{class:ve(["row-header-td sticky left-0 z-10 border-b border-r border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-2 text-center text-[var(--color-text-muted)] tabular-nums",{"bg-[var(--color-accent-soft)]":_(F)===n}]),onClick:r=>_(w)(n,0)},x(n+1),11,pn),(a(!0),s(U,null,oe(_(j),(r,f)=>(a(),s("td",{key:`${n}-${r}`,class:ve(["border-b border-r border-[var(--color-border)] px-3 py-2 text-left whitespace-nowrap",Gt(n,f)]),style:ft(Vt(r)),onClick:g=>Qt(n,f)},[rt.value?(a(),s("span",bn,x(Xe(n,f)),1)):Lt(r)?(a(),s("select",{key:1,value:_(O)(n,f),class:"cell-select w-full min-w-0 border-0 bg-transparent text-[var(--color-text)] focus:ring-0 focus:outline-none",onClick:t[0]||(t[0]=ae(()=>{},["stop"])),onChange:g=>_(Q)(n,f,g.target.value)},[(a(!0),s(U,null,oe(_(nt),g=>(a(),s("option",{key:g,value:g},x(g),9,_n))),128))],40,hn)):Pt(r)?(a(),s(U,{key:2},[e("div",gn,[e("span",yn,x(Xe(n,f)),1),qt(n)?(a(),s("button",{key:0,type:"button",class:"cell-tax-breakdown-trigger shrink-0 p-0.5 rounded text-[var(--color-text-muted)] hover:text-[var(--color-text)] hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-[var(--color-accent)]","aria-label":"Show tax breakdown",onClick:ae(g=>We(n,g),["stop"])},[...t[15]||(t[15]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],8,xn)):B("",!0)]),k.value===n?(a(),s("div",{key:0,ref_for:!0,ref_key:"taxBreakdownPopoverRef",ref:be,class:"cell-tax-breakdown-popover",role:"tooltip"},[ce.value?(a(),s("div",wn,"Loading…")):(a(),s(U,{key:1},[t[16]||(t[16]=e("div",{class:"cell-tax-breakdown-title"},"Tax breakdown",-1)),Y.value.length?(a(),s("ul",kn,[(a(!0),s(U,null,oe(Y.value,(g,W)=>(a(),s("li",{key:W},x(g.TaxName)+" — "+x(g.Rate!=null?g.Rate+"%":""),1))),128))])):(a(),s("div",Cn,x(J.value||"No taxes recorded for this invoice. Use row menu (⋯) to add tax."),1))],64))],512)):B("",!0)],64)):Bt(r)?(a(),s("span",Rn,x(Xe(n,f)),1)):zt(r)?(a(),s("span",Sn,x(Xe(n,f)),1)):(a(),s(U,{key:5},[Ct(n,f)?(a(),s("input",{key:`input-${n}-${f}`,ref_for:!0,ref_key:"cellInputRef",ref:he,value:ie.value,type:"text",class:ve(["cell-input w-full min-w-0 px-1.5 py-0.5 border-0 rounded bg-transparent text-[var(--color-text)] focus:ring-2 focus:ring-inset focus:outline-none",r==="invoice_number"&&we.value.has(n)?"focus:ring-red-500 border-red-500/50":"focus:ring-[var(--color-accent)]"]),onInput:g=>L(n,f,g.target.value),onBlur:Rt,onKeydown:[t[1]||(t[1]=Me(ae(g=>pe("enter"),["prevent"]),["enter"])),t[2]||(t[2]=Me(ae(g=>pe("tab"),["prevent"]),["tab"])),Me(Oe,["escape"]),t[3]||(t[3]=Me(ae(g=>pe("enter"),["prevent"]),["down"])),t[4]||(t[4]=Me(ae(g=>pe("enterReverse"),["prevent"]),["up"])),t[5]||(t[5]=Me(ae(g=>pe("left"),["prevent"]),["left"])),t[6]||(t[6]=Me(ae(g=>pe("right"),["prevent"]),["right"]))]},null,42,$n)):(a(),s("span",{key:1,class:ve(["cell-display",{"cell-display--duplicate":r==="invoice_number"&&we.value.has(n)}])},x(Xe(n,f)),3))],64))],14,mn))),128)),e("td",{class:"data-grid-actions-td border-b border-[var(--color-border)] px-2 py-2 w-14 align-middle",onClick:t[9]||(t[9]=ae(()=>{},["stop"]))},[rt.value?B("",!0):(a(),s("div",Tn,[e("button",{type:"button",class:ve(["data-grid-row-actions__trigger",{"data-grid-row-actions__trigger--open":X.value===n}]),"aria-expanded":X.value===n,"aria-haspopup":"true","aria-label":"Row options",onClick:r=>Be(n)},[...t[17]||(t[17]=[e("svg",{class:"data-grid-row-actions__icon",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{d:"M12 10.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 4.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 16.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z"})],-1)])],10,Nn),P(Fe,{name:"row-menu"},{default:Ee(()=>[X.value===n?(a(),s("div",{key:0,class:"data-grid-row-actions__dropdown",role:"menu",onClick:t[8]||(t[8]=ae(()=>{},["stop"]))},[e("div",jn,[ue.value?(a(),s("div",Mn,[t[18]||(t[18]=e("span",{class:"data-grid-row-actions__header-title"},"Tax",-1)),lt(n)?(a(),s("span",Dn,x(lt(n)),1)):B("",!0)])):B("",!0),ue.value===null?(a(),s(U,{key:1},[$.value?(a(),s("div",En,[...t[19]||(t[19]=[e("span",{class:"data-grid-row-actions__state-text"},"Loading…",-1)])])):He.value.length===0?(a(),s("div",An,[...t[20]||(t[20]=[e("span",{class:"data-grid-row-actions__state-text"},"No tax types",-1)])])):(a(),s("div",Ln,[e("div",Pn,[t[23]||(t[23]=e("div",{class:"data-grid-row-actions__group-label"},"Set tax",-1)),e("div",Bn,[(a(!0),s(U,null,oe(He.value,r=>(a(),s("button",{key:r.typeKey,type:"button",class:ve(["data-grid-row-actions__option",{"data-grid-row-actions__option--expandable":r.items.length>1,"data-grid-row-actions__option--selected":r.items.length===1&&ze(n,r.items[0].Tax_Name??"",r.items[0].Tax_Rate)}]),role:"menuitem",onClick:f=>it(n,r)},[r.items.length===1&&ze(n,r.items[0].Tax_Name??"",r.items[0].Tax_Rate)?(a(),s("svg",Vn,[...t[21]||(t[21]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),s("span",On)),e("span",Fn,x(r.typeLabel),1),r.items.length===1?(a(),s("span",In,x(Ye(r.items[0].Tax_Rate)),1)):(a(),s("svg",Wn,[...t[22]||(t[22]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])]))],10,zn))),128))])])]))],64)):(a(),s(U,{key:2},[e("button",{type:"button",class:"data-grid-row-actions__back",onClick:t[7]||(t[7]=r=>ue.value=null)},[t[24]||(t[24]=e("svg",{class:"data-grid-row-actions__back-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)),e("span",null,x(ue.value),1)]),e("div",Un,[e("div",Hn,[(a(!0),s(U,null,oe(yt.value,(r,f)=>(a(),s("button",{key:f,type:"button",class:ve(["data-grid-row-actions__option",{"data-grid-row-actions__option--selected":ze(n,r.Tax_Name??"",r.Tax_Rate)}]),role:"menuitem",onClick:g=>kt(n,r.Tax_Rate,r.Tax_Name??"")},[ze(n,r.Tax_Name??"",r.Tax_Rate)?(a(),s("svg",qn,[...t[25]||(t[25]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M5 13l4 4L19 7"},null,-1)])])):(a(),s("span",Zn)),e("span",Xn,x(r.Tax_Name??"—"),1),e("span",Kn,x(Ye(r.Tax_Rate)),1)],10,Yn))),128))])])],64))])])):B("",!0)]),_:2},1024)]))])]))),128))])],4)],544),ge.value>0?(a(),s("div",Gn,[e("div",Qn,[e("span",Jn," Showing "+x(ht.value)+"–"+x(_t.value)+" of "+x(ge.value)+" row"+x(ge.value!==1?"s":""),1),e("label",er,[t[26]||(t[26]=e("span",null,"Rows per page",-1)),e("select",{value:ne.value,class:"rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-card)] px-2 py-1.5 text-[var(--color-text)] focus:ring-2 focus:ring-[var(--color-accent)] focus:border-transparent",onChange:t[10]||(t[10]=n=>ne.value=Number(n.target.value))},[(a(),s(U,null,oe(Pe,n=>e("option",{key:n,value:n},x(n),9,or)),64))],40,tr)])]),e("div",nr,[e("button",{type:"button",class:"pagination-btn rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-1.5 text-[var(--color-text-muted)] hover:bg-white/5 hover:text-[var(--color-text)] disabled:opacity-40 disabled:pointer-events-none transition-colors",disabled:q.value<=1,"aria-label":"Previous page",onClick:t[11]||(t[11]=n=>q.value=Math.max(1,q.value-1))}," Prev ",8,rr),e("span",ar," Page "+x(q.value)+" of "+x(le.value),1),e("button",{type:"button",class:"pagination-btn rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-1.5 text-[var(--color-text-muted)] hover:bg-white/5 hover:text-[var(--color-text)] disabled:opacity-40 disabled:pointer-events-none transition-colors",disabled:q.value>=le.value,"aria-label":"Next page",onClick:t[12]||(t[12]=n=>q.value=Math.min(le.value,q.value+1))}," Next ",8,sr)])])):B("",!0),e("div",lr,[e("div",ir,[t[27]||(t[27]=e("span",{class:"entry-total-row__label text-[var(--color-text-muted)] font-medium"},"Entry total",-1)),e("span",dr,x(T.value),1)]),e("span",ur,x(_(R).vendor.currency)+" "+x(i(_(d).entryTotal)),1)]),P(cn,{visible:$e.value.visible,x:$e.value.x,y:$e.value.y,onCopy:eo,onPaste:to,onCut:oo,onClear:no},null,8,["visible","x","y"])]))}}),vr=tt(cr,[["__scopeId","data-v-8251613f"]]),fr={class:"content-area flex flex-col flex-1 min-h-0 w-full max-w-[1600px] mx-auto px-4 py-5 md:px-6 md:py-6"},pr={class:"flex flex-wrap items-center gap-2 mb-4"},mr={class:"flex flex-1 flex-wrap items-center justify-center gap-2"},br={key:0,class:"booklet-bar glass-input inline-flex items-center overflow-hidden rounded-full border border-[var(--color-border)]"},hr=["aria-label","aria-current","onClick"],_r=["disabled"],gr=["disabled"],yr=["disabled"],xr={key:0,class:"text-xl font-bold text-[var(--color-text)] tabular-nums tracking-tight"},wr={key:1,class:"text-xl font-bold text-[var(--color-text)] tabular-nums tracking-tight"},kr={key:0,class:"rejection-history mb-4"},Cr={key:0,class:"rejection-history__skeleton"},Rr={key:1,class:"rejection-history__timeline"},Sr={class:"rejection-history__card"},$r={class:"rejection-history__meta"},Tr={class:"rejection-history__num"},Nr={key:0,class:"rejection-history__badge"},jr={class:"rejection-history__date"},Mr={key:1,class:"rejection-history__by"},Dr={class:"rejection-history__reason"},Er={key:1,class:"reject-reason-banner",role:"alert"},Ar={class:"reject-reason-banner__content"},Lr={class:"reject-reason-banner__text"},Pr={class:"vendor-details-row relative mb-4"},Br={class:"glass overflow-hidden rounded-[var(--radius-card)] border border-[var(--color-border)]"},zr={class:"flex w-full items-center justify-between px-4 py-3"},Vr={class:"border-t border-[var(--color-border)] px-4 pb-4 pt-3"},Or={class:"grid grid-cols-1 gap-3 sm:gap-4 md:grid-cols-2 lg:grid-cols-3"},Fr={key:0,type:"button",disabled:"",class:"booklet-circle absolute -left-16 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full flex items-center justify-center glass-input border-2 opacity-30 pointer-events-none","aria-label":"Previous entry"},Ir={key:1,type:"button",disabled:"",class:"booklet-circle absolute -right-16 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full flex items-center justify-center glass-input border-2 opacity-30 pointer-events-none","aria-label":"Next entry"},Wr={class:"mb-3"},Ur={class:"glass rounded-xl border border-[var(--color-border)] px-4 py-3 flex items-center gap-3"},Hr={class:"mb-3"},Yr={class:"flex-1 min-h-[360px] flex flex-col min-w-0"},qr={class:"data-grid-wrapper flex flex-col flex-1 min-h-0 rounded-xl border border-[var(--color-border)] bg-[var(--color-bg-card)] shadow-sm overflow-hidden"},Zr={class:"data-grid-scroll flex-1 min-h-0 overflow-auto"},Xr={class:"data-grid-table border-collapse font-mono text-[var(--input-size)] w-full"},Kr={class:"sticky top-0 z-10 bg-[var(--color-bg-dark)]"},Gr={class:"border-b border-r border-[var(--color-border)] px-3 py-2.5",colspan:"2"},Qr={class:"border-b border-r border-[var(--color-border)] px-3 py-2.5",colspan:"4"},Jr={class:"row-header-th sticky left-0 z-20 border-b border-r border-[var(--color-border)] px-3 py-2"},ea={class:"row-header-td sticky left-0 z-10 border-b border-r border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-2 text-center"},ta={class:"border-b border-[var(--color-border)] px-2 py-2 w-14"},oa={class:"vendor-details-row relative mb-4"},na=["disabled"],ra=["disabled"],aa={class:"mb-3"},sa={class:"flex-1 min-h-[360px] flex flex-col min-w-0"},Wt=60,la=Ae({__name:"EntryView",setup(p){const b=vo(),d=fo(),R=V(()=>b.query.from==="invoices"?{name:"invoices"}:mo()),m=Yt(),i=et(),T=jt(),y=so(),{isConnected:N,updateRecord:H,createRecord:E,findRecordsByQueryWithIds:h}=Dt(),M=Ht(),j=bo(),Z=C(!1),K=C(!1),F=C(!1),G=V(()=>m.rowCount.value>1),O=C("next"),Q=V(()=>O.value==="next"?"booklet-next":"booklet-prev");function S(c){if(!(c!=null&&c.trim()))return"";const l=c.trim(),z=/^(\d{1,2})\/(\d{1,2})\/(\d{4})\s+(\d{1,2}):(\d{2}):(\d{2})/.exec(l);if(z){const[,$,k,Y,ce,J]=z,be=parseInt(ce,10),ee=be>=12?"PM":"AM",A=be%12||12;return`${$}/${k}/${Y} ${A}:${J} ${ee}`}return l}function w(){const c=b.query.transRef;if(c!=null&&c.trim())i.fetchDetailsByTransRef(c.trim());else{i.clearAll(),T.reset();const l=new Date,z=l.getFullYear(),$=String(l.getMonth()+1).padStart(2,"0"),k=String(l.getDate()).padStart(2,"0");T.setField("payment_terms",`${z}-${$}-${k}`)}}function v(){var l;const c=(l=b.query.transRef)==null?void 0:l.trim();if(c&&i.currentTransRef===c){if(y.mode==="rejected"){y.ensureCurrent(c);return}i.mainPosted?y.removeByRef(c):y.ensureCurrent(c)}}function u(c){const l={transRef:c};return b.query.from==="invoices"&&(l.from="invoices"),{name:"entry",query:l}}function D(){if(!y.hasPrev)return;O.value="prev",y.goPrev();const c=y.currentTransRef;c&&d.push(u(c))}function ye(){if(!y.hasNext)return;O.value="next",y.goNext();const c=y.currentTransRef;c&&d.push(u(c))}function ot(c){if(c===y.currentOpenIndex)return;O.value=c>y.currentOpenIndex?"next":"prev",y.setCurrentIndex(c);const l=y.currentTransRef;l&&d.push(u(l))}mt(w);const Le=C(!1),Pe=C(!1),ne=C([]),q=C(!1);async function ge(){const c=i.currentTransRef;if(!(c!=null&&c.trim())||!i.mainPosted||!N.value){ne.value=[],q.value=!1;return}q.value=!0;const{data:l,error:z}=await h(fe.PAYABLES_REJECTION_HISTORY,{TransRef:c},50);if(z||!(l!=null&&l.length))ne.value=[];else{const $=l.map(k=>k.fieldData).filter(Boolean).map(k=>{const Y=k;return{RejectedDate:k.RejectedDate??Y["Rejected date"],RejectedBy:k.RejectedBy??Y["Rejected by"],Reason:k.Reason??Y.Reason}});$.sort((k,Y)=>{const ce=k.RejectedDate??"";return(Y.RejectedDate??"").localeCompare(ce)}),ne.value=$}q.value=!1}let le=null;lo((c,l,z)=>{i.isDirty?(Le.value=!0,le=z):z()});function bt(){le&&(le(),le=null),Le.value=!1}function ht(){le&&(le(!1),le=null),Le.value=!1}me(()=>b.query.transRef,w),me(N,c=>{c&&b.query.transRef&&w()}),me(()=>[b.query.transRef,i.currentTransRef,i.mainPosted],()=>v(),{immediate:!0}),me(()=>[i.currentTransRef,i.mainPosted,i.loading],([c,l,z])=>{!z&&c&&l?ge():ne.value=[]},{immediate:!0});function _t(){m.deleteRow(m.selectedRow.value)}const nt=C(0);function rt(c){y.count<=1||(nt.value=c.touches[0].clientX)}function Se(c){if(y.count<=1)return;const z=c.changedTouches[0].clientX-nt.value;z>Wt&&y.hasPrev?D():z<-Wt&&y.hasNext&&ye()}function at(c){Pe.value=!1,gt(c)}async function gt(c){const l=i.currentTransRef,z=i.currentMainRecordId;if(!(!l||!z||!N.value)){Z.value=!0;try{const{error:$}=await H(fe.PAYABLES_MAIN,z,{Rejected:"Yes",RejectReason:c.trim()},{allowEmptyStrings:!1});if($){M.error("Reject failed: "+$);return}const{error:k}=await E(fe.PAYABLES_REJECTION_HISTORY,{TransRef:l,RejectedDate:po(),RejectedBy:"Manager",Reason:c.trim()});k&&M.error("Rejected but failed to record history: "+k),M.success("Entry rejected."),await i.fetchDetailsByTransRef(l),d.push(R.value)}finally{Z.value=!1}}}async function xe(){const c=i.currentMainRecordId;if(!(!c||!N.value)){K.value=!0;try{const{error:l}=await H(fe.PAYABLES_MAIN,c,{Approved:"Yes",ApprovedDate:uo()});if(l){M.error("Approve failed: "+l);return}M.success("Entry approved."),await i.fetchDetailsByTransRef(i.currentTransRef??""),d.push(R.value)}finally{K.value=!1}}}function X(c){const l=typeof c=="number"?c:parseFloat(String(c).replace(/,/g,""));return Number.isNaN(l)?String(c??"—"):l.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}function ue(c,l=""){const z=Math.floor(c),$=Math.round((c-z)*100),k=["","One","Two","Three","Four","Five","Six","Seven","Eight","Nine"],Y=["Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],ce=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];function J(A){return A===0?"Zero":A<10?k[A]:A<20?Y[A-10]:A<100?(ce[Math.floor(A/10)]+" "+k[A%10]).trim():A<1e3?(k[Math.floor(A/100)]+" Hundred "+J(A%100)).trim():A<1e6?(J(Math.floor(A/1e3))+" Thousand "+J(A%1e3)).trim():A<1e9?(J(Math.floor(A/1e6))+" Million "+J(A%1e6)).trim():String(A)}const be=z===0?"Zero":J(z),ee=l?` ${l}`:"";return $===0?`${be}${ee} only`:`${be}${ee} and ${$}/100`}async function we(){var $,k,Y,ce,J,be;const c=i.mainStatus,l=j.invoiceDownloadWhen;if(i.mainPosted&&(l==="approved_only"?c==="Approved":l==="once_posted"&&(c==="Posted"||c==="Approved"))){F.value=!0;try{let ee=function(L){const I=(L.invoice_number??"").trim();if(!I)return"—";const de=qe.get(I);return de!=null&&de.length?de.map(pe=>{const Oe=Number(pe.Rate??0),ut=(pe.TaxName??"").trim()||"Tax",ct=Oe!==0?`${Oe}%`:"";return`${ut}${ct?` ${ct}`:""}`}).join(", "):"—"};const[A,Ie]=await Promise.all([Ft(()=>import("./pdfmake-B32-QUBv.js").then(L=>L.p),__vite__mapDeps([0,1])),Ft(()=>import("./vfs_fonts-D-4-wbPz.js").then(L=>L.v),__vite__mapDeps([2,1]))]),We=A.default??A,Ue=Ie.default??Ie;We.addVirtualFileSystem&&Ue&&We.addVirtualFileSystem(Ue);const ke=(($=i.currentTransRef)==null?void 0:$.trim())??"",te=T.vendor,st=typeof i.entryTotal=="number"?i.entryTotal:0,He=X(st),yt=(te.currency?`${te.currency} `:"")+He,Ye=new Date().toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),lt=[ke,te.vendor_id,te.vendor_name].filter(Boolean).join("  ·  ")||"—",xt=ue(st,te.currency||""),Be=i.rows.filter(L=>(L.invoice_number??"").trim()!==""||(L.amount??"").trim()!==""||(L.total??"").trim()!==""),ze=Be.reduce((L,I)=>{const de=parseFloat(String(I.amount??"").replace(/,/g,""));return L+(Number.isNaN(de)?0:de)},0),it=Be.reduce((L,I)=>{const de=parseFloat(String(I.tax??"").replace(/,/g,""));return L+(Number.isNaN(de)?0:de)},0),wt=(te.currency?`${te.currency} `:"")+X(ze),kt=(te.currency?`${te.currency} `:"")+X(it),Ve=[...new Set(Be.map(L=>(L.invoice_number??"").trim()).filter(Boolean))],qe=new Map;N.value&&Ve.length>0&&(await Promise.all(Ve.map(I=>h(fe.PAYABLE_INVOICE,{invoiceNumber:I},100)))).forEach((I,de)=>{var pe;const Ze=Ve[de];Ze&&((pe=I.data)!=null&&pe.length)&&qe.set(Ze,I.data.map(Oe=>Oe.fieldData).filter(Boolean))});const ie=[[{text:"Invoice No.",fillColor:"#ebebeb",bold:!0},{text:"Amount",fillColor:"#ebebeb",bold:!0,alignment:"right"},{text:"Tax",fillColor:"#ebebeb",bold:!0,alignment:"right"},{text:"Tax Amount",fillColor:"#ebebeb",bold:!0,alignment:"right"},{text:"Tax breakdown",fillColor:"#ebebeb",bold:!0,fontSize:9},{text:"Total",fillColor:"#ebebeb",bold:!0,alignment:"right"}],...Be.map(L=>{const I=(L.reference??"").trim()||(L.tax??"");return[(L.invoice_number??"").trim()||"—",{text:X(L.amount??""),alignment:"right"},{text:X(L.tax??""),alignment:"right"},{text:X(I),alignment:"right"},{text:ee(L),fontSize:9},{text:X(L.total??""),alignment:"right"}]})],Ct=ke?`APPROVED · ${ke}`:"APPROVED",dt={pageSize:"A4",pageOrientation:"landscape",pageMargins:[40,50,40,70],defaultStyle:{fontSize:10,color:"#000"},watermark:{text:Ct,color:"#b0b0b0",opacity:.12,bold:!0,angle:-45},content:[{columns:[{text:"Invoice Payment - PDF",fontSize:15,bold:!0},{text:Ye.toUpperCase(),fontSize:10,alignment:"right",width:"*"}],margin:[0,0,0,10]},{canvas:[{type:"line",x1:0,y1:0,x2:762,y2:0}],margin:[0,4,0,10]},{text:lt,alignment:"center",bold:!0,fontSize:12,margin:[0,0,0,6]},{table:{widths:[120,"*"],body:[[{text:"Vendor ID",bold:!0,fillColor:"#f5f5f5"},((k=te.vendor_id)==null?void 0:k.trim())||"—"],[{text:"Vendor name",bold:!0,fillColor:"#f5f5f5"},((Y=te.vendor_name)==null?void 0:Y.trim())||"—"],[{text:"Date",bold:!0,fillColor:"#f5f5f5"},((ce=te.payment_terms)==null?void 0:ce.trim())||Ye],[{text:"Email",bold:!0,fillColor:"#f5f5f5"},((J=te.contact_email)==null?void 0:J.trim())||"—"],[{text:"Currency",bold:!0,fillColor:"#f5f5f5"},((be=te.currency)==null?void 0:be.trim())||"—"]]},layout:{hLineWidth:()=>.2,vLineWidth:()=>.2},margin:[0,0,0,12]},{canvas:[{type:"line",x1:0,y1:0,x2:762,y2:0}],margin:[0,0,0,12]},{table:{headerRows:1,widths:[110,95,90,95,"*",100],body:ie},layout:{hLineWidth:()=>.25,vLineWidth:()=>.25},margin:[0,0,0,14]},{columns:[{width:"*",stack:[{text:"Amount in words",bold:!0,fontSize:9,margin:[0,0,0,4]},{text:xt,fontSize:10}],fillColor:"#f8f8f8",margin:[0,4,8,4]},{width:240,table:{widths:[130,"*"],body:[[{text:"Sub Total (excl. tax)",fontSize:9,fillColor:"#f5f5f5"},{text:wt,fontSize:9,alignment:"right",fillColor:"#f5f5f5"}],[{text:"Total Tax",fontSize:9,fillColor:"#f5f5f5"},{text:X(it),fontSize:9,alignment:"right",fillColor:"#f5f5f5"}],[{text:"Advance Payment",fontSize:9,fillColor:"#f5f5f5"},{text:"—",fontSize:9,alignment:"right",fillColor:"#f5f5f5"}],[{text:"Amount to Pay",fontSize:9,bold:!0,fillColor:"#f5f5f5"},{text:yt,fontSize:9,bold:!0,alignment:"right",fillColor:"#f5f5f5"}]]},layout:{hLineWidth:()=>.2,vLineWidth:()=>.2}}]}],footer:(L,I)=>({margin:[40,10,40,0],stack:[{text:`PAGE ${L} of ${I}`,fontSize:9,alignment:"center"},{text:"Finance Payables  ·  "+new Date().toLocaleString(void 0,{dateStyle:"medium",timeStyle:"short"}),fontSize:8,alignment:"center",margin:[0,2,0,0]}]})},Rt=ke?`Approved-Payable-${ke.replace(/[/\\?%*:|"<>]/g,"-")}.pdf`:"Approved-Payable.pdf";We.createPdf(dt).download(Rt),M.success("PDF downloaded.")}catch(ee){const A=ee instanceof Error?ee.message:"PDF download failed.";M.error(A)}finally{F.value=!1}}}return(c,l)=>{const z=co("router-link");return a(),s("div",fr,[P(Ho,{visible:Le.value,onConfirm:bt,onCancel:ht},null,8,["visible"]),P(Go,{visible:Pe.value,onSubmit:at,onCancel:l[0]||(l[0]=$=>Pe.value=!1)},null,8,["visible"]),e("div",pr,[P(z,{to:R.value,class:"pill-btn glass-input inline-flex items-center gap-1.5 px-3 py-2 text-[var(--label-size)] text-[var(--color-text-muted)] no-underline hover:text-[var(--color-text)]"},{default:Ee(()=>[...l[3]||(l[3]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),se(" Back to list ",-1)])]),_:1},8,["to"]),e("div",mr,[_(y).count>1?(a(),s("div",br,[(a(!0),s(U,null,oe(_(y).openEntryRefs,($,k)=>(a(),s("button",{key:$,type:"button",class:ve(["booklet-page-btn min-w-[2rem] px-2.5 py-2 text-[var(--label-size)] font-medium transition-colors",k===_(y).currentOpenIndex?"bg-[var(--color-accent-soft)] text-[var(--color-accent)]":"text-[var(--color-text-muted)] hover:bg-white/5 hover:text-[var(--color-text)]"]),"aria-label":`Entry ${k+1} of ${_(y).count}`,"aria-current":k===_(y).currentOpenIndex?"true":void 0,onClick:Y=>ot(k)},x(k+1),11,hr))),128))])):B("",!0),_(i).mainPosted&&_(i).mainStatus==="Posted"&&_(i).currentMainRecordId?(a(),s(U,{key:1},[e("button",{type:"button",class:"pill-btn inline-flex items-center gap-2 rounded-full bg-red-700/90 px-4 py-2.5 text-[var(--label-size)] font-semibold text-white shadow-md hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:Z.value||K.value,onClick:l[1]||(l[1]=$=>Pe.value=!0)},[l[4]||(l[4]=e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)),se(" "+x(Z.value?"Rejecting…":"Reject"),1)],8,_r),e("button",{type:"button",class:"pill-btn inline-flex items-center gap-2 rounded-full bg-emerald-700 px-4 py-2.5 text-[var(--label-size)] font-semibold text-white shadow-md hover:bg-emerald-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:Z.value||K.value,onClick:xe},[l[5]||(l[5]=e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1)),se(" "+x(K.value?"Approving…":"Approve"),1)],8,gr)],64)):B("",!0),_(j).invoiceDownloadWhen!=="none"&&_(i).mainPosted&&(_(j).invoiceDownloadWhen==="once_posted"&&(_(i).mainStatus==="Posted"||_(i).mainStatus==="Approved")||_(j).invoiceDownloadWhen==="approved_only"&&_(i).mainStatus==="Approved")?(a(),s("button",{key:2,type:"button",class:"pill-btn inline-flex items-center gap-2 rounded-full bg-slate-600 px-4 py-2.5 text-[var(--label-size)] font-semibold text-white shadow-md hover:bg-slate-500 transition-colors",disabled:F.value,onClick:we},[l[6]||(l[6]=e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)),se(" "+x(F.value?"Downloading…":"Download PDF"),1)],8,yr)):B("",!0)]),_(i).loading?(a(),s("span",xr,[P(re,{width:"8rem",height:"1.5rem"})])):_(i).currentTransRef?(a(),s("span",wr,x(_(i).currentTransRef),1)):B("",!0)]),_(i).mainPosted&&_(i).mainStatus==="Posted"&&ne.value.length>0?(a(),s("section",kr,[l[9]||(l[9]=io('<header class="rejection-history__header" data-v-a86ae477><div class="rejection-history__header-inner" data-v-a86ae477><svg class="rejection-history__icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-a86ae477><circle cx="12" cy="12" r="10" data-v-a86ae477></circle><polyline points="12 6 12 12 16 14" data-v-a86ae477></polyline></svg><div data-v-a86ae477><h3 class="rejection-history__title" data-v-a86ae477>Rejection history</h3><p class="rejection-history__subtitle" data-v-a86ae477> Prior rejections for this entry. Officer has since resubmitted. </p></div></div></header>',1)),q.value?(a(),s("div",Cr,[(a(),s(U,null,oe(2,$=>e("div",{key:$,class:"rejection-history__skeleton-item"},[...l[7]||(l[7]=[e("div",{class:"rejection-history__skeleton-dot"},null,-1),e("div",{class:"rejection-history__skeleton-content"},[e("div",{class:"rejection-history__skeleton-line",style:{width:"45%"}}),e("div",{class:"rejection-history__skeleton-line",style:{width:"80%"}})],-1)])])),64))])):(a(),s("ul",Rr,[(a(!0),s(U,null,oe(ne.value,($,k)=>(a(),s("li",{key:k,class:"rejection-history__item"},[l[8]||(l[8]=e("span",{class:"rejection-history__line"},null,-1)),e("span",{class:ve(["rejection-history__dot",{"rejection-history__dot--first":k===0}]),"aria-hidden":"true"},null,2),e("div",Sr,[e("div",$r,[e("span",Tr,"#"+x(k+1),1),k===0?(a(),s("span",Nr,"Most recent")):B("",!0),e("span",jr,x(S($.RejectedDate)),1),$.RejectedBy?(a(),s("span",Mr,"by "+x($.RejectedBy),1)):B("",!0)]),e("p",Dr,x($.Reason),1)])]))),128))]))])):B("",!0),_(i).mainStatus==="Rejected"&&(_(i).mainRejectReason||"").trim()?(a(),s("div",Er,[l[11]||(l[11]=e("span",{class:"reject-reason-banner__icon","aria-hidden":"true"},[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 8v4M12 16h.01"})])],-1)),e("div",Ar,[l[10]||(l[10]=e("strong",{class:"reject-reason-banner__label"},"Rejection reason",-1)),e("p",Lr,x(_(i).mainRejectReason),1)])])):B("",!0),e("div",{class:ve(["booklet-flip-view",{"booklet-flip-view--swipeable":_(y).count>1}]),onTouchstart:rt,onTouchend:Se},[P(Fe,{name:Q.value,mode:"out-in"},{default:Ee(()=>[_(i).loading?(a(),s("div",{key:`loading-${_(b).query.transRef||"new"}`,class:"entry-page flex flex-col flex-1 min-h-0"},[e("div",Pr,[e("section",Br,[e("div",zr,[P(re,{width:"7rem",height:"1.125rem"}),P(re,{width:"1.25rem",height:"1.25rem"})]),e("div",Vr,[e("div",Or,[(a(),s(U,null,oe(6,$=>e("div",{key:$,class:"block"},[P(re,{width:"6rem",height:"0.813rem",class:"mb-1"}),P(re,{width:"100%",height:"2.5rem"})])),64))])])]),_(y).count>1?(a(),s("button",Fr,[...l[12]||(l[12]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])])):B("",!0),_(y).count>1?(a(),s("button",Ir,[...l[13]||(l[13]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])):B("",!0)]),e("div",Wr,[e("div",Ur,[P(re,{width:"6rem",height:"2.25rem"}),P(re,{width:"6rem",height:"2.25rem"})])]),e("div",Hr,[P(re,{width:"100%",height:"0.813rem",class:"max-w-[600px]"})]),e("div",Yr,[e("div",qr,[e("div",Zr,[e("table",Xr,[e("thead",Kr,[e("tr",null,[l[14]||(l[14]=e("th",{class:"row-header-th sticky left-0 z-20 border-b border-r border-[var(--color-border)] px-3 py-2.5"},null,-1)),e("th",Gr,[P(re,{width:"5rem",height:"0.813rem"})]),e("th",Qr,[P(re,{width:"6rem",height:"0.813rem"})]),l[15]||(l[15]=e("th",{class:"border-b border-[var(--color-border)] px-2 py-2 w-14"},null,-1))]),e("tr",null,[e("th",Jr,[P(re,{width:"1rem",height:"0.813rem"})]),(a(),s(U,null,oe(6,$=>e("th",{key:$,class:"border-b border-r border-[var(--color-border)] px-3 py-2"},[P(re,{width:"4rem",height:"0.813rem"})])),64)),l[16]||(l[16]=e("th",{class:"border-b border-[var(--color-border)] px-2 py-2 w-14"},null,-1))])]),e("tbody",null,[(a(),s(U,null,oe(5,$=>e("tr",{key:$,class:"data-grid-row"},[e("td",ea,[P(re,{width:"1.5rem",height:"0.938rem"})]),(a(),s(U,null,oe(6,k=>e("td",{key:k,class:"border-b border-r border-[var(--color-border)] px-3 py-2"},[P(re,{width:"5rem",height:"0.938rem"})])),64)),e("td",ta,[P(re,{width:"2.5rem",height:"2.5rem",class:"rounded-[10px]"})])])),64))])])])])])])):(a(),s("div",{key:`entry-${_(b).query.transRef||"new"}`,class:"entry-page flex flex-col flex-1 min-h-0"},[e("div",oa,[P(Io),_(y).count>1?(a(),s("button",{key:0,type:"button",disabled:!_(y).hasPrev,class:"booklet-circle absolute -left-16 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full flex items-center justify-center glass-input border-2 text-orange-400/90 hover:text-orange-400 hover:bg-orange-500/10 border-orange-500/70 hover:border-orange-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:ring-offset-2 focus:ring-offset-[var(--color-bg)] disabled:opacity-30 disabled:pointer-events-none disabled:border-[var(--color-border)] disabled:text-[var(--color-text-muted)] transition-all shadow-lg","aria-label":"Previous entry",onClick:D},[...l[17]||(l[17]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],8,na)):B("",!0),_(y).count>1?(a(),s("button",{key:1,type:"button",disabled:!_(y).hasNext,class:"booklet-circle absolute -right-16 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full flex items-center justify-center glass-input border-2 text-orange-400/90 hover:text-orange-400 hover:bg-orange-500/10 border-orange-500/70 hover:border-orange-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:ring-offset-2 focus:ring-offset-[var(--color-bg)] disabled:opacity-30 disabled:pointer-events-none disabled:border-[var(--color-border)] disabled:text-[var(--color-text-muted)] transition-all shadow-lg","aria-label":"Next entry",onClick:ye},[...l[18]||(l[18]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,ra)):B("",!0)]),e("div",aa,[P(en,{"can-delete-row":G.value,onAddRow:l[2]||(l[2]=$=>_(m).addRow()),onDeleteRow:_t},null,8,["can-delete-row"])]),l[19]||(l[19]=e("p",{class:"mb-3 text-[var(--label-size)] text-[var(--color-text-muted)]"},[e("strong",{class:"text-[var(--color-text)]"},"Required to save:"),se(" Fill "),e("span",{class:"text-red-400/90"},"*"),se(" Vendor name or Vendor ID above; in the grid, each row must have at least one of: Invoice Number, Amount, or Total. ")],-1)),e("div",sa,[P(vr)])]))]),_:1},8,["name"])],34)])}}}),ca=tt(la,[["__scopeId","data-v-a86ae477"]]);export{ca as default};
