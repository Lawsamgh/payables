import{d as I,u as Y,H,I as O,c as S,e,t as V,q as y,w as F,p as L,v as A,R as G,r as m,j as k,L as B,x as z,k as J,o as W,h as N,b as $,g as U,i as q,M as K,_ as Q}from"./index-B7jQKMlp.js";const Z={key:0,class:"tax-modal-backdrop",role:"dialog","aria-modal":"true","aria-labelledby":"reset-password-title"},X={class:"tax-modal"},ee={key:0,class:"tax-modal__error",role:"alert"},te={class:"tax-modal__error-text"},se={class:"tax-modal__section"},oe={class:"tax-modal__label"},ne={class:"tax-modal__label"},ae={class:"tax-modal__label"},le={class:"tax-modal__actions"},re=["disabled"],j=6,ie=I({__name:"ResetPasswordModal",props:{visible:{type:Boolean,default:!1}},emits:["close"],setup(E,{emit:C}){const u=E,p=C,c=J(),{runScript:w,logout:M}=z(),h=Y(),f=m(""),d=m(""),g=m(""),l=m(null),v=m(!1),n={0:"",212:"Current password is incorrect. Please try again.",213:"User account or password does not exist. Please try again.",307:"New password is not allowed. Please choose a different password.",718:"Password does not meet requirements. Please choose a different password."};function t(i){const s=i.trim();if(n[s]!==void 0)return n[s];const a=s.toLowerCase();return a.includes("212")||a.includes("invalid")&&(a.includes("password")||a.includes("account"))?n[212]:a.includes("213")?n[213]:a.includes("307")||a.includes("718")?n[307]:s||"Something went wrong. Please try again."}H(()=>u.visible,i=>{i||(f.value="",d.value="",g.value="",l.value=null)});function o(){p("close")}function r(){return f.value.trim()?d.value.trim()?d.value.length<j?`New password must be at least ${j} characters.`:d.value!==g.value?"New password and confirmation do not match.":null:"Enter a new password.":"Enter your current password."}async function x(){if(v.value)return;l.value=null;const i=r();if(i){h.error(i),l.value=null;return}v.value=!0;try{const s=JSON.stringify({currentPassword:f.value.trim(),newPassword:d.value.trim()}),{error:a,scriptResult:_,scriptError:P}=await w(B.PAYABLES_USERS,"ChangePassword",s),b=(P??"0").trim();if(!(b==="0")){const T=t(b);h.error(T||(a??`Script error: ${b}`)),l.value=null;return}const R=_==null?void 0:_.trim();if(R&&R!=="0"){h.error(t(R)),l.value=null;return}h.success("Password changed. Please sign in again."),o(),M(),c.push({path:"/"})}finally{v.value=!1}}return(i,s)=>(k(),O(G,{to:"body"},[E.visible?(k(),S("div",Z,[e("div",X,[e("header",{class:"tax-modal__header"},[s[4]||(s[4]=e("h2",{id:"reset-password-title",class:"tax-modal__title"},"Reset password",-1)),e("button",{type:"button",class:"tax-modal__close","aria-label":"Close",onClick:o},[...s[3]||(s[3]=[e("svg",{class:"tax-modal__close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),l.value?(k(),S("div",ee,[s[5]||(s[5]=e("svg",{class:"tax-modal__error-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",te,V(l.value),1)])):y("",!0),e("form",{class:"tax-modal__form",onSubmit:F(x,["prevent"])},[e("section",se,[e("label",oe,[s[6]||(s[6]=e("span",null,"Current password",-1)),L(e("input",{"onUpdate:modelValue":s[0]||(s[0]=a=>f.value=a),type:"password",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"Enter current password",autocomplete:"current-password"},null,512),[[A,f.value]])]),e("label",ne,[s[7]||(s[7]=e("span",null,"New password",-1)),L(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>d.value=a),type:"password",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"Enter new password",autocomplete:"new-password"},null,512),[[A,d.value]])]),e("label",ae,[s[8]||(s[8]=e("span",null,"Confirm new password",-1)),L(e("input",{"onUpdate:modelValue":s[2]||(s[2]=a=>g.value=a),type:"password",class:"glass-input w-full px-3 py-2.5 rounded-lg",placeholder:"Confirm new password",autocomplete:"new-password"},null,512),[[A,g.value]])])]),e("div",le,[e("button",{type:"button",class:"tax-modal__btn-cancel",onClick:o},"Cancel"),e("button",{type:"submit",class:"tax-modal__btn-submit",disabled:v.value},V(v.value?"Changingâ€¦":"Change password"),9,re)])],32)])])):y("",!0)]))}}),de={class:"content-area flex flex-col flex-1 min-h-0 w-full max-w-[1600px] mx-auto px-4 py-5 md:px-6 md:py-6 min-h-[400px]"},ue={class:"flex flex-col gap-10"},ce={class:"settings-section"},ve={class:"settings-list"},me={key:0,class:"settings-section"},pe={class:"settings-list"},D="fm_user_role",fe=I({__name:"SettingsView",setup(E){const C=m(!1),u=m(null),p=m(!1),{loggedInEmail:c,isConnected:w,findRecordsByQueryWithIds:M,findRecordsWithIds:h}=z();function f(){var n;try{const t=sessionStorage.getItem(D);if(!t)return null;const{email:o,role:r}=JSON.parse(t),x=(n=c.value)==null?void 0:n.trim().toLowerCase();return!o||!x||o.toLowerCase()!==x?null:r&&String(r).trim()?String(r).trim():null}catch{return null}}function d(n){var t;try{const o=(t=c.value)==null?void 0:t.trim();if(!o)return;sessionStorage.setItem(D,JSON.stringify({email:o,role:n??""}))}catch{}}const g=q(()=>{var o;if(!p.value)return!1;const n=(o=u.value)==null?void 0:o.trim();if(!n)return!1;const t=n.toLowerCase();return t!=="officer"&&t!=="manager"});function l(n,t){if(!n)return"";const o=n[t]??n[t.replace(/([A-Z])/g," $1").trim()]??n[t.charAt(0).toLowerCase()+t.slice(1)];return o==null||o===""?"":String(o).trim()}async function v(){var i;const n=c.value;if(!n||!w.value){u.value=null,p.value=!1;return}const t=String(n).trim().toLowerCase(),{data:o}=await M(B.PAYABLES_USERS,{Email:n},1);let r=(i=o==null?void 0:o[0])==null?void 0:i.fieldData;if(!(o!=null&&o.length)){const{data:s}=await h(B.PAYABLES_USERS,{limit:500}),a=s.find(_=>{const P=_==null?void 0:_.fieldData;return l(P,"Email").trim().toLowerCase()===t});r=a==null?void 0:a.fieldData}const x=l(r,"Role");u.value=x||null,p.value=!0,d(u.value)}return H([w,c],()=>{w.value&&c.value?v():(u.value=null,p.value=!1)}),W(()=>{if(c.value&&w.value){const t=f();t!=null&&(u.value=t,p.value=!0),v()}}),(n,t)=>{const o=K("router-link");return k(),S("div",de,[t[8]||(t[8]=e("header",{class:"mb-10"},[e("h1",{class:"text-[1.75rem] font-bold tracking-tight text-[var(--color-text)] md:text-[2rem]",style:{"letter-spacing":"-0.025em","line-height":"1.2"}}," Settings "),e("p",{class:"mt-1.5 text-[13px] text-[var(--color-text-muted)]"}," Configure your preferences. ")],-1)),e("div",ue,[e("section",ce,[t[4]||(t[4]=e("h2",{class:"settings-section__title"},"Account",-1)),e("div",ve,[g.value?(k(),O(o,{key:0,to:"/settings/users",class:"settings-item no-underline"},{default:N(()=>[...t[2]||(t[2]=[e("div",{class:"settings-item__icon"},[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})])],-1),e("div",{class:"settings-item__content"},[e("span",{class:"settings-item__title"},"Manage Users"),e("span",{class:"settings-item__desc"},"Add, edit, and remove user accounts")],-1),e("svg",{class:"settings-item__chevron",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),_:1})):y("",!0),e("button",{type:"button",class:"settings-item settings-item--btn",onClick:t[0]||(t[0]=r=>C.value=!0)},[...t[3]||(t[3]=[$('<div class="settings-item__icon" data-v-658d8f52><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-658d8f52><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l11.964-11.964A6 6 0 1121 9z" data-v-658d8f52></path></svg></div><div class="settings-item__content" data-v-658d8f52><span class="settings-item__title" data-v-658d8f52>Reset password</span><span class="settings-item__desc" data-v-658d8f52>Change your sign-in password</span></div><svg class="settings-item__chevron" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-658d8f52><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" data-v-658d8f52></path></svg>',3)])])])]),g.value?(k(),S("section",me,[t[6]||(t[6]=e("h2",{class:"settings-section__title"},"Documents",-1)),e("div",pe,[U(o,{to:"/settings/documents",class:"settings-item no-underline"},{default:N(()=>[...t[5]||(t[5]=[e("div",{class:"settings-item__icon"},[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1),e("div",{class:"settings-item__content"},[e("span",{class:"settings-item__title"},"Documents"),e("span",{class:"settings-item__desc"},"View and manage documents")],-1),e("svg",{class:"settings-item__chevron",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])]),_:1})])])):y("",!0),t[7]||(t[7]=$('<section class="settings-section" data-v-658d8f52><h2 class="settings-section__title" data-v-658d8f52>General</h2><div class="settings-list" data-v-658d8f52><div class="settings-item settings-item--disabled" data-v-658d8f52><div class="settings-item__icon" data-v-658d8f52><svg fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-658d8f52><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" data-v-658d8f52></path></svg></div><div class="settings-item__content" data-v-658d8f52><span class="settings-item__title" data-v-658d8f52>Notifications</span><span class="settings-item__desc" data-v-658d8f52>Email and in-app alerts</span></div><span class="settings-item__badge" data-v-658d8f52>Coming soon</span></div></div></section>',1))]),U(ie,{visible:C.value,onClose:t[1]||(t[1]=r=>C.value=!1)},null,8,["visible"])])}}}),we=Q(fe,[["__scopeId","data-v-658d8f52"]]);export{we as default};
