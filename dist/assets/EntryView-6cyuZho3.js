import{d as xe,D as ot,E as Ae,o as s,c as l,a as e,i as ee,f as S,T as Le,w as je,v as rt,y as jt,s as K,p as g,t as y,b as E,g as D,h as C,_ as Pe,q as nt,G as at,l as oe,C as Z,x as no,n as He,H as Nt,m as tt,I as Rt,F as P,r as Y,J as ye,j as Qe,L as te,K as we,z as Tt,k as ao,M as so,e as lo,N as io,A as uo,O as co,B as vo,P as fo}from"./index-DHrrxsNC.js";import{_ as X}from"./Skeleton.vue_vue_type_script_setup_true_lang-CR2pGYDY.js";const po={class:"vendor-details glass overflow-hidden rounded-2xl border border-[var(--color-border)] shadow-sm"},bo=["aria-expanded"],mo={class:"vendor-details__body"},_o={class:"vendor-details__grid"},ho={class:"vendor-details__field"},go=["value","readonly"],yo={class:"vendor-details__field"},wo=["value","readonly"],xo={class:"vendor-details__field"},ko=["value","readonly"],Ro={class:"vendor-details__field"},Co=["value","readonly"],$o={class:"vendor-details__field"},jo={class:"vendor-details__select-wrap"},No=["value","disabled"],To={key:0,class:"vendor-details__error",role:"alert"},Mo=xe({__name:"VendorDetails",setup(v){const b=ot(),u=Ae(),h=D(()=>b.vendor),a=C(!1),w=D(()=>u.mainPosted&&u.mainStatus!=="Rejected");function d(V,f){b.setField(V,f),w.value||u.markDirty()}return(V,f)=>(s(),l("section",po,[e("button",{type:"button",class:"vendor-details__header","aria-expanded":!a.value,onClick:f[0]||(f[0]=M=>a.value=!a.value)},[f[7]||(f[7]=e("span",{class:"vendor-details__title"},"Vendor details",-1)),(s(),l("svg",{class:ee(["vendor-details__chevron",{"vendor-details__chevron--open":!a.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[...f[6]||(f[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))],8,bo),S(Le,{name:"vendor-details-body"},{default:je(()=>[rt(e("div",mo,[e("div",_o,[e("label",ho,[f[8]||(f[8]=e("span",{class:"vendor-details__label"},[K("Vendor ID "),e("span",{class:"vendor-details__required"},"Required")],-1)),e("input",{value:h.value.vendor_id,type:"text",class:"vendor-details__input",placeholder:"V-001",readonly:w.value,onInput:f[1]||(f[1]=M=>d("vendor_id",M.target.value))},null,40,go)]),e("label",yo,[f[9]||(f[9]=e("span",{class:"vendor-details__label"},[K("Vendor name "),e("span",{class:"vendor-details__required"},"Required")],-1)),e("input",{value:h.value.vendor_name,type:"text",class:"vendor-details__input",placeholder:"Acme Corp",readonly:w.value,onInput:f[2]||(f[2]=M=>d("vendor_name",M.target.value))},null,40,wo)]),e("label",xo,[f[10]||(f[10]=e("span",{class:"vendor-details__label"},"Date",-1)),e("input",{value:h.value.payment_terms,type:"date",class:"vendor-details__input vendor-details__input--date",readonly:w.value,onInput:f[3]||(f[3]=M=>d("payment_terms",M.target.value))},null,40,ko)]),e("label",Ro,[f[11]||(f[11]=e("span",{class:"vendor-details__label"},"Contact email",-1)),e("input",{value:h.value.contact_email,type:"email",class:"vendor-details__input",placeholder:"vendor@example.com",readonly:w.value,onInput:f[4]||(f[4]=M=>d("contact_email",M.target.value))},null,40,Co)]),e("label",$o,[f[14]||(f[14]=e("span",{class:"vendor-details__label"},"Currency",-1)),e("div",jo,[e("select",{value:h.value.currency,class:"vendor-details__input vendor-details__select",disabled:w.value,onChange:f[5]||(f[5]=M=>d("currency",M.target.value))},[...f[12]||(f[12]=[e("option",{value:"GHS"},"GHS",-1),e("option",{value:"EUR"},"EUR",-1),e("option",{value:"GBP"},"GBP",-1),e("option",{value:"USD"},"USD",-1),e("option",{value:"CAD"},"CAD",-1)])],40,No),f[13]||(f[13]=e("svg",{class:"vendor-details__select-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-6 6-6-6"})],-1))])])]),g(b).error?(s(),l("p",To,y(g(b).error),1)):E("",!0)],512),[[jt,!a.value]])]),_:1})]))}}),So=Pe(Mo,[["__scopeId","data-v-ed8de278"]]),Do={key:0,class:"unsaved-modal-backdrop",role:"dialog","aria-modal":"true","aria-labelledby":"unsaved-modal-title","aria-describedby":"unsaved-modal-desc"},Eo=xe({__name:"UnsavedChangesModal",props:{visible:{type:Boolean}},emits:["confirm","cancel"],setup(v,{emit:b}){const u=b;function h(){u("confirm")}function a(){u("cancel")}return(w,d)=>(s(),nt(at,{to:"body"},[S(Le,{name:"unsaved-modal"},{default:je(()=>[v.visible?(s(),l("div",Do,[e("div",{class:"unsaved-modal"},[d[0]||(d[0]=e("div",{class:"unsaved-modal__icon-wrap"},[e("svg",{class:"unsaved-modal__icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),d[1]||(d[1]=e("h2",{id:"unsaved-modal-title",class:"unsaved-modal__title"}," Unsaved changes ",-1)),d[2]||(d[2]=e("p",{id:"unsaved-modal-desc",class:"unsaved-modal__message"}," You have unsaved changes. Leave anyway? ",-1)),e("div",{class:"unsaved-modal__actions"},[e("button",{type:"button",class:"unsaved-modal__btn unsaved-modal__btn--primary",onClick:a}," Stay "),e("button",{type:"button",class:"unsaved-modal__btn unsaved-modal__btn--danger",onClick:h}," Leave ")])])])):E("",!0)]),_:1})]))}}),Bo=Pe(Eo,[["__scopeId","data-v-574025db"]]),Ao={key:0,class:"reject-modal-backdrop",role:"dialog","aria-modal":"true","aria-labelledby":"reject-modal-title","aria-describedby":"reject-modal-desc"},Lo={key:0,class:"reject-modal__error",role:"alert"},Po={class:"reject-modal__actions"},Oo=["disabled"],zo=xe({__name:"RejectReasonModal",props:{visible:{type:Boolean}},emits:["submit","cancel"],setup(v,{emit:b}){const u=v,h=b,a=C(""),w=C(""),d=C(!1),V=C(null);oe(()=>u.visible,z=>{z&&(a.value="",w.value="",d.value=!1,requestAnimationFrame(()=>{var _;(_=V.value)==null||_.focus()}))});function f(){h("cancel")}function M(){const z=a.value.trim();if(!z){w.value="Please enter a reason for rejection.";return}w.value="",d.value=!0,h("submit",z)}return(z,_)=>(s(),nt(at,{to:"body"},[S(Le,{name:"reject-modal"},{default:je(()=>[v.visible?(s(),l("div",Ao,[e("div",{class:"reject-modal",role:"document",onClick:_[1]||(_[1]=Z(()=>{},["stop"]))},[e("header",{class:"reject-modal__header"},[_[3]||(_[3]=e("h2",{id:"reject-modal-title",class:"reject-modal__title"},"Reject entry",-1)),e("button",{type:"button",class:"reject-modal__close","aria-label":"Cancel",onClick:f},[..._[2]||(_[2]=[e("svg",{class:"reject-modal__close-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),_[5]||(_[5]=e("p",{id:"reject-modal-desc",class:"reject-modal__desc"}," Enter the reason the officer needs to address. This will be shown when they view the rejected entry. ",-1)),e("form",{class:"reject-modal__form",onSubmit:Z(M,["prevent"])},[_[4]||(_[4]=e("label",{class:"reject-modal__label",for:"reject-reason-input"}," Reason ",-1)),rt(e("textarea",{id:"reject-reason-input",ref_key:"textareaRef",ref:V,"onUpdate:modelValue":_[0]||(_[0]=T=>a.value=T),class:"reject-modal__textarea",placeholder:"e.g. Wrong vendor name, missing invoice number, amount mismatch...",rows:"4",autofocus:""},null,512),[[no,a.value]]),w.value?(s(),l("p",Lo,y(w.value),1)):E("",!0),e("div",Po,[e("button",{type:"button",class:"reject-modal__btn reject-modal__btn--cancel",onClick:f}," Cancel "),e("button",{type:"submit",class:"reject-modal__btn reject-modal__btn--danger",disabled:d.value},y(d.value?"Rejecting…":"Reject"),9,Oo)])],32)])])):E("",!0)]),_:1})]))}}),Vo=Pe(zo,[["__scopeId","data-v-2598b29b"]]),Fo={key:0,class:"flex flex-wrap items-center gap-2 rounded-[var(--radius-card)] border border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-2 backdrop-blur-[var(--blur-glass)]"},Uo=["disabled"],Io=xe({__name:"Toolbar",props:{canDeleteRow:{type:Boolean,default:!0}},emits:["add-row","delete-row"],setup(v){const b=Ae(),u=D(()=>b.mainPosted);return(h,a)=>u.value?E("",!0):(s(),l("div",Fo,[e("button",{type:"button",class:"pill-btn flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-[var(--input-size)] text-[var(--color-text)] hover:bg-[var(--color-accent-soft)]",onClick:a[0]||(a[0]=w=>h.$emit("add-row"))},[...a[3]||(a[3]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),K(" Add row ",-1)])]),e("button",{type:"button",class:"pill-btn flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-[var(--input-size)] text-[var(--color-text)] hover:bg-red-500/10 hover:text-red-400",disabled:!v.canDeleteRow,onClick:a[1]||(a[1]=w=>h.$emit("delete-row"))},[...a[4]||(a[4]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),K(" Delete row ",-1)])],8,Uo),g(b).hasUndoDelete?(s(),l("button",{key:0,type:"button",class:"pill-btn flex items-center gap-1.5 rounded-lg px-3 py-1.5 text-[var(--input-size)] text-[var(--color-accent)] hover:bg-[var(--color-accent-soft)]",onClick:a[2]||(a[2]=w=>g(b).undoDelete())},[...a[5]||(a[5]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1),K(" Undo delete ",-1)])])):E("",!0)]))}}),Ho=/^([A-Z]+)(\d+)$/i;function Yo(v){if(!v||!/^[A-Z]+$/i.test(v))return-1;let b=0;const u=v.toUpperCase();for(let h=0;h<u.length;h++)b=b*26+(u.charCodeAt(h)-64);return b-1}function Je(v,b){if(!v||typeof v!="string")return null;const u=v.trim().toUpperCase().match(Ho);if(u){const h=Yo(u[1]),a=parseInt(u[2],10)-1;if(a>=0&&h>=0)return{row:a,col:h}}return b&&v in b?{row:-1,col:b[v]}:null}function Ct(v,b){const u=v.match(/^([A-Za-z_]+)(\d+)$/);if(u&&b){const h=b[u[1]],a=parseInt(u[2],10)-1;if(h!==void 0&&a>=0)return{row:a,col:h}}return null}function Wo(v,b,u={}){if(!v||typeof v!="string")return v;const h=v.trim();if(!h.startsWith("="))return v;const a=h.slice(1).trim(),w=a.match(/^SUM\s*\(\s*([A-Za-z0-9]+)\s*:\s*([A-Za-z0-9]+)\s*\)$/i);if(w){const z=w[1],_=w[2],T=Je(z,u)??Ct(z,u),N=Je(_,u)??Ct(_,u);if(T&&N){const le=Math.min(T.row,N.row),W=Math.max(T.row,N.row),F=Math.min(T.col,N.col),q=Math.max(T.col,N.col);let B=0;for(let H=le;H<=W;H++)for(let j=F;j<=q;j++){const k=b(H,j),R=parseFloat(String(k));Number.isNaN(R)||(B+=R)}return B}}let d=a;const V=a.match(/\b[A-Z]+\d+\b/gi)??[],f=new Set;for(const z of V){if(f.has(z))continue;f.add(z);const _=Je(z,u);if(_&&_.row>=0){const T=b(_.row,_.col),N=parseFloat(String(T)),le=Number.isNaN(N)?"0":String(N);d=d.replace(new RegExp(z.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"gi"),le)}}const M=d.replace(/\s/g,"");if(/^[\d.\s+\-*/()]+$/.test(M))try{return Function(`"use strict"; return (${M})`)()}catch{return v}return v}const Be=["invoice_number","amount","tax","reference","total"],qo=60,Xo=150,De=Be.length,J=C({row:0,col:0}),Ee=C(null),Ie=C(!1);function Mt(){const v=Ae(),b=D(()=>v.rows),u=D(()=>b.value.length),h=D(()=>De),a=D(()=>J.value),w=D(()=>J.value.row),d=D(()=>J.value.col),V=D(()=>{const j={};return Be.forEach((k,R)=>{const U=k.replace(/_/g," ").replace(/\b\w/g,G=>G.toUpperCase());j[U]=R,j[k]=R}),j});function f(j,k){const R=b.value[j];if(!R)return"";const U=Be[k],G=R[U];return G??""}function M(j,k,R){const U=Be[k];v.updateCell(j,U,String(R))}function z(j){return Wo(j,f,V.value)}function _(j,k){const R=Math.max(0,Math.min(j,u.value-1)),U=Math.max(0,Math.min(k,De-1));J.value={row:R,col:U}}function T(j){const{row:k,col:R}=J.value;switch(j){case"up":_(k-1,R);break;case"down":_(k+1,R);break;case"left":_(k,R-1);break;case"right":_(k,R+1);break;case"tab":R<De-1?_(k,R+1):_(k+1,0);break;case"tabReverse":R>0?_(k,R-1):_(k-1,De-1);break;case"enter":_(k+1,R);break;case"enterReverse":_(k-1,R);break}}function N(){v.addRow(),_(u.value-1,0)}function le(j){v.removeRow(j),u.value===0&&v.addRow();const k=Math.min(j,u.value-1);k>=0&&_(k,d.value)}function W(){const{row:j,col:k}=J.value,R=f(j,k);Ee.value=R,Ie.value=!1}function F(){W(),Ie.value=!0}function q(){if(Ee.value==null)return;const{row:j,col:k}=J.value;M(j,k,Ee.value),Ie.value&&(M(J.value.row,J.value.col,""),Ie.value=!1,Ee.value=null)}function B(){const{row:j,col:k}=J.value;M(j,k,"")}function H(){const{row:j}=J.value;j===u.value-1&&N()}return{COLUMN_KEYS:Be,ROW_HEADER_WIDTH:qo,COL_WIDTH:Xo,COL_COUNT:De,rows:b,rowCount:u,colCount:h,selected:a,selectedRow:w,selectedCol:d,headerToCol:V,getCellValue:f,setCellValue:M,evaluateCellFormula:z,selectCell:_,moveSelection:T,addRow:N,deleteRow:le,copy:W,cut:F,paste:q,clearCell:B,ensureRowForEnter:H,hasClipboard:D(()=>Ee.value!=null)}}const et=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],Zo=["","","twenty","thirty","forty","fifty","sixty","seventy","eighty","ninety"];function Ko(v){return v.length>0?v.charAt(0).toUpperCase()+v.slice(1):""}function Ye(v){if(v===0)return"";if(v<20)return et[v];if(v<100){const a=Math.floor(v/10),w=v%10;return(Zo[a]+(w>0?"-"+et[w]:"")).trim()}const b=Math.floor(v/100),u=v%100,h=u>0?" "+Ye(u):"";return et[b]+" hundred"+h}function Go(v){if(!Number.isFinite(v)||Number.isNaN(v))return"Zero";const b=Math.max(0,Math.min(99999999999e-2,v)),u=Math.floor(b),h=Math.round((b-u)*100);if(u===0&&h===0)return"Zero";let a="";if(u>=1e6){const d=Math.floor(u/1e6);a+=Ye(d)+" million "}let w=u%1e6;if(w>=1e3){const d=Math.floor(w/1e3);a+=Ye(d)+" thousand "}return w=u%1e3,w>0&&(a+=(a.length>0?"and ":"")+Ye(w)),a=a.trim(),a===""&&(a="zero"),h>0&&(a+=" and "+String(h).padStart(2,"0")+"/100"),Ko(a.trim())}function Qo(v){return v==null?!1:String(v).trim().startsWith("=")}const Jo=xe({__name:"ContextMenu",props:{visible:{type:Boolean,default:!1},x:{default:0},y:{default:0}},emits:["copy","paste","cut","clear"],setup(v,{emit:b}){const u=b;function h(){u("copy")}function a(){u("paste")}function w(){u("cut")}function d(){u("clear")}return(V,f)=>(s(),nt(at,{to:"body"},[rt(e("div",{class:"fixed z-[100] min-w-[160px] rounded-[var(--radius-card)] border border-[var(--color-border)] py-1 shadow-xl",style:He([{background:"var(--color-bg-card)","backdrop-filter":"blur(var(--blur-glass))","-webkit-backdrop-filter":"blur(var(--blur-glass))",transition:"opacity 0.15s var(--ease)"},{left:`${v.x}px`,top:`${v.y}px`}]),onClick:f[0]||(f[0]=Z(()=>{},["stop"]))},[e("button",{type:"button",class:"flex w-full items-center gap-2 px-3 py-2 text-left text-[var(--input-size)] text-[var(--color-text)] hover:bg-white/10",onClick:h},[...f[1]||(f[1]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),K(" Copy ",-1)])]),e("button",{type:"button",class:"flex w-full items-center gap-2 px-3 py-2 text-left text-[var(--input-size)] text-[var(--color-text)] hover:bg-white/10",onClick:a},[...f[2]||(f[2]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"})],-1),K(" Paste ",-1)])]),e("button",{type:"button",class:"flex w-full items-center gap-2 px-3 py-2 text-left text-[var(--input-size)] text-[var(--color-text)] hover:bg-white/10",onClick:w},[...f[3]||(f[3]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.121 14.121L19 19m-7-7l7-7m-7 7l-2.879 2.879M12 12L9.121 9.121m0 5.758a3 3 0 10-4.242 4.242 3 3 0 004.242-4.242zm0-5.758a3 3 0 10-4.242-4.242 3 3 0 004.242 4.242z"})],-1),K(" Cut ",-1)])]),e("button",{type:"button",class:"flex w-full items-center gap-2 px-3 py-2 text-left text-[var(--input-size)] text-[var(--color-text)] hover:bg-white/10",onClick:d},[...f[4]||(f[4]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),K(" Clear ",-1)])])],4),[[jt,v.visible]])]))}}),er={class:"data-grid-wrapper flex flex-col flex-1 min-h-0 rounded-xl border border-[var(--color-border)] bg-[var(--color-bg-card)] shadow-sm overflow-hidden"},tr={class:"sticky top-0 z-10 bg-[var(--color-bg-dark)]"},or=["onClick"],rr=["onClick"],nr={key:0,class:"cell-display"},ar=["value","onChange"],sr=["value"],lr={class:"cell-tax-wrap flex items-center gap-1 min-w-0"},ir={class:"cell-display flex-1 min-w-0"},ur=["onClick"],dr={key:0,class:"cell-tax-breakdown-loading"},cr={key:0,class:"cell-tax-breakdown-list"},vr={key:1,class:"cell-tax-breakdown-empty"},fr={key:3,class:"cell-display"},pr={key:4,class:"cell-display"},br=["value","onInput"],mr={key:0,class:"data-grid-row-actions"},_r=["aria-expanded","onClick"],hr={class:"data-grid-row-actions__panel"},gr={key:0,class:"data-grid-row-actions__header"},yr={key:0,class:"data-grid-row-actions__header-badge"},wr={key:0,class:"data-grid-row-actions__state"},xr={key:1,class:"data-grid-row-actions__state"},kr={key:2},Rr={class:"data-grid-row-actions__group"},Cr={class:"data-grid-row-actions__list"},$r=["onClick"],jr={key:0,class:"data-grid-row-actions__checkmark",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},Nr={key:1,class:"data-grid-row-actions__checkmark-placeholder"},Tr={class:"data-grid-row-actions__option-label"},Mr={key:2,class:"data-grid-row-actions__option-meta"},Sr={key:3,class:"data-grid-row-actions__chevron",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},Dr={class:"data-grid-row-actions__group"},Er={class:"data-grid-row-actions__list"},Br=["onClick"],Ar={key:0,class:"data-grid-row-actions__checkmark",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},Lr={key:1,class:"data-grid-row-actions__checkmark-placeholder"},Pr={class:"data-grid-row-actions__option-label"},Or={class:"data-grid-row-actions__option-meta"},zr={key:0,class:"flex flex-wrap items-center justify-between gap-3 px-4 py-3 border-t border-[var(--color-border)] bg-[var(--color-bg-dark)]/50 text-[var(--label-size)]"},Vr={class:"flex items-center gap-4"},Fr={class:"text-[var(--color-text-muted)]"},Ur={class:"flex items-center gap-2 text-[var(--color-text-muted)]"},Ir=["value"],Hr=["value"],Yr={class:"flex items-center gap-2"},Wr=["disabled"],qr={class:"px-2 py-1.5 text-[var(--color-text-muted)]"},Xr=["disabled"],Zr={class:"entry-total-row flex flex-wrap items-end justify-between gap-6 px-4 py-4 border-t-2 border-[var(--color-border)] bg-[var(--color-bg-dark)]"},Kr={class:"entry-total-row__left flex flex-col items-start gap-0.5"},Gr={class:"entry-total-row__words"},Qr={class:"entry-total-row__value text-xl font-bold text-[var(--color-text)] tabular-nums tracking-tight"},Jr=xe({__name:"DataGrid",setup(v){const b=Mt(),u=Ae(),h=ot(),a=Nt();function w(o){return Qe(o)||"0.00"}const d=D(()=>Go(u.entryTotal)),{findRecordsWithIds:V,findRecordsByQuery:f,findRecordsByQueryWithIds:M,createRecord:z,deleteRecord:_,isConnected:T}=Tt(),{COLUMN_KEYS:N,ROW_HEADER_WIDTH:le,rows:W,selectedRow:F,selectedCol:q,getCellValue:B,setCellValue:H,evaluateCellFormula:j,selectCell:k,moveSelection:R,ensureRowForEnter:U,copy:G,cut:de,paste:pe,clearCell:We}=b,ie=[10,15,25,50],re=C(15),I=C(1),ne=D(()=>W.value.length),ue=D(()=>Math.max(1,Math.ceil(ne.value/re.value))),qe=D(()=>{const o=ne.value;if(o===0)return[];const t=(I.value-1)*re.value,r=Math.min(t+re.value,o),n=[];for(let c=t;c<r;c++)n.push(c);return n}),Xe=D(()=>ne.value===0?0:(I.value-1)*re.value+1),Ze=D(()=>Math.min(I.value*re.value,ne.value));oe(F,o=>{const t=Math.floor(o/re.value)+1;t>=1&&t<=ue.value&&t!==I.value&&(I.value=t)}),oe(ne,()=>{I.value>ue.value&&(I.value=Math.max(1,ue.value))});const Ke=u.STATUS_OPTIONS,Oe=D(()=>u.mainPosted&&u.mainStatus!=="Rejected"),p=N.indexOf("tax"),i=N.indexOf("reference"),L=N.indexOf("amount"),$=N.indexOf("invoice_number"),x=C(null),O=C(null),ae=C(new Set),ke=C(new Map),ce=C(null),ze=C([]),Ne=C(!1),Te=C(null),Re=C([]),Ve=C(!1),Fe=C(null),st=C(null),be=C(new Map);async function lt(){if(!T.value)return;Ne.value=!0;const{data:o}=await V(te.TAX_VALUE,{limit:500});ze.value=o,Ne.value=!1}function it(){Te.value=null,Re.value=[],Fe.value=null}async function St(o,t){const r=B(o,$),n=r!=null&&String(r).trim()!==""?String(r).trim():"";if(Te.value===o){it();return}if(Te.value=o,Re.value=[],Fe.value=null,!n){Fe.value="Enter invoice number first, then add tax via row menu (⋯).",Ve.value=!1,we(()=>ut(t));return}Ve.value=!0;const{data:c,error:m}=await f(te.PAYABLE_INVOICE,{invoiceNumber:n},100);Ve.value=!1,m?Re.value=[{TaxName:`Error: ${m}`,Rate:void 0}]:Re.value=c.map(A=>({TaxName:A.TaxName??"—",Rate:A.Rate})),we(()=>ut(t))}function ut(o){var n;const t=st.value,r=(n=o.target)==null?void 0:n.closest(".cell-tax-breakdown-trigger");if(t&&r){const c=r.getBoundingClientRect();t.style.position="fixed",t.style.left=`${c.left}px`,t.style.top=`${c.bottom+4}px`,t.style.zIndex="50"}}function dt(o){const t=(o??"").trim();if(!t)return null;const r=/^(\d{4})-(\d{2})-(\d{2})$/.exec(t);if(r){const m=new Date(parseInt(r[1],10),parseInt(r[2],10)-1,parseInt(r[3],10));return Number.isNaN(m.getTime())?null:m}const n=/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/.exec(t);if(n){const m=new Date(parseInt(n[3],10),parseInt(n[1],10)-1,parseInt(n[2],10));return Number.isNaN(m.getTime())?null:m}const c=new Date(t);return Number.isNaN(c.getTime())?null:c}function Dt(o,t){const{fieldData:r}=o,n=dt(r.Start_Date),c=dt(r.End_Date);return!(n!==null&&n>t||c!==null&&c<t)}const Et=D(()=>{const o=new Date;return o.setHours(0,0,0,0),ze.value.filter(t=>Dt(t,o))}),Ge=D(()=>{const o=Et.value,t=new Map;for(const{fieldData:r}of o){const n=(r.Tax_Type??"").trim()||"—";t.has(n)||t.set(n,[]),t.get(n).push(r)}return Array.from(t.entries()).map(([r,n])=>({typeKey:r,typeLabel:r,items:n}))}),Bt=D(()=>{const o=O.value;if(!o)return[];const t=Ge.value.find(r=>r.typeLabel===o);return(t==null?void 0:t.items)??[]});function ct(o){if(o==null||o==="")return"—";const t=Number(o);return Number.isNaN(t)?"—":`${t}%`}function vt(o){const t=B(o,p);if(t==null||String(t).trim()==="")return"";const r=Number(t);return Number.isNaN(r)?String(t).trim():`${r}%`}async function At(o){if(!T.value)return;const t=B(o,$),r=t!=null&&String(t).trim()!==""?String(t).trim():"";if(r===""){be.value.set(o,[]);return}const{data:n}=await M(te.PAYABLE_INVOICE,{invoiceNumber:r},100);be.value.set(o,n.map(c=>c.fieldData))}function Lt(o){x.value===o?(x.value=null,O.value=null):(x.value=o,O.value=null,At(o))}function Ue(o,t,r){const n=be.value.get(o);if(!n||n.length===0)return!1;const c=r!=null&&r!==""?Number(r):0,m=String(t??"").trim();return n.some(A=>String(A.TaxName??"").trim()===m&&Number(A.Rate)===(Number.isNaN(c)?0:c))}function Pt(o,t){if(t.items.length===1){const r=t.items[0],n=r.Tax_Rate,c=r.Tax_Name??"";ft(o,n,c)}else O.value=t.typeLabel}async function Ot(o,t,r){if(!T.value||!t.trim())return null;const n=B(o,$),c=n!=null&&String(n).trim()!==""?String(n).trim():"";if(c==="")return null;const m=r!=null&&r!==""?Number(r):0,{data:A}=await M(te.PAYABLE_INVOICE,{invoiceNumber:c},100),ve=A.find(fe=>{var Se,kt;return String(((Se=fe.fieldData)==null?void 0:Se.TaxName)??"").trim()===t.trim()&&Number((kt=fe.fieldData)==null?void 0:kt.Rate)===(Number.isNaN(m)?0:m)});if(ve!=null&&ve.recordId){await _(te.PAYABLE_INVOICE,ve.recordId);const fe=be.value.get(o)??[];return be.value.set(o,fe.filter(Se=>!(String(Se.TaxName??"").trim()===t.trim()&&Number(Se.Rate)===(Number.isNaN(m)?0:m)))),!0}const he={invoiceNumber:c,TaxName:t.trim(),Rate:Number.isNaN(m)?0:m};await z(te.PAYABLE_INVOICE,he);const ge=be.value.get(o)??[];return be.value.set(o,[...ge,he]),!1}async function ft(o,t,r){const n=t!=null&&t!==""?Number(t):0,c=u.currentTransRef;if(c&&T.value&&u.isDirty){const A=await u.syncToFileMaker({markPosted:!1});if(A.error){a.error("Save failed: "+A.error+". Save your changes before selecting a tax."),x.value=null,O.value=null;return}}const m=r&&T.value?await Ot(o,r,t):null;if(c&&r&&T.value)await u.fetchDetailsByTransRef(c);else if(m===!0)H(o,p,"0"),H(o,i,"");else{const A=B(o,L),ve=typeof A=="number"?A:parseFloat(String(A)),he=!Number.isNaN(ve)&&n!==0?ve*(n/100):n,ge=n!==0?String(he):"";H(o,p,ge),H(o,i,ge)}x.value=null,O.value=null,we(()=>{var A;k(o,p),(A=se.value)==null||A.focus()})}function pt(){x.value=null,O.value=null}tt(()=>{document.addEventListener("click",pt),lt(),Ce()}),Rt(()=>{document.removeEventListener("click",pt),ce.value&&clearTimeout(ce.value)}),oe(T,o=>{o&&lt()}),oe(W,()=>{Ce()},{deep:!0});const bt=C(null),se=C(null),Q=C("");function zt(o,t){return F.value===o&&q.value===t}const mt=D(()=>String(B(F.value,q.value)??""));oe([F,q],()=>{Q.value=mt.value,we(()=>{var o;(o=se.value)==null||o.focus(),se.value&&(se.value.value=Q.value)})},{immediate:!0,flush:"sync"}),oe(mt,o=>{Q.value!==o&&(Q.value=o,we(()=>{se.value&&(se.value.value=o)}))});function Vt(){const o=Q.value.trim();H(F.value,q.value,o),Ce()}function Ft(o,t,r){Q.value=r,N[t]==="invoice_number"&&(Ce(),Ut(r.trim(),o))}function Ce(){const o=new Set,t=new Map;for(let r=0;r<W.value.length;r++){let n;r===F.value&&q.value===$&&Q.value!==void 0?n=Q.value:n=B(r,$);const c=n!=null&&String(n).trim()!==""?String(n).trim():"";if(c==="")continue;const m=c.toLowerCase();t.has(m)?(o.add(t.get(m)),o.add(r)):t.set(m,r)}ae.value=o}function Ut(o,t){ce.value&&clearTimeout(ce.value),!(!o||!T.value)&&(ce.value=setTimeout(async()=>{await It(o,t)},500))}async function It(o,t){if(!o||!T.value)return;const r=W.value[t],n=r==null?void 0:r.recordId;if(ke.value.has(o)&&!n){if(ke.value.get(o))ae.value.add(t);else{const fe=B(t,$);fe!=null&&String(fe).trim()!==""&&String(fe).trim().toLowerCase(),Ce()}return}const c=Number(o),m=Number.isNaN(c)?o:c,{data:A}=await M(te.PAYABLES_DETAILS,{InvoiceNumber:m},100),he=(n?A.filter(ge=>ge.recordId!==n):A).length>0;n||ke.value.set(o,he),he?ae.value.add(t):Ce()}function $e(o){const t=Q.value.trim();H(F.value,q.value,t),R(o),o==="enter"&&U(),we(()=>{var r;return(r=se.value)==null?void 0:r.focus()})}function Ht(){var o;Q.value=String(B(F.value,q.value)??""),(o=se.value)==null||o.blur()}const _t=["invoice_number","amount","total"];function Yt(o){if(o==="amount")return _t.includes(o)?"Amount before VAT *":"Amount before VAT";if(o==="reference")return"Tax Amount";const t=o.replace(/_/g," ").replace(/\b\w/g,r=>r.toUpperCase());return _t.includes(o)?`${t} *`:t}function ht(o){return o==="status"}function gt(o){return o==="tax"}function Wt(o){const t=B(o,p);if(t==null||t==="")return!1;const r=Number(t);return!Number.isNaN(r)&&r>0}function yt(o){return o==="total"}function wt(o){return o==="reference"}const qt=["amount","tax","reference","total"];function Me(o,t){const r=B(o,t);if(r==null||r==="")return"";if(Qo(r)){const c=j(String(r));return typeof c=="number"?Qe(c):String(c)}const n=N[t];if(qt.includes(n)){const c=Qe(r);return c!==""?c:r}return r}const Xt={invoice_number:"12ch",amount:"12ch",tax:"10ch",reference:"12ch",total:"12ch"};function xt(o){return{minWidth:Xt[o]??"10ch"}}const Zt=D(()=>({tableLayout:"auto",minWidth:"100%"}));function Kt(o,t){const r=F.value===o&&q.value===t,c=N[t]==="invoice_number"&&ae.value.has(o);return{"bg-[var(--color-accent-soft)] ring-2 ring-[var(--color-accent)] ring-inset":r,"bg-[var(--color-bg-card)]":!r,"cell-duplicate":c}}function Gt(o,t){Q.value=String(B(o,t)??""),k(o,t),!ht(N[t])&&!gt(N[t])&&!yt(N[t])&&!wt(N[t])&&we(()=>{var r;return(r=se.value)==null?void 0:r.focus()})}const me=C({visible:!1,x:0,y:0});function Qt(o){u.mainPosted||(me.value={visible:!0,x:o.clientX,y:o.clientY})}function _e(o){var t,r;if(me.value={...me.value,visible:!1},Te.value!==null&&(o!=null&&o.target)){const n=o.target;!((t=n.closest)!=null&&t.call(n,".cell-tax-breakdown-popover"))&&!((r=n.closest)!=null&&r.call(n,".cell-tax-breakdown-trigger"))&&it()}}function Jt(){G(),_e()}function eo(){pe(),_e()}function to(){de(),_e()}function oo(){We(),_e()}function ro(o){if(me.value.visible){_e();return}switch(o.key){case"ArrowUp":o.preventDefault(),R("up");break;case"ArrowDown":o.preventDefault(),R("down"),U();break;case"ArrowLeft":o.preventDefault(),R("left");break;case"ArrowRight":o.preventDefault(),R("right");break;case"Tab":o.preventDefault(),R(o.shiftKey?"tabReverse":"tab");break;case"Enter":o.preventDefault(),R("enter"),U();break}}return tt(()=>{var o;window.addEventListener("click",_e),(o=bt.value)==null||o.focus()}),Rt(()=>{window.removeEventListener("click",_e)}),(o,t)=>(s(),l("div",er,[e("div",{ref_key:"gridRef",ref:bt,class:"data-grid-scroll flex-1 min-h-0 overflow-auto outline-none focus:outline-none focus:ring-0",tabindex:"0",onKeydown:ro,onContextmenu:Z(Qt,["prevent"])},[e("table",{class:"data-grid-table border-collapse font-mono text-[var(--input-size)]",style:He({...Zt.value,"--row-header-width":g(le)+"px"})},[e("thead",tr,[e("tr",null,[t[13]||(t[13]=e("th",{class:"row-header-th sticky left-0 z-20 border-b border-r border-[var(--color-border)] px-3 py-2 text-[var(--label-size)] font-medium text-[var(--color-text-muted)]"}," # ",-1)),(s(!0),l(P,null,Y(g(N),(r,n)=>(s(),l("th",{key:r,class:"border-b border-r border-[var(--color-border)] px-3 py-2 text-left text-[var(--label-size)] font-medium text-[var(--color-text-muted)] whitespace-nowrap",style:He(xt(r))},y(Yt(r)),5))),128)),t[14]||(t[14]=e("th",{class:"data-grid-actions-th border-b border-[var(--color-border)] px-2 py-2 text-[var(--label-size)] font-medium text-[var(--color-text-muted)] w-14"},[e("span",{class:"sr-only"},"Options")],-1))])]),e("tbody",null,[(s(!0),l(P,null,Y(qe.value,r=>(s(),l("tr",{key:r,class:"data-grid-row hover:bg-white/[0.04] transition-colors"},[e("td",{class:ee(["row-header-td sticky left-0 z-10 border-b border-r border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-2 text-center text-[var(--color-text-muted)] tabular-nums",{"bg-[var(--color-accent-soft)]":g(F)===r}]),onClick:n=>g(k)(r,0)},y(r+1),11,or),(s(!0),l(P,null,Y(g(N),(n,c)=>(s(),l("td",{key:`${r}-${n}`,class:ee(["border-b border-r border-[var(--color-border)] px-3 py-2 text-left whitespace-nowrap",Kt(r,c)]),style:He(xt(n)),onClick:m=>Gt(r,c)},[Oe.value?(s(),l("span",nr,y(Me(r,c)),1)):ht(n)?(s(),l("select",{key:1,value:g(B)(r,c),class:"cell-select w-full min-w-0 border-0 bg-transparent text-[var(--color-text)] focus:ring-0 focus:outline-none",onClick:t[0]||(t[0]=Z(()=>{},["stop"])),onChange:m=>g(H)(r,c,m.target.value)},[(s(!0),l(P,null,Y(g(Ke),m=>(s(),l("option",{key:m,value:m},y(m),9,sr))),128))],40,ar)):gt(n)?(s(),l(P,{key:2},[e("div",lr,[e("span",ir,y(Me(r,c)),1),Wt(r)?(s(),l("button",{key:0,type:"button",class:"cell-tax-breakdown-trigger shrink-0 p-0.5 rounded text-[var(--color-text-muted)] hover:text-[var(--color-text)] hover:bg-white/10 focus:outline-none focus:ring-2 focus:ring-[var(--color-accent)]","aria-label":"Show tax breakdown",onClick:Z(m=>St(r,m),["stop"])},[...t[15]||(t[15]=[e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)])],8,ur)):E("",!0)]),Te.value===r?(s(),l("div",{key:0,ref_for:!0,ref_key:"taxBreakdownPopoverRef",ref:st,class:"cell-tax-breakdown-popover",role:"tooltip"},[Ve.value?(s(),l("div",dr,"Loading…")):(s(),l(P,{key:1},[t[16]||(t[16]=e("div",{class:"cell-tax-breakdown-title"},"Tax breakdown",-1)),Re.value.length?(s(),l("ul",cr,[(s(!0),l(P,null,Y(Re.value,(m,A)=>(s(),l("li",{key:A},y(m.TaxName)+" — "+y(m.Rate!=null?m.Rate+"%":""),1))),128))])):(s(),l("div",vr,y(Fe.value||"No taxes recorded for this invoice. Use row menu (⋯) to add tax."),1))],64))],512)):E("",!0)],64)):yt(n)?(s(),l("span",fr,y(Me(r,c)),1)):wt(n)?(s(),l("span",pr,y(Me(r,c)),1)):(s(),l(P,{key:5},[zt(r,c)?(s(),l("input",{key:`input-${r}-${c}`,ref_for:!0,ref_key:"cellInputRef",ref:se,value:Q.value,type:"text",class:ee(["cell-input w-full min-w-0 px-1.5 py-0.5 border-0 rounded bg-transparent text-[var(--color-text)] focus:ring-2 focus:ring-inset focus:outline-none",n==="invoice_number"&&ae.value.has(r)?"focus:ring-red-500 border-red-500/50":"focus:ring-[var(--color-accent)]"]),onInput:m=>Ft(r,c,m.target.value),onBlur:Vt,onKeydown:[t[1]||(t[1]=ye(Z(m=>$e("enter"),["prevent"]),["enter"])),t[2]||(t[2]=ye(Z(m=>$e("tab"),["prevent"]),["tab"])),ye(Ht,["escape"]),t[3]||(t[3]=ye(Z(m=>$e("enter"),["prevent"]),["down"])),t[4]||(t[4]=ye(Z(m=>$e("enterReverse"),["prevent"]),["up"])),t[5]||(t[5]=ye(Z(m=>$e("left"),["prevent"]),["left"])),t[6]||(t[6]=ye(Z(m=>$e("right"),["prevent"]),["right"]))]},null,42,br)):(s(),l("span",{key:1,class:ee(["cell-display",{"cell-display--duplicate":n==="invoice_number"&&ae.value.has(r)}])},y(Me(r,c)),3))],64))],14,rr))),128)),e("td",{class:"data-grid-actions-td border-b border-[var(--color-border)] px-2 py-2 w-14 align-middle",onClick:t[9]||(t[9]=Z(()=>{},["stop"]))},[Oe.value?E("",!0):(s(),l("div",mr,[e("button",{type:"button",class:ee(["data-grid-row-actions__trigger",{"data-grid-row-actions__trigger--open":x.value===r}]),"aria-expanded":x.value===r,"aria-haspopup":"true","aria-label":"Row options",onClick:n=>Lt(r)},[...t[17]||(t[17]=[e("svg",{class:"data-grid-row-actions__icon",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[e("path",{d:"M12 10.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 4.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 16.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z"})],-1)])],10,_r),S(Le,{name:"row-menu"},{default:je(()=>[x.value===r?(s(),l("div",{key:0,class:"data-grid-row-actions__dropdown",role:"menu",onClick:t[8]||(t[8]=Z(()=>{},["stop"]))},[e("div",hr,[O.value?(s(),l("div",gr,[t[18]||(t[18]=e("span",{class:"data-grid-row-actions__header-title"},"Tax",-1)),vt(r)?(s(),l("span",yr,y(vt(r)),1)):E("",!0)])):E("",!0),O.value===null?(s(),l(P,{key:1},[Ne.value?(s(),l("div",wr,[...t[19]||(t[19]=[e("span",{class:"data-grid-row-actions__state-text"},"Loading…",-1)])])):Ge.value.length===0?(s(),l("div",xr,[...t[20]||(t[20]=[e("span",{class:"data-grid-row-actions__state-text"},"No tax types",-1)])])):(s(),l("div",kr,[e("div",Rr,[t[23]||(t[23]=e("div",{class:"data-grid-row-actions__group-label"},"Set tax",-1)),e("div",Cr,[(s(!0),l(P,null,Y(Ge.value,n=>(s(),l("button",{key:n.typeKey,type:"button",class:ee(["data-grid-row-actions__option",{"data-grid-row-actions__option--expandable":n.items.length>1,"data-grid-row-actions__option--selected":n.items.length===1&&Ue(r,n.items[0].Tax_Name??"",n.items[0].Tax_Rate)}]),role:"menuitem",onClick:c=>Pt(r,n)},[n.items.length===1&&Ue(r,n.items[0].Tax_Name??"",n.items[0].Tax_Rate)?(s(),l("svg",jr,[...t[21]||(t[21]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),l("span",Nr)),e("span",Tr,y(n.typeLabel),1),n.items.length===1?(s(),l("span",Mr,y(ct(n.items[0].Tax_Rate)),1)):(s(),l("svg",Sr,[...t[22]||(t[22]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])]))],10,$r))),128))])])]))],64)):(s(),l(P,{key:2},[e("button",{type:"button",class:"data-grid-row-actions__back",onClick:t[7]||(t[7]=n=>O.value=null)},[t[24]||(t[24]=e("svg",{class:"data-grid-row-actions__back-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)),e("span",null,y(O.value),1)]),e("div",Dr,[e("div",Er,[(s(!0),l(P,null,Y(Bt.value,(n,c)=>(s(),l("button",{key:c,type:"button",class:ee(["data-grid-row-actions__option",{"data-grid-row-actions__option--selected":Ue(r,n.Tax_Name??"",n.Tax_Rate)}]),role:"menuitem",onClick:m=>ft(r,n.Tax_Rate,n.Tax_Name??"")},[Ue(r,n.Tax_Name??"",n.Tax_Rate)?(s(),l("svg",Ar,[...t[25]||(t[25]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2.5",d:"M5 13l4 4L19 7"},null,-1)])])):(s(),l("span",Lr)),e("span",Pr,y(n.Tax_Name??"—"),1),e("span",Or,y(ct(n.Tax_Rate)),1)],10,Br))),128))])])],64))])])):E("",!0)]),_:2},1024)]))])]))),128))])],4)],544),ne.value>0?(s(),l("div",zr,[e("div",Vr,[e("span",Fr," Showing "+y(Xe.value)+"–"+y(Ze.value)+" of "+y(ne.value)+" row"+y(ne.value!==1?"s":""),1),e("label",Ur,[t[26]||(t[26]=e("span",null,"Rows per page",-1)),e("select",{value:re.value,class:"rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-card)] px-2 py-1.5 text-[var(--color-text)] focus:ring-2 focus:ring-[var(--color-accent)] focus:border-transparent",onChange:t[10]||(t[10]=r=>re.value=Number(r.target.value))},[(s(),l(P,null,Y(ie,r=>e("option",{key:r,value:r},y(r),9,Hr)),64))],40,Ir)])]),e("div",Yr,[e("button",{type:"button",class:"pagination-btn rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-1.5 text-[var(--color-text-muted)] hover:bg-white/5 hover:text-[var(--color-text)] disabled:opacity-40 disabled:pointer-events-none transition-colors",disabled:I.value<=1,"aria-label":"Previous page",onClick:t[11]||(t[11]=r=>I.value=Math.max(1,I.value-1))}," Prev ",8,Wr),e("span",qr," Page "+y(I.value)+" of "+y(ue.value),1),e("button",{type:"button",class:"pagination-btn rounded-lg border border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-1.5 text-[var(--color-text-muted)] hover:bg-white/5 hover:text-[var(--color-text)] disabled:opacity-40 disabled:pointer-events-none transition-colors",disabled:I.value>=ue.value,"aria-label":"Next page",onClick:t[12]||(t[12]=r=>I.value=Math.min(ue.value,I.value+1))}," Next ",8,Xr)])])):E("",!0),e("div",Zr,[e("div",Kr,[t[27]||(t[27]=e("span",{class:"entry-total-row__label text-[var(--color-text-muted)] font-medium"},"Entry total",-1)),e("span",Gr,y(d.value),1)]),e("span",Qr,y(g(h).vendor.currency)+" "+y(w(g(u).entryTotal)),1)]),S(Jo,{visible:me.value.visible,x:me.value.x,y:me.value.y,onCopy:Jt,onPaste:eo,onCut:to,onClear:oo},null,8,["visible","x","y"])]))}}),en=Pe(Jr,[["__scopeId","data-v-8251613f"]]),tn={class:"content-area flex flex-col flex-1 min-h-0 w-full max-w-[1600px] mx-auto px-4 py-5 md:px-6 md:py-6"},on={class:"flex flex-wrap items-center gap-2 mb-4"},rn={class:"flex flex-1 flex-wrap items-center justify-center gap-2"},nn={key:0,class:"booklet-bar glass-input inline-flex items-center overflow-hidden rounded-full border border-[var(--color-border)]"},an=["aria-label","aria-current","onClick"],sn=["disabled"],ln=["disabled"],un={key:0,class:"text-xl font-bold text-[var(--color-text)] tabular-nums tracking-tight"},dn={key:0,class:"rejection-history mb-4"},cn={key:0,class:"rejection-history__skeleton"},vn={key:1,class:"rejection-history__timeline"},fn={class:"rejection-history__card"},pn={class:"rejection-history__meta"},bn={class:"rejection-history__num"},mn={key:0,class:"rejection-history__badge"},_n={class:"rejection-history__date"},hn={key:1,class:"rejection-history__by"},gn={class:"rejection-history__reason"},yn={key:1,class:"reject-reason-banner",role:"alert"},wn={class:"reject-reason-banner__content"},xn={class:"reject-reason-banner__text"},kn={class:"vendor-details-row relative mb-4"},Rn={class:"glass overflow-hidden rounded-[var(--radius-card)] border border-[var(--color-border)]"},Cn={class:"flex w-full items-center justify-between px-4 py-3"},$n={class:"border-t border-[var(--color-border)] px-4 pb-4 pt-3"},jn={class:"grid grid-cols-1 gap-3 sm:gap-4 md:grid-cols-2 lg:grid-cols-3"},Nn={key:0,type:"button",disabled:"",class:"booklet-circle absolute -left-16 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full flex items-center justify-center glass-input border-2 opacity-30 pointer-events-none","aria-label":"Previous entry"},Tn={key:1,type:"button",disabled:"",class:"booklet-circle absolute -right-16 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full flex items-center justify-center glass-input border-2 opacity-30 pointer-events-none","aria-label":"Next entry"},Mn={class:"mb-3"},Sn={class:"glass rounded-xl border border-[var(--color-border)] px-4 py-3 flex items-center gap-3"},Dn={class:"mb-3"},En={class:"flex-1 min-h-[360px] flex flex-col min-w-0"},Bn={class:"data-grid-wrapper flex flex-col flex-1 min-h-0 rounded-xl border border-[var(--color-border)] bg-[var(--color-bg-card)] shadow-sm overflow-hidden"},An={class:"data-grid-scroll flex-1 min-h-0 overflow-auto"},Ln={class:"data-grid-table border-collapse font-mono text-[var(--input-size)] w-full"},Pn={class:"sticky top-0 z-10 bg-[var(--color-bg-dark)]"},On={class:"border-b border-r border-[var(--color-border)] px-3 py-2.5",colspan:"2"},zn={class:"border-b border-r border-[var(--color-border)] px-3 py-2.5",colspan:"4"},Vn={class:"row-header-th sticky left-0 z-20 border-b border-r border-[var(--color-border)] px-3 py-2"},Fn={class:"row-header-td sticky left-0 z-10 border-b border-r border-[var(--color-border)] bg-[var(--color-bg-card)] px-3 py-2 text-center"},Un={class:"border-b border-[var(--color-border)] px-2 py-2 w-14"},In={class:"vendor-details-row relative mb-4"},Hn=["disabled"],Yn=["disabled"],Wn={class:"mb-3"},qn={class:"flex-1 min-h-[360px] flex flex-col min-w-0"},$t=60,Xn=xe({__name:"EntryView",setup(v){const b=co(),u=vo(),h=Mt(),a=Ae(),w=ot(),d=ao(),{isConnected:V,updateRecord:f,createRecord:M,findRecordsByQueryWithIds:z}=Tt(),_=Nt(),T=C(!1),N=C(!1),le=D(()=>h.rowCount.value>1),W=C("next"),F=D(()=>W.value==="next"?"booklet-next":"booklet-prev");function q(p){if(!(p!=null&&p.trim()))return"";const i=p.trim(),L=/^(\d{1,2})\/(\d{1,2})\/(\d{4})\s+(\d{1,2}):(\d{2}):(\d{2})/.exec(i);if(L){const[,$,x,O,ae,ke]=L,ce=parseInt(ae,10),ze=ce>=12?"PM":"AM",Ne=ce%12||12;return`${$}/${x}/${O} ${Ne}:${ke} ${ze}`}return i}function B(){const p=b.query.transRef;if(p!=null&&p.trim())a.fetchDetailsByTransRef(p.trim());else{a.clearAll(),w.reset();const i=new Date,L=i.getFullYear(),$=String(i.getMonth()+1).padStart(2,"0"),x=String(i.getDate()).padStart(2,"0");w.setField("payment_terms",`${L}-${$}-${x}`)}}function H(){var i;const p=(i=b.query.transRef)==null?void 0:i.trim();if(p&&a.currentTransRef===p){if(d.mode==="rejected"){d.ensureCurrent(p);return}a.mainPosted?d.removeByRef(p):d.ensureCurrent(p)}}function j(){if(!d.hasPrev)return;W.value="prev",d.goPrev();const p=d.currentTransRef;p&&u.push({name:"entry",query:{transRef:p}})}function k(){if(!d.hasNext)return;W.value="next",d.goNext();const p=d.currentTransRef;p&&u.push({name:"entry",query:{transRef:p}})}function R(p){if(p===d.currentOpenIndex)return;W.value=p>d.currentOpenIndex?"next":"prev",d.setCurrentIndex(p);const i=d.currentTransRef;i&&u.push({name:"entry",query:{transRef:i}})}tt(B);const U=C(!1),G=C(!1),de=C([]),pe=C(!1);async function We(){const p=a.currentTransRef;if(!(p!=null&&p.trim())||!a.mainPosted||!V.value){de.value=[],pe.value=!1;return}pe.value=!0;const{data:i,error:L}=await z(te.PAYABLES_REJECTION_HISTORY,{TransRef:p},50);if(L||!(i!=null&&i.length))de.value=[];else{const $=i.map(x=>x.fieldData).filter(Boolean).map(x=>{const O=x;return{RejectedDate:x.RejectedDate??O["Rejected date"],RejectedBy:x.RejectedBy??O["Rejected by"],Reason:x.Reason??O.Reason}});$.sort((x,O)=>{const ae=x.RejectedDate??"";return(O.RejectedDate??"").localeCompare(ae)}),de.value=$}pe.value=!1}let ie=null;so((p,i,L)=>{a.isDirty?(U.value=!0,ie=L):L()});function re(){ie&&(ie(),ie=null),U.value=!1}function I(){ie&&(ie(!1),ie=null),U.value=!1}oe(()=>b.query.transRef,B),oe(V,p=>{p&&b.query.transRef&&B()}),oe(()=>[b.query.transRef,a.currentTransRef,a.mainPosted],()=>H(),{immediate:!0}),oe(()=>[a.currentTransRef,a.mainPosted,a.loading],([p,i,L])=>{!L&&p&&i?We():de.value=[]},{immediate:!0});function ne(){h.deleteRow(h.selectedRow.value)}const ue=C(0);function qe(p){d.count<=1||(ue.value=p.touches[0].clientX)}function Xe(p){if(d.count<=1)return;const L=p.changedTouches[0].clientX-ue.value;L>$t&&d.hasPrev?j():L<-$t&&d.hasNext&&k()}function Ze(p){G.value=!1,Ke(p)}async function Ke(p){const i=a.currentTransRef,L=a.currentMainRecordId;if(!(!i||!L||!V.value)){T.value=!0;try{const{error:$}=await f(te.PAYABLES_MAIN,L,{Rejected:"Yes",RejectReason:p.trim()},{allowEmptyStrings:!1});if($){_.error("Reject failed: "+$);return}const{error:x}=await M(te.PAYABLES_REJECTION_HISTORY,{TransRef:i,RejectedDate:fo(),RejectedBy:"Manager",Reason:p.trim()});x&&_.error("Rejected but failed to record history: "+x),_.success("Entry rejected."),await a.fetchDetailsByTransRef(i),u.push({name:"home"})}finally{T.value=!1}}}async function Oe(){const p=a.currentMainRecordId;if(!(!p||!V.value)){N.value=!0;try{const{error:i}=await f(te.PAYABLES_MAIN,p,{Approved:"Yes",ApprovedDate:io()});if(i){_.error("Approve failed: "+i);return}_.success("Entry approved."),await a.fetchDetailsByTransRef(a.currentTransRef??""),u.push({name:"home"})}finally{N.value=!1}}}return(p,i)=>{const L=uo("router-link");return s(),l("div",tn,[S(Bo,{visible:U.value,onConfirm:re,onCancel:I},null,8,["visible"]),S(Vo,{visible:G.value,onSubmit:Ze,onCancel:i[0]||(i[0]=$=>G.value=!1)},null,8,["visible"]),e("div",on,[S(L,{to:"/",class:"pill-btn glass-input inline-flex items-center gap-1.5 px-3 py-2 text-[var(--label-size)] text-[var(--color-text-muted)] no-underline hover:text-[var(--color-text)]"},{default:je(()=>[...i[3]||(i[3]=[e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),K(" Back to list ",-1)])]),_:1}),e("div",rn,[g(d).count>1?(s(),l("div",nn,[(s(!0),l(P,null,Y(g(d).openEntryRefs,($,x)=>(s(),l("button",{key:$,type:"button",class:ee(["booklet-page-btn min-w-[2rem] px-2.5 py-2 text-[var(--label-size)] font-medium transition-colors",x===g(d).currentOpenIndex?"bg-[var(--color-accent-soft)] text-[var(--color-accent)]":"text-[var(--color-text-muted)] hover:bg-white/5 hover:text-[var(--color-text)]"]),"aria-label":`Entry ${x+1} of ${g(d).count}`,"aria-current":x===g(d).currentOpenIndex?"true":void 0,onClick:O=>R(x)},y(x+1),11,an))),128))])):E("",!0),g(a).mainPosted&&g(a).mainStatus==="Posted"&&g(a).currentMainRecordId?(s(),l(P,{key:1},[e("button",{type:"button",class:"pill-btn inline-flex items-center gap-2 rounded-full bg-red-700/90 px-4 py-2.5 text-[var(--label-size)] font-semibold text-white shadow-md hover:bg-red-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:T.value||N.value,onClick:i[1]||(i[1]=$=>G.value=!0)},[i[4]||(i[4]=e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})],-1)),K(" "+y(T.value?"Rejecting…":"Reject"),1)],8,sn),e("button",{type:"button",class:"pill-btn inline-flex items-center gap-2 rounded-full bg-emerald-700 px-4 py-2.5 text-[var(--label-size)] font-semibold text-white shadow-md hover:bg-emerald-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",disabled:T.value||N.value,onClick:Oe},[i[5]||(i[5]=e("svg",{class:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"2"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M5 13l4 4L19 7"})],-1)),K(" "+y(N.value?"Approving…":"Approve"),1)],8,ln)],64)):E("",!0)]),g(a).currentTransRef?(s(),l("span",un,y(g(a).currentTransRef),1)):E("",!0)]),g(a).mainPosted&&g(a).mainStatus==="Posted"&&(pe.value||de.value.length>0)?(s(),l("section",dn,[i[8]||(i[8]=lo('<header class="rejection-history__header" data-v-48fff673><div class="rejection-history__header-inner" data-v-48fff673><svg class="rejection-history__icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-48fff673><circle cx="12" cy="12" r="10" data-v-48fff673></circle><polyline points="12 6 12 12 16 14" data-v-48fff673></polyline></svg><div data-v-48fff673><h3 class="rejection-history__title" data-v-48fff673>Rejection history</h3><p class="rejection-history__subtitle" data-v-48fff673> Prior rejections for this entry. Officer has since resubmitted. </p></div></div></header>',1)),pe.value?(s(),l("div",cn,[(s(),l(P,null,Y(2,$=>e("div",{key:$,class:"rejection-history__skeleton-item"},[...i[6]||(i[6]=[e("div",{class:"rejection-history__skeleton-dot"},null,-1),e("div",{class:"rejection-history__skeleton-content"},[e("div",{class:"rejection-history__skeleton-line",style:{width:"45%"}}),e("div",{class:"rejection-history__skeleton-line",style:{width:"80%"}})],-1)])])),64))])):(s(),l("ul",vn,[(s(!0),l(P,null,Y(de.value,($,x)=>(s(),l("li",{key:x,class:"rejection-history__item"},[i[7]||(i[7]=e("span",{class:"rejection-history__line"},null,-1)),e("span",{class:ee(["rejection-history__dot",{"rejection-history__dot--first":x===0}]),"aria-hidden":"true"},null,2),e("div",fn,[e("div",pn,[e("span",bn,"#"+y(x+1),1),x===0?(s(),l("span",mn,"Most recent")):E("",!0),e("span",_n,y(q($.RejectedDate)),1),$.RejectedBy?(s(),l("span",hn,"by "+y($.RejectedBy),1)):E("",!0)]),e("p",gn,y($.Reason),1)])]))),128))]))])):E("",!0),g(a).mainStatus==="Rejected"&&(g(a).mainRejectReason||"").trim()?(s(),l("div",yn,[i[10]||(i[10]=e("span",{class:"reject-reason-banner__icon","aria-hidden":"true"},[e("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 8v4M12 16h.01"})])],-1)),e("div",wn,[i[9]||(i[9]=e("strong",{class:"reject-reason-banner__label"},"Rejection reason",-1)),e("p",xn,y(g(a).mainRejectReason),1)])])):E("",!0),e("div",{class:ee(["booklet-flip-view",{"booklet-flip-view--swipeable":g(d).count>1}]),onTouchstart:qe,onTouchend:Xe},[S(Le,{name:F.value,mode:"out-in"},{default:je(()=>[g(a).loading?(s(),l("div",{key:`loading-${g(b).query.transRef||"new"}`,class:"entry-page flex flex-col flex-1 min-h-0"},[e("div",kn,[e("section",Rn,[e("div",Cn,[S(X,{width:"7rem",height:"1.125rem"}),S(X,{width:"1.25rem",height:"1.25rem"})]),e("div",$n,[e("div",jn,[(s(),l(P,null,Y(6,$=>e("div",{key:$,class:"block"},[S(X,{width:"6rem",height:"0.813rem",class:"mb-1"}),S(X,{width:"100%",height:"2.5rem"})])),64))])])]),g(d).count>1?(s(),l("button",Nn,[...i[11]||(i[11]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])])):E("",!0),g(d).count>1?(s(),l("button",Tn,[...i[12]||(i[12]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])])):E("",!0)]),e("div",Mn,[e("div",Sn,[S(X,{width:"6rem",height:"2.25rem"}),S(X,{width:"6rem",height:"2.25rem"})])]),e("div",Dn,[S(X,{width:"100%",height:"0.813rem",class:"max-w-[600px]"})]),e("div",En,[e("div",Bn,[e("div",An,[e("table",Ln,[e("thead",Pn,[e("tr",null,[i[13]||(i[13]=e("th",{class:"row-header-th sticky left-0 z-20 border-b border-r border-[var(--color-border)] px-3 py-2.5"},null,-1)),e("th",On,[S(X,{width:"5rem",height:"0.813rem"})]),e("th",zn,[S(X,{width:"6rem",height:"0.813rem"})]),i[14]||(i[14]=e("th",{class:"border-b border-[var(--color-border)] px-2 py-2 w-14"},null,-1))]),e("tr",null,[e("th",Vn,[S(X,{width:"1rem",height:"0.813rem"})]),(s(),l(P,null,Y(6,$=>e("th",{key:$,class:"border-b border-r border-[var(--color-border)] px-3 py-2"},[S(X,{width:"4rem",height:"0.813rem"})])),64)),i[15]||(i[15]=e("th",{class:"border-b border-[var(--color-border)] px-2 py-2 w-14"},null,-1))])]),e("tbody",null,[(s(),l(P,null,Y(5,$=>e("tr",{key:$,class:"data-grid-row"},[e("td",Fn,[S(X,{width:"1.5rem",height:"0.938rem"})]),(s(),l(P,null,Y(6,x=>e("td",{key:x,class:"border-b border-r border-[var(--color-border)] px-3 py-2"},[S(X,{width:"5rem",height:"0.938rem"})])),64)),e("td",Un,[S(X,{width:"2.5rem",height:"2.5rem",class:"rounded-[10px]"})])])),64))])])])])])])):(s(),l("div",{key:`entry-${g(b).query.transRef||"new"}`,class:"entry-page flex flex-col flex-1 min-h-0"},[e("div",In,[S(So),g(d).count>1?(s(),l("button",{key:0,type:"button",disabled:!g(d).hasPrev,class:"booklet-circle absolute -left-16 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full flex items-center justify-center glass-input border-2 text-orange-400/90 hover:text-orange-400 hover:bg-orange-500/10 border-orange-500/70 hover:border-orange-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:ring-offset-2 focus:ring-offset-[var(--color-bg)] disabled:opacity-30 disabled:pointer-events-none disabled:border-[var(--color-border)] disabled:text-[var(--color-text-muted)] transition-all shadow-lg","aria-label":"Previous entry",onClick:j},[...i[16]||(i[16]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])],8,Hn)):E("",!0),g(d).count>1?(s(),l("button",{key:1,type:"button",disabled:!g(d).hasNext,class:"booklet-circle absolute -right-16 top-1/2 -translate-y-1/2 z-10 w-12 h-12 rounded-full flex items-center justify-center glass-input border-2 text-orange-400/90 hover:text-orange-400 hover:bg-orange-500/10 border-orange-500/70 hover:border-orange-400 focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:ring-offset-2 focus:ring-offset-[var(--color-bg)] disabled:opacity-30 disabled:pointer-events-none disabled:border-[var(--color-border)] disabled:text-[var(--color-text-muted)] transition-all shadow-lg","aria-label":"Next entry",onClick:k},[...i[17]||(i[17]=[e("svg",{class:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1)])],8,Yn)):E("",!0)]),e("div",Wn,[S(Io,{"can-delete-row":le.value,onAddRow:i[2]||(i[2]=$=>g(h).addRow()),onDeleteRow:ne},null,8,["can-delete-row"])]),i[18]||(i[18]=e("p",{class:"mb-3 text-[var(--label-size)] text-[var(--color-text-muted)]"},[e("strong",{class:"text-[var(--color-text)]"},"Required to save:"),K(" Fill "),e("span",{class:"text-red-400/90"},"*"),K(" Vendor name or Vendor ID above; in the grid, each row must have at least one of: Invoice Number, Amount, or Total. ")],-1)),e("div",qn,[S(en)])]))]),_:1},8,["name"])],34)])}}}),Gn=Pe(Xn,[["__scopeId","data-v-48fff673"]]);export{Gn as default};
